Ext.ns("Rs.ext");Rs.ext.MessageBox=function(){var u,b,q,t,g,l,s,a,n,p,j,f,r,v,o,h="",d="",m=["ok","yes","no","cancel"];var c=function(x){r[x].blur();if(u.isVisible()){u.hide();w();Ext.callback(b.fn,b.scope||window,[x,v.dom.value,b],1)}};var w=function(){if(b&&b.cls){u.el.removeClass(b.cls)}n.reset()};var e=function(z,x,y){if(b&&b.closable!==false){u.hide();w()}if(y){y.stopEvent()}};var k=function(x){var z=0,y;if(!x){Ext.each(m,function(A){r[A].hide()});return z}u.footer.dom.style.display="";Ext.iterate(r,function(A,B){y=x[A];if(y){B.show();B.setText(Ext.isString(y)?y:Rs.ext.MessageBox.buttonText[A]);z+=B.getEl().getWidth()+15}else{B.hide()}});return z};return{getDialog:function(x){if(!u){var z=[];r={};Ext.each(m,function(A){z.push(r[A]=new Ext.Button({text:this.buttonText[A],handler:c.createCallback(A),hideMode:"offsets"}))},this);u=new Ext.Window({autoCreate:true,title:x,resizable:false,constrain:true,constrainHeader:true,minimizable:false,maximizable:false,stateful:false,modal:true,shim:true,buttonAlign:"center",width:400,height:100,minHeight:80,plain:true,footer:true,closable:true,close:function(){if(b&&b.buttons&&b.buttons.no&&!b.buttons.cancel){c("no")}else{c("cancel")}},fbar:new Ext.Toolbar({items:z,enableOverflow:false})});u.render(document.body);u.getEl().addClass("x-window-dlg");q=u.mask;g=u.body.createChild({html:'<div class="ext-mb-icon"></div><div class="ext-mb-content"><span class="ext-mb-text"></span><br /><div class="ext-mb-fix-cursor"><input type="text" class="ext-mb-input" /><textarea class="ext-mb-textarea"></textarea></div></div>'});j=Ext.get(g.dom.firstChild);var y=g.dom.childNodes[1];l=Ext.get(y.firstChild);s=Ext.get(y.childNodes[2].firstChild);s.enableDisplayMode();s.addKeyListener([10,13],function(){if(u.isVisible()&&b&&b.buttons){if(b.buttons.ok){c("ok")}else{if(b.buttons.yes){c("yes")}}}});s.on("keypress",function(C,D,B){var A=[37,42,63,39,34,44,58,59];if(A.indexOf(C.keyCode)>-1){C.stopEvent()}},this);a=Ext.get(y.childNodes[2].childNodes[1]);a.enableDisplayMode();a.on("keypress",function(C,D,B){var A=[37,42,63,39,34,44,58,59];if(A.indexOf(C.keyCode)>-1){C.stopEvent()}},this);n=new Ext.ProgressBar({renderTo:g});g.createChild({cls:"x-clear"})}return u},updateText:function(A){if(!u.isVisible()&&!b.width){u.setSize(this.maxWidth,100)}l.update(A?A+" ":"&#160;");var y=d!=""?(j.getWidth()+j.getMargins("lr")):0,C=l.getWidth()+l.getMargins("lr"),z=u.getFrameWidth("lr"),B=u.body.getFrameWidth("lr"),x;x=Math.max(Math.min(b.width||y+C+z+B,b.maxWidth||this.maxWidth),Math.max(b.minWidth||this.minWidth,o||0));if(b.prompt===true){v.setWidth(x-y-z-B)}if(b.progress===true||b.wait===true){n.setSize(x-y-z-B)}if(Ext.isIE&&x==o){x+=4}l.update(A||"&#160;");u.setSize(x,"auto").center();return this},updateProgress:function(y,x,z){n.updateProgress(y,x);if(z){this.updateText(z)}return this},isVisible:function(){return u&&u.isVisible()},hide:function(){var x=u?u.activeGhost:null;if(this.isVisible()||x){u.hide();w();if(x){u.unghost(false,false)}}return this},show:function(A){if(this.isVisible()){this.hide()}b=A;var B=this.getDialog(b.title||"&#160;");B.setTitle(b.title||"&#160;");var x=(b.closable!==false&&b.progress!==true&&b.wait!==true);B.tools.close.setDisplayed(x);v=s;b.prompt=b.prompt||(b.multiline?true:false);if(b.prompt){if(b.multiline){s.hide();a.show();a.setHeight(Ext.isNumber(b.multiline)?b.multiline:this.defaultTextHeight);v=a}else{s.show();a.hide()}}else{s.hide();a.hide()}v.dom.value=b.value||"";if(b.prompt){B.focusEl=v}else{var z=b.buttons;var y=null;if(z&&z.ok){y=r.ok}else{if(z&&z.yes){y=r.yes}}if(y){B.focusEl=y}}if(Ext.isDefined(b.iconCls)){B.setIconClass(b.iconCls)}this.setIcon(Ext.isDefined(b.icon)?b.icon:h);o=k(b.buttons);n.setVisible(b.progress===true||b.wait===true);this.updateProgress(0,b.progressText);this.updateText(b.msg);if(b.cls){B.el.addClass(b.cls)}B.proxyDrag=b.proxyDrag===true;B.modal=b.modal!==false;B.mask=b.modal!==false?q:false;if(!B.isVisible()){document.body.appendChild(u.el.dom);B.setAnimateTarget(b.animEl);B.on("show",function(){if(x===true){B.keyMap.enable()}else{B.keyMap.disable()}},this,{single:true});B.show(b.animEl)}if(b.wait===true){n.wait(b.waitConfig)}return this},setIcon:function(x){if(!u){h=x;return}h=undefined;if(x&&x!=""){j.removeClass("x-hidden");j.replaceClass(d,x);g.addClass("x-dlg-icon");d=x}else{j.replaceClass(d,"x-hidden");g.removeClass("x-dlg-icon");d=""}return this},progress:function(z,y,x){this.show({title:z,msg:y,buttons:false,progress:true,closable:false,minWidth:this.minProgressWidth,progressText:x});return this},wait:function(z,y,x){this.show({title:y,msg:z,buttons:false,closable:false,wait:true,modal:true,minWidth:this.minProgressWidth,waitConfig:x});return this},alert:function(A,z,y,x){this.show({title:A,msg:z,buttons:this.OK,fn:y,scope:x,minWidth:this.minWidth});return this},confirm:function(A,z,y,x){this.show({title:A,msg:z,buttons:this.YESNO,fn:y,scope:x,icon:this.QUESTION,minWidth:this.minWidth});return this},prompt:function(C,B,z,y,x,A){this.show({title:C,msg:B,buttons:this.OKCANCEL,fn:z,minWidth:this.minPromptWidth,scope:y,prompt:true,multiline:x,value:A});return this},OK:{ok:true},CANCEL:{cancel:true},OKCANCEL:{ok:true,cancel:true},YESNO:{yes:true,no:true},YESNOCANCEL:{yes:true,no:true,cancel:true},INFO:"ext-mb-info",WARNING:"ext-mb-warning",QUESTION:"ext-mb-question",ERROR:"ext-mb-error",defaultTextHeight:75,maxWidth:600,minWidth:100,minProgressWidth:250,minPromptWidth:250,buttonText:{ok:"OK",cancel:"Cancel",yes:"Yes",no:"No"}}}();Rs.ns("Rs.ext.state");(function(){Rs.ext.state.Provider=function(a){this.state={};Ext.apply(this,a||{});this.addEvents("statechange","load");Rs.ext.state.Provider.superclass.constructor.call(this);if(this.autoLoad===true){this.load()}else{if(Rs.isArray(this.autoLoad)&&this.autoLoad.length>0){this.load(this.autoLoad)}}this.on("statechange",this.sync,this,{scope:this,buffer:100})};Ext.extend(Rs.ext.state.Provider,Rs.util.Observable,{autoLoad:false,load:function(b,d,c){var a=this.url||Rs.BASE_STATE_MANAGER_PATH;Rs.Service.call({url:a,method:"load",params:{modules:Rs.isArray(b)?b:[b]}},this.__onLoad.createDelegate(this,[d,c],3),c)},__onLoad:function(e,j,f,g){var h,d,b,a,c;Rs.each(e,function(k){d=k.moduleCode;b=k.schemeCode;k.stateData==undefined?k.stateData="":null;a=Rs.decode(k.stateData||"")||{};c=(k.defaultFlag===true);this.state[d]?null:this.state[d]={};this.state[d][b]?null:this.state[d][b]={};Rs.apply(this.state[d][b],{defaultFlag:c,stateData:a})},this);if(f&&Rs.isFunction(f)){f.call(g||this,e)}this.fireEvent("load",this,e)},sync:function(c,d,b){var a=this.url||Rs.BASE_STATE_MANAGER_PATH;Rs.Service.call({url:a,method:d,params:b},this.onSync,this)},onSync:function(a){if(a!=true){Ext.Msg.alert("提示","操作失败")}},get:function(c,b,a){return Rs.isDefined(this.state[c])&&Rs.isObject(this.state[c])&&Rs.isDefined(this.state[c][b])?this.state[c][b]:a},getAll:function(a){return Ext.isDefined(this.state[a])&&Ext.isObject(this.state[a])?this.state[a]:{}},getDefaultSchemeCode:function(c){var a=this.state[c],d,b;if(a){for(d in a){b=a[d];if(b.defaultFlag===true){return d}}}},set:function(e,b,g,c){!Rs.isDefined(this.state[e])?this.state[e]={}:null;!Rs.isDefined(this.state[e][b])?this.state[e][b]={defaultFlag:false,stateData:""}:null;this.state[e][b]=Rs.apply(this.state[e][b],{stateData:g});Rs.apply(this.state[e][b],c||{});var a={},f={},h=this.state[e][b];f[b]=Rs.apply(Rs.apply({},h),{stateData:Rs.encode(h.stateData)});a[e]=f;this.fireEvent("statechange",this,"sync",{data:a})},rename:function(b,c,a){!Rs.isDefined(this.state[b])?this.state[b]={}:null;this.state[b][a]=Ext.apply({},this.state[b][c]||{defaultFlag:false,stateData:""});delete this.state[b][c];this.fireEvent("statechange",this,"rename",{moduleCode:b,newName:a,oldName:c})},setDefault:function(c,b){var a=this.state[c],e,d;if(a){for(e in a){d=a[e];if(d){if(e==b){d.defaultFlag=true;this.fireEvent("statechange",this,"setDefault",{moduleCode:c,schemeCode:b})}else{d.defaultFlag=false}}}}},clear:function(b,a){Rs.isDefined(this.state[b])&&Ext.isDefined(this.state[b][a])?delete this.state[b][a]:null;this.fireEvent("statechange",this,"clear",{moduleCode:b,schemeCode:a})},clearAll:function(a){Rs.isDefined(this.state[a])?delete this.state[a]:null;this.fireEvent("statechange",this,"clear",{moduleCode:a})}})})();Rs.ns("Rs.ext.state");(function(){Rs.ext.state.StateManager=function(){var a=new Rs.ext.state.Provider({});return{init:function(b,d,c){a.load(b,d,c)},setProvider:function(b){a=b},getProvider:function(){return a},get:function(d,c,b){return a.get(d,c,b)},getAll:function(b){return a.getAll(b)},getSchemeCount:function(d){var b=this.getAll(d),e,c=0;for(e in b){c++}return c},getDefaultSchemeCode:function(b){return a.getDefaultSchemeCode(b)},set:function(d,b,e,c){a.set(d,b,e,c)},rename:function(c,d,b){a.rename(c,d,b)},setDefault:function(c,b){a.setDefault(c,b)},clear:function(c,b){a.clear(c,b)},clearAll:function(b){a.clearAll(module)}}}()})();Rs.ns("Rs.ext.state");(function(){Rs.ext.state.StatePlugin=function(a){Ext.apply(this,a);Rs.ext.state.StatePlugin.superclass.constructor.call(this);this.addEvents("beforestaterestore","staterestore","beforestatesave","statesave","stateload");if(Rs.ext.state.StateManager&&this.scheme!==false&&Rs.isNumber(this.scheme)){this.button=new Ext.SplitButton({xtype:"splitbutton",iconCls:"rs-action-scheme",text:"创建方案",handler:this.createScheme,scope:this,menu:this.stateManagerMenu=new Ext.menu.Menu()});Rs.ext.state.StateManager.getProvider().on("statechange",this.syncStateMangerMenu,this,{single:true,delay:25});this.stateManagerMenu.on("beforeshow",this.syncStateMangerMenu,this)}};Ext.extend(Rs.ext.state.StatePlugin,Ext.util.Observable,{scheme:10,schemeMsg:"您不能再创建方案, 最多创建{0}个方案",init:function(a){this.comp=a;this.stateId=this.comp.getStateId();this.initStateEvents();this.initState()},getStateId:function(){return this.stateId},initStateEvents:function(){if(this.comp.stateEvents){for(var a=0,b;b=this.comp.stateEvents[a];a++){this.comp.on(b,this.saveScheme,this,{delay:100})}}},initState:function(){if(Rs.ext.state.StateManager){var c=this.getStateId(),b,a;if(c){Rs.ext.state.StateManager.init(c,function(){b=Rs.ext.state.StateManager.getDefaultSchemeCode(c);this.fireEvent("stateload",this,b);if(b){a=Rs.ext.state.StateManager.get(c,b);if(a&&this.fireEvent("beforestaterestore",this,a)!==false){this.applyScheme(b,a);this.fireEvent("staterestore",this,a)}}},this)}}},createScheme:function(){var b=this.getStateId(),a=Rs.ext.state.StateManager.getSchemeCount(b);if((Rs.isNumber(this.scheme)&&this.scheme>a)||this.scheme===true){Ext.Msg.prompt("创建方案","请输入方案名称",function(c,d){if(c=="ok"&&!Rs.isEmpty(d,false)&&d.length<=30){if(Rs.isNumber(this.scheme)){this.currentSchemeCode=d;this.saveScheme()}}},this)}else{Ext.Msg.alert("提示",String.format(this.schemeMsg,a))}},saveScheme:function(){if(Rs.ext.state.StateManager){var d=this.getStateId(),b=this.currentSchemeCode||this.getStateId(),a=this.scheme!=false?null:{defaultFlag:true};if(d){var c=this.comp.getState();if(this.fireEvent("beforestatesave",this,d,b,c)!==false){Rs.ext.state.StateManager.set(d,b,c,a);this.fireEvent("statesave",this,d,b,c)}}}},applyScheme:function(b,a){this.currentSchemeCode=b;if(a&&a.stateData){this.comp.applyState(a.stateData)}},renameScheme:function(a){Ext.Msg.prompt("提示","请输入新名称",function(b,c){if(b=="ok"){if(a!=c&&!Rs.isEmpty(c,false)&&c.length<=30){var d=this.getStateId();if(this.currentSchemeCode==a){this.currentSchemeCode=c}Rs.ext.state.StateManager.rename(d,a,c)}}},this,false,a)},setDefaultScheme:function(a){var b=this.getStateId();if(b&&a){Rs.ext.state.StateManager.setDefault(b,a)}},deleteScheme:function(a){Ext.Msg.show({title:"提示",msg:"您确定要删除该方案吗?",buttons:Ext.Msg.YESNO,fn:function(b){if(b==="yes"){var c=this.getStateId();if(c&&a){Rs.ext.state.StateManager.clear(c,a)}}},animEl:"elId",icon:Ext.MessageBox.QUESTION,scope:this})},syncStateMangerMenu:function(){var f=this.getStateId(),a=Rs.ext.state.StateManager.getAll(f),e,c,b,d;this.stateManagerMenu.removeAll();for(e in a){c=a[e];b=(this.currentSchemeCode===e);d=(c.defaultFlag===true);this.stateManagerMenu.add({text:e,cls:(d?"rs-state-default-scheme":"")+(b?" rs-state-current-scheme":""),handler:this.applyScheme.createDelegate(this,[e,Rs.ext.state.StateManager.get(f,e)]),scope:this,menu:new Ext.menu.Menu({items:[{text:"应用",disabled:b?true:false,handler:this.applyScheme.createDelegate(this,[e,Rs.ext.state.StateManager.get(f,e)]),scope:this},{text:"重命名",handler:this.renameScheme.createDelegate(this,[e]),scope:this},{text:"设为默认",disabled:d?true:false,handler:this.setDefaultScheme.createDelegate(this,[e]),scope:this},{text:"保存",disabled:b?false:true,handler:this.saveScheme,scope:this},{text:"删除",handler:this.deleteScheme.createDelegate(this,[e]),scope:this}]})})}return this.stateManagerMenu.items.length>=1}})})();Ext.ns("Rs.ext.query");(function(){Rs.ext.query.QueryPanel=function(a){Ext.apply(this,a||{layout:"column"});if(this.isPop){this.bbar=new Ext.Toolbar({items:["->"]})}this.editors={};Rs.ext.query.QueryPanel.superclass.constructor.call(this,a);this.addEvents("beforeselectcondition","selectcondition","beforeunselectcondition","unselectcondition","beforequery","query","reset");this.on("resize",function(){if(this.ownerCt){this.ownerCt.doLayout()}},this,{delay:10})};Ext.extend(Rs.ext.query.QueryPanel,Ext.Panel,{animCollapse:false,isPop:false,bodyCfg:{cls:"rs-query-panel-body"},bodyStyle:"padding:5px;",cls:"rs-query-panel",autoHeight:true,autoScroll:true,defaults:{border:false},widgetWidth:230,labelWidth:100,layout:"column",keyNavConfig:{enter:function(b){var a=Ext.get(b.getTarget());if(!a.hasClass("x-btn-text")){this.doQuery()}return true}},initComponent:function(){Rs.ext.query.QueryPanel.superclass.initComponent.call(this);this.addActionsButtons();if(Ext.isArray(this.conditions)){var b=this.conditions;for(var a=0;a<b.length;a++){if(b[a].editor){this.addConditionToPanel(b[a]);this.addConditionToMenu(b[a],!b[a].hidden)}}}},addConditionToPanel:function(d){var b=false;if(this.items){this.items.each(function(c){if(c.dataIndex==d.dataIndex){c.show();try{this.syncSize()}catch(f){}b=true;return false}},this);if(b){return}}var a={};if(!d.editor.isXType){a=Ext.create(Ext.applyIf(d.editor||{},{fieldLabel:d.header,labelStyle:"text-align:right;width:"+this.labelWidth+"px;",width:120}),"textfield")}else{a=Ext.applyIf(d.editor,{labelStyle:"text-align:right;width:"+this.labelWidth+"px;",fieldLabel:d.header,width:120})}this.editors[d.dataIndex]=a.id;this.add({layout:"form",bodyCfg:{cls:"rs-query-panel-body"},width:this.widgetWidth,dataIndex:d.dataIndex,hidden:d.hidden,labelWidth:this.labelWidth,items:[a]});if(this.rendered){this.syncSize()}},getEditor:function(a){return this.findById(this.editors[a])},removeConditionFromPanel:function(a){this.items.each(function(b){if(b.dataIndex==a){b.hide();this.syncSize();return false}},this)},addActionsButtons:function(){var a=this.getBottomToolbar()||this.getTopToolbar()||this;a.addButton({iconCls:"rs-action-condition",text:"条件",scope:this,menu:this.addConditonMenu=new Ext.menu.Menu()});a.addButton({iconCls:"rs-action-reset",text:"重置",handler:this.resetConditions,scope:this});a.addButton({iconCls:"rs-action-query",text:"查询",handler:this.doQuery,scope:this})},addConditionToMenu:function(c,b){if(!c){return}var a=this.addConditonMenu.add({text:c.header||c.dataIndex,dataIndex:c.dataIndex,condition:c,checked:b,hideOnClick:false,handler:this.onConditionMenuClick,scope:this})},onConditionMenuClick:function(a,b){if(a.checked){this.removeConditionFromPanel(a.dataIndex);this.fireEvent("unselectcondition",this,a)}else{this.addConditionToPanel(a.condition);this.fireEvent("selectcondition",this,a)}},resetConditions:function(){this.items.each(function(a){a.items.items[0].reset()},this);this.fireEvent("reset",this)},initEvents:function(){Rs.ext.query.QueryPanel.superclass.initEvents.call(this);this.keyNav=new Ext.KeyNav(this.el,Ext.apply(this.keyNavConfig,{scope:this,forceKeyDown:true}))},bindStore:function(b,c,a){this.store=b;this.queryCallback=c;this.queryScope=a},bindNode:function(a){this.node=a},bindGeneralselPanel:function(a){this.gPanel=a},getParams:function(){var a={};this.items.each(function(c){if(!c.hidden){var b=c.items.items[0].getValue();if(!Ext.isEmpty(b)){a[c.dataIndex]=b}}},this);return a},doQuery:function(){if(!this.preDoQuery()){return}var g=this.getParams();if(g&&this.fireEvent("beforequery",this,g)!==false){if(this.store){if(this.queryCallback){var f=this.getSQL(g);this.queryCallback.call(this.queryScope,f)}else{Ext.applyIf(g,this.store.baseParams||this.grid.store.baseParams||{});this.store.load({params:g})}}else{if(this.grid&&this.grid.store){if(this.queryCallback){var f=this.getSQL(g);this.queryCallback.call(this.queryScope,f)}else{Ext.applyIf(g,this.grid.store.baseParams||{});g.metaData.start=0;this.grid.store.load({params:g})}}else{if(this.node){if(this.nodeBaseParams){var e=this.nodeBaseParams,c=this.node.getLoader().baseParams,d;for(d in e){c[d]?delete c[d]:null}}this.node.collapse(true);while(this.node.firstChild){this.node.removeChild(this.node.firstChild,true);var b=this}this.node.loaded=false;this.node.loading=-1;Ext.apply(this.node.getLoader().baseParams,g);this.node.expand(false,false);this.nodeBaseParams=g}}}this.fireEvent("query",this,g)}},getSQL:function(b){var c=[];for(var a in b){c.push(a+" like '"+b[a]+"%'")}return c.join(" AND ")},preDoQuery:function(){var a=true;this.items.each(function(b){return a=b.items.items[0].validate()},this);return a},applyState:function(a){if(a&&a.conditions){this.resetConditions();this.addConditonMenu.items.each(function(b){if(a.conditions[b.dataIndex]!==undefined){b.setChecked(true);this.addConditionToPanel(b.condition)}else{b.setChecked(false);this.removeConditionFromPanel(b.dataIndex)}},this);this.setValue(a.conditions)}},setValue:function(a){for(var b in a){this.findById(this.editors[b]).setValue(a[b])}},getState:function(){var b={conditions:{}},a=0;this.addConditonMenu.items.each(function(c){if(c.checked){b.conditions[c.dataIndex]=this.findById(this.editors[c.dataIndex]).getValue()}},this);return b},destroy:function(){Rs.ext.query.QueryPanel.superclass.destroy.apply(this,arguments)}});Ext.ComponentMgr.registerType("rs-ext-querypanel",Rs.ext.query.QueryPanel)})();Ext.ns("Rs.ext.tree");(function(){Rs.ext.tree.TreeLoader=function(a){Ext.apply(this,a);Rs.ext.tree.TreeLoader.superclass.constructor.call(this)};Rs.extend(Rs.ext.tree.TreeLoader,Ext.tree.TreeLoader,{method:"load",getParams:function(b){var c=Rs.ext.tree.TreeLoader.superclass.getParams.call(this,b),a=[];if(Ext.isString(this.nodeAttrsParams)){a.push(this.nodeAttrsParams)}else{if(Ext.isArray(this.nodeAttrsParams)){Ext.each(this.nodeAttrsParams,function(d){if(Ext.isString(d)){a.push(d)}},this)}}return Ext.copyTo(c||{},b.attributes,a)},requestData:function(c,d,b){if(this.fireEvent("beforeload",this,c,d)!==false){if(this.directFn){var a=this.getParams(c);a.push(this.processDirectResponse.createDelegate(this,[{callback:d,node:c,scope:b}],true));this.directFn.apply(window,a)}else{this.transId=Rs.Service.call({method:this.method,url:this.dataUrl||this.url,callback:this.handleResponse,scope:this,argument:{callback:d,node:c,scope:b},params:this.getParams(c)})}}else{this.runCallback(d,b||c,[])}},handleResponse:function(d,b,e){if(b===false){this.handleFailure(d)}else{this.transId=false;var c=d.argument;this.processResponse(d,c.node,c.callback,c.scope);this.fireEvent("load",this,c.node,d)}}})})();Ext.ns("Rs.ext.tree");(function(){Rs.ext.tree.PagingTreeLoader=function(a){Ext.apply(this,a||{});this.clearOnLoad=false;Rs.ext.tree.PagingTreeLoader.superclass.constructor.call(this,a)};Ext.extend(Rs.ext.tree.PagingTreeLoader,Rs.ext.tree.TreeLoader,{pageSize:20,moreNodeName:"",getParams:function(a){var c=Rs.ext.tree.PagingTreeLoader.superclass.getParams.call(this,a),b={start:0,limit:this.pageSize},d=a.lastChild;if(d!=undefined&&d.isMoreNode===true){b=d.getPagingInfo()}return Ext.apply(c,b)},processResponse:function(d,b,l,m){var o=d.responseText;try{var h=d.responseData||Ext.decode(o),g=h.nodes||[];b.beginUpdate();var c=this.getMoreNode(b,h);for(var f=0,j=g.length;f<j;f++){var a=this.createNode(g[f]);if(a){b.appendChild(a)}}if(c!=undefined){c.setChildrenInfo({childTotal:h.childTotal||b.childNodes.length,childCount:b.childNodes.length});b.appendChild(c)}b.endUpdate();this.runCallback(l,m||b,[b])}catch(k){this.handleFailure(d)}},getMoreNode:function(b,c){var e=c.nodes||[],a=c.childTotal||e.length,d=b.lastChild;if(d!=undefined){if(d.isMoreNode===true){b.removeChild(d,false)}else{d=undefined}}if(a>b.childNodes.length+e.length){if(d==undefined){d=this.createVirtualMoreNode(b)}return d}},createVirtualMoreNode:function(d){var b={},c;for(c in d.attributes){b[c]=undefined}return new Rs.ext.tree.PagingTreeMoreNode(Ext.apply(b,{text:this.moreNodeName,leaf:true}))}})})();(function(){Rs.ext.tree.PagingTreeMoreNodeUI=Ext.extend(Ext.tree.TreeNodeUI,{onChilrenInfoChange:function(b,c,a){if(this.rendered){this.childrenInfo.innerHTML=c}},renderElements:function(j,c,h,b){this.indentMarkup=j.parentNode?j.parentNode.ui.getChildIndent():"";var g,d=this.getHref(c.href),e=['<li class="x-tree-node">','<div ext:tree-node-id="',j.id,'" class="x-tree-node-el x-tree-node-leaf x-unselectable ',c.cls,'" unselectable="on">','<span class="x-tree-node-indent">',this.indentMarkup,"</span>",'<img alt="" src="',this.emptyIcon,'" class="x-tree-ec-icon x-tree-elbow" />','<span class="x-tree-more-node x-tree-more-node-achor" unselectable="on"></span>','<span ext:qtip="加载下一页数据" class="x-tree-more-node x-tree-more-node-icon" unselectable="on"></span>','<span ext:qtip="加载所有数据" class="x-tree-more-node x-tree-more-node-all-icon" unselectable="on"></span>','<a hidefocus="on" class="x-tree-node-anchor" href="',d,'" tabIndex="1" ',c.hrefTarget?' target="'+c.hrefTarget+'"':"",'><span unselectable="on">',j.text,"</span></a>",'<span unselectable="on">',j.childrenInfoMsg,"</span>","</div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</li>"].join("");if(b!==true&&j.nextSibling&&(g=j.nextSibling.ui.getEl())){this.wrap=Ext.DomHelper.insertHtml("beforeBegin",g,e)}else{this.wrap=Ext.DomHelper.insertHtml("beforeEnd",h,e)}this.elNode=this.wrap.childNodes[0];this.ctNode=this.wrap.childNodes[1];var f=this.elNode.childNodes;this.indentNode=f[0];this.ecNode=f[1];this.iconNode=f[2];this.moreNode=Ext.fly(f[3]);this.moreNode.on("click",function(){this.node.appendPagingNodes()},this);this.moreAllNode=Ext.fly(f[4]);this.moreAllNode.on("click",function(){this.node.appendAllPagingNodes()},this);this.anchor=f[5];this.textNode=f[5].firstChild;this.childrenInfo=f[6]}});Rs.ext.tree.PagingTreeMoreNode=function(a){Ext.apply(this,a||{});Rs.ext.tree.PagingTreeMoreNode.superclass.constructor.apply(this,arguments)};Ext.extend(Rs.ext.tree.PagingTreeMoreNode,Ext.tree.TreeNode,{isMoreNode:true,defaultUI:Rs.ext.tree.PagingTreeMoreNodeUI,childrenInfoMsg:"",displayChildrenInfo:"当前显示{0}个,共{1}个",setChildrenInfo:function(a){this.childrenInfo=a;this.childrenInfoMsg=String.format(this.displayChildrenInfo,a.childCount,a.childTotal);this.ui.onChilrenInfoChange(this,this.childrenInfoMsg)},setPagingInfo:function(a){this.pagingInfo=a},getPagingInfo:function(){return this.pagingInfo},appendPagingNodes:function(){var a=this.getOwnerTree();loader=a&&a.loader?a.loader:null;this.setPagingInfo({start:this.childrenInfo.childCount,limit:loader?loader.pageSize:20});this.onAppendPagingNodes()},appendAllPagingNodes:function(){var a=this.childrenInfo.childTotal,b=this.childrenInfo.childCount;this.setPagingInfo({start:b,limit:a-b});this.onAppendPagingNodes()},onAppendPagingNodes:function(){var a=this.parentNode;if(a){a.childrenRendered=true;a.loaded=false;a.expand(false,false)}}})})();Ext.ns("Rs.ext.data");(function(){Rs.ext.data.Proxy=function(a){this.serviceUrl={read:a.readUrl||a.url,create:a.createUrl||a.url,update:a.updateUrl||a.url,destroy:a.destroyUrl||a.url};this.serviceMethod={read:a.readMethod||"read",create:a.createMethod||"create",update:a.updateMethod||"update",destroy:a.destroyMethod||"destroy"};delete a.readUrl;delete a.readMethod;delete a.createUrl;delete a.createMethod;delete a.updateUrl;delete a.updateMethod;delete a.destroyUrl;delete a.destroyMethod;this.useAjax=!a||!a.events;Rs.ext.data.Proxy.superclass.constructor.call(this,a);var c=Ext.data.Api.actions;this.activeRequest={};for(var b in c){this.activeRequest[c[b]]=undefined}this.service=new Rs.data.Service({autoAbort:false})};Ext.extend(Rs.ext.data.Proxy,Ext.data.DataProxy,{api:{read:"read",update:"update",create:"create",destroy:"destroy"},doRequest:function(f,d,h,c,b,e,a){var g={url:this.serviceUrl[f],method:this.serviceMethod[f],request:{callback:b,scope:e,arg:a},params:{params:h||h.jsonData||h.xmlData||{}},reader:c,callback:this.createCallback(f,d),scope:this};if(this.activeRequest[f]){}this.activeRequest[f]=this.service.call(g)},createCallback:function(b,a){return function(c,e,d){this.activeRequest[b]=undefined;if(!e){if(b===Ext.data.Api.actions.read){this.fireEvent("loadexception",this,d,c)}this.fireEvent("exception",this,"response",b,d,c);d.request.callback.call(d.request.scope,null,d.request.arg,false);return}if(b===Ext.data.Api.actions.read){this.onRead(b,d,c)}else{this.onWrite(b,d,c,a)}}},onRead:function(d,g,b){var a;try{a=g.reader.read(b)}catch(f){this.fireEvent("loadexception",this,g,b,f);this.fireEvent("exception",this,"response",d,g,b,f);g.request.callback.call(g.request.scope,null,g.request.arg,false);return}if(a.success===false){this.fireEvent("loadexception",this,g,b);var c=g.reader.readResponse(d,b);this.fireEvent("exception",this,"remote",d,g,c,null)}else{this.fireEvent("load",this,g,g.request.arg)}g.request.callback.call(g.request.scope,a,g.request.arg,a.success)},onWrite:function(f,h,c,b){var a=h.reader;var d;try{d=a.readResponse(f,c)}catch(g){this.fireEvent("exception",this,"response",f,h,c,g);h.request.callback.call(h.request.scope,null,h.request.arg,false);return}if(d.success===true){this.fireEvent("write",this,f,d.data,d,b,h.request.arg)}else{this.fireEvent("exception",this,"remote",f,h,d,b)}h.request.callback.call(h.request.scope,d.data,d,d.success)},destroy:function(){if(!this.useAjax){this.conn.abort()}else{if(this.activeRequest){var b=Ext.data.Api.actions;for(var a in b){if(this.activeRequest[b[a]]){Rs.Service.abort(this.activeRequest[b[a]])}}}}Rs.ext.data.Proxy.superclass.destroy.call(this)}})})();Ext.ns("Rs.ext.data");(function(){Rs.ext.data.Reader=function(){Rs.ext.data.Reader.superclass.constructor.apply(this,arguments)};Ext.extend(Rs.ext.data.Reader,Ext.data.JsonReader,{})})();Ext.ns("Rs.ext.data");(function(){Rs.ext.data.Writer=function(){Rs.ext.data.Writer.superclass.constructor.apply(this,arguments)};Ext.extend(Rs.ext.data.Writer,Ext.data.JsonWriter,{writeAllFields:false,encodeDelete:true,render:function(b,c,a){Ext.apply(b,c);b[this.meta.root]=a}})})();Ext.ns("Rs.ext.data");(function(){Rs.ext.data.Store=function(b){var j=b.idProperty||"id",h=b.root||"data",d=b.totalProperty||"total",a=b.successProperty||"success",f=b.messageProperty||"message",g=b.proxy||new Rs.ext.data.Proxy({url:b.url||b.readUrl||b.createUrl||b.updateUrl||b.destroyUrl,readUrl:b.readUrl,readMethod:b.readMethod,createUrl:b.createUrl,createMethod:b.createMethod,updateUrl:b.updateUrl,updateMethod:b.updateMethod,destroyUrl:b.destroyUrl,destroyMethod:b.destroyMethod}),c=b.writer||new Rs.ext.data.Writer({idProperty:j,listful:true}),e=b.reader||new Rs.ext.data.Reader({idProperty:j,root:h,totalProperty:d,successProperty:a,messageProperty:f},b.fields?Ext.data.Record.create(b.fields):undefined);Rs.ext.data.Store.superclass.constructor.call(this,Ext.apply(b,{proxy:g,writer:c,reader:e}));Ext.apply(this.baseParams,{metaData:Ext.apply({paramNames:this.paramNames},this.reader.meta)})};Ext.extend(Rs.ext.data.Store,Ext.data.Store,{remoteSort:true,autoSave:false,pruneModifiedRecords:true,load:function(c){c=Ext.apply({},c);this.storeOptions(c);if(this.sortInfo&&this.remoteSort){var b=this.paramNames,a={};a[b.sort]=this.sortInfo.field;a[b.dir]=this.sortInfo.direction;Ext.apply(this.baseParams.metaData,{sortInfo:a})}try{return this.execute("read",null,c)}catch(d){this.handleException(d);return false}},singleSort:function(f,c){var e=this.fields.get(f);if(!e){return false}var b=e.name,a=this.sortInfo||null,d=this.sortToggle?this.sortToggle[b]:null;if(!c){if(a&&a.field==b){c=(this.sortToggle[b]||"ASC").toggle("ASC","DESC")}else{c=e.sortDir}}this.sortToggle[b]=c;this.sortInfo={field:b,direction:c};this.hasMultiSort=false;if(this.remoteSort){if(!this.load(this.lastOptions)){}}else{this.applySort();this.fireEvent("datachanged",this)}return true}})})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.data.GroupingStore=function(d){d=d||{};this.hasMultiSort=true;this.multiSortInfo=this.multiSortInfo||{sorters:[]};var e=this.multiSortInfo.sorters,c=d.groupField||this.groupField,b=d.sortInfo||this.sortInfo,a=d.groupDir||this.groupDir;if(c){e.push({field:c,direction:a})}if(b){e.push(b)}Rs.ext.data.GroupingStore.superclass.constructor.call(this,d);this.addEvents("groupchange");this.applyGroupField()};Ext.extend(Rs.ext.data.GroupingStore,Rs.ext.data.Store,{remoteGroup:true,groupOnSort:false,groupDir:"ASC",clearGrouping:function(){this.groupField=false;if(this.remoteGroup){if(this.baseParams){delete this.baseParams.groupBy;delete this.baseParams.groupDir}var a=this.lastOptions;if(a&&a.params){delete a.params.groupBy;delete a.params.groupDir}this.reload()}else{this.sort();this.fireEvent("datachanged",this)}},groupBy:function(e,a,d){d=d?(String(d).toUpperCase()=="DESC"?"DESC":"ASC"):this.groupDir;if(this.groupField==e&&this.groupDir==d&&!a){return}var c=this.multiSortInfo.sorters;if(c.length>0&&c[0].field==this.groupField){c.shift()}this.groupField=e;this.groupDir=d;this.applyGroupField();var b=function(){this.fireEvent("groupchange",this,this.getGroupState())};if(this.groupOnSort){this.sort(e,d);b.call(this);return}if(this.remoteGroup){this.on("load",b,this,{single:true});this.reload()}else{this.sort(c);b.call(this)}},sort:function(g,c){if(this.remoteSort){return Ext.data.GroupingStore.superclass.sort.call(this,g,c)}var f=[];if(Ext.isArray(arguments[0])){f=arguments[0]}else{if(g==undefined){f=this.sortInfo?[this.sortInfo]:[]}else{var e=this.fields.get(g);if(!e){return false}var b=e.name,a=this.sortInfo||null,d=this.sortToggle?this.sortToggle[b]:null;if(!c){if(a&&a.field==b){c=(this.sortToggle[b]||"ASC").toggle("ASC","DESC")}else{c=e.sortDir}}this.sortToggle[b]=c;this.sortInfo={field:b,direction:c};f=[this.sortInfo]}}if(this.groupField){f.unshift({direction:this.groupDir,field:this.groupField})}return this.multiSort.call(this,f,c)},applyGroupField:function(){if(this.remoteGroup){if(!this.baseParams){this.baseParams={}}var a={groupBy:this.groupField,groupDir:this.groupDir};Ext.apply(this.baseParams.metaData,{groupInfo:a});var b=this.lastOptions;if(b&&b.params){b.params.groupDir=this.groupDir;delete b.params.groupBy}}},applyGrouping:function(a){if(this.groupField!==false){this.groupBy(this.groupField,true,this.groupDir);return true}else{if(a===true){this.fireEvent("datachanged",this)}return false}},getGroupState:function(){return this.groupOnSort&&this.groupField!==false?(this.sortInfo?this.sortInfo.field:undefined):this.groupField}});Ext.reg("rs-ext-groupingstore",Rs.ext.data.GroupingStore)})();Ext.ns("Rs.ext.data");(function(){Rs.ext.data.GeneralselStore=function(d){d=d||{};var a=d.progCode,c=d.progCondition,e=d.dataCompany;if(Ext.isEmpty(a,false)){throw"progCode is null"}var b=d.url||Rs.BASE_GENERALSEL_PATH||"/rsc/rsclient/generalsel",f=Ext.apply(d.baseParams||{},{progCode:a,dataCompany:e});Rs.ext.data.GeneralselStore.superclass.constructor.call(this,Ext.apply(d,{url:b,baseParams:f,baseProgCondition:c}))};Ext.extend(Rs.ext.data.GeneralselStore,Rs.ext.data.Store,{loadMetaData:true,load:function(a){a=Ext.apply({},a);if(!a.params){a.params={}}Ext.apply(a.params,{progCondition:this.joinProgCondition(a.params)});Ext.apply(this.baseParams.metaData,{loadMetaData:this.loadMetaData===true});Rs.ext.data.GeneralselStore.superclass.load.apply(this,arguments)},joinProgCondition:function(e){var f=this.baseProgCondition,b=e?e.progCondition:undefined;if(Ext.isEmpty(b,false)){return f||""}else{if(Ext.isEmpty(f,false)){return b||""}else{var a=this.splitProgCondition(b),g=this.splitProgCondition(f),h=[],c,j=Ext.apply(a||{},g);for(var d in j){c=j[d];if(c&&!Ext.isEmpty(c,false)){h.push(j[d])}}if(h.length>0){return h.join(" AND ")}}}},splitProgCondition:function(g){var d={},h,f,e,k,j,a=new Array();for(f=0,e=g.length;f<e;f++){if(g.substring(f,f+3).toUpperCase()=="AND"){if(a.length>0){this.buildConditionBlock(d,a.join(""));a=new Array()}f=f+3}else{k=g.charAt(f);if(k=="("){if(a.length>0){this.buildConditionBlock(d,a.join(""));a=new Array()}j=0;while(true&&f<e){k=g.charAt(f++);a[a.length]=k;(k=="(")?(j++):null;(k==")")?(j--):null;if(j==0){break}}this.buildConditionBlock(d,a.join(""));a=new Array()}else{a[a.length]=k}}}if(a.length>0){this.buildConditionBlock(d,a.join(""))}return d},buildConditionBlock:function(a,c){var b=c.replace(/\s/gi,"");a[b]=c;return a},loadRecords:function(c,a,b){Rs.ext.data.GeneralselStore.superclass.loadRecords.apply(this,arguments);this.loadMetaData=false},setProgCode:function(a,b){if(Ext.isEmpty(a,false)){Rs.error("progCode is empty!")}this.progCode=a;this.baseProgCondition=b;Ext.apply(this.baseParams||{},{progCode:this.progCode});delete this.lastOptions;this.loadMetaData=true},getProgCode:function(){return this.progCode},getProgCondition:function(){return this.progCondition||""},getDataCompany:function(){return this.dataCompany},setDataCompany:function(a){if(Ext.isEmpty(a,false)){Rs.error("dataCompany is empty!")}this.dataCompany=a;Ext.apply(this.baseParams||{},{dataCompany:this.dataCompany});delete this.lastOptions;this.loadMetaData=true}})})();Ext.namespace("Rs.ext.grid");(function(){Rs.ext.grid.SliderPagingToolbar=function(a){Rs.ext.grid.SliderPagingToolbar.superclass.constructor.call(this,a)};Ext.extend(Rs.ext.grid.SliderPagingToolbar,Ext.PagingToolbar,{minPageSize:10,maxPageSize:100,pageSizeIncrement:10,pageSize:20,paramNames:{start:"start",limit:"limit"},beforePageText:"第",afterPageText:"页(共{0}页)",firstText:"第一页",lastText:"最后一页",nextText:"下一页",prevText:"上一页",refreshText:"刷新",hasSlider:true,initComponent:function(){Rs.ext.grid.SliderPagingToolbar.superclass.initComponent.apply(this,arguments);if(this.hasSlider===true){this.sliderField=new Ext.form.SliderField({width:100,animate:true,increment:this.pageSizeIncrement,minValue:this.minPageSize,maxValue:this.maxPageSize,tipText:function(c){return"每页显示"+String(c.value)+"项"}});var b=this.items.indexOf(this.refresh);var a=new Ext.Toolbar.Separator();this.items.insert(b+1,a);this.items.insert(b+2,this.sliderField);this.sliderField.setValue(this.pageSize,false);this.sliderField.slider.on("changecomplete",this.onPageSizeChanged,this)}this.setPageSizeTask=new Ext.util.DelayedTask(this.setPageSize,this)},onPageSizeChanged:function(c,b,a){this.pageSize=b;this.setPageSizeTask.delay(50);if(a){a.el.setStyle("z-index",0)}},setPageSize:function(){this.cursor=Math.floor(this.cursor/this.pageSize)*this.pageSize;var a=this.getParams(),b=this.store.baseParams.metaData||{};b[a.limit]=this.pageSize;Ext.apply(this.store.baseParams,{metaData:b});this.doLoad(this.cursor)},bindStore:function(a,c){if(a){var b=this.getParams(),d=a.baseParams.metaData||{};d[b.limit]=this.pageSize;Ext.apply(a.baseParams,{metaData:d})}Rs.ext.grid.SliderPagingToolbar.superclass.bindStore.apply(this,arguments)},onLoad:function(a,e,j){if(!this.rendered){this.dsLoaded=[a,e,j];return}var b=this.getParams(),f=a.baseParams.metaData;this.cursor=(f&&f[b.start])?f[b.start]:0;var h=this.getPageData(),c=h.activePage,g=h.pages;this.afterTextItem.setText(String.format(this.afterPageText,h.pages));this.inputItem.setValue(c);this.first.setDisabled(c==1);this.prev.setDisabled(c==1);this.next.setDisabled(c==g);this.last.setDisabled(c==g);this.refresh.enable();this.updateInfo();this.fireEvent("change",this,h)},doLoad:function(d){var a=this.getParams(),b=this.store.baseParams.metaData||{};b[a.start]=d;Ext.apply(this.store.baseParams,{metaData:b});var c=this.store.lastOptions?this.store.lastOptions.params||{}:{};if(this.fireEvent("beforechange",this,c)!==false){this.store.load({params:c})}},setStart:function(c){var a=this.getParams(),b=this.store.baseParams.metaData||{};b[a.start]=Ext.isNumber(c)?c:0;Ext.apply(this.store.baseParams,{metaData:b})},updateInfo:function(){if(this.displayItem){var a=this.store.getCount();var c=this.getPageData();if(c&&c.activePage>c.pages&&a==0){this.doLoad((c.pages-1)*this.pageSize);return}var b=a==0?this.emptyMsg:String.format(this.displayMsg,this.cursor+1,this.cursor+a,this.store.getTotalCount());this.displayItem.setText(b)}}});Ext.ComponentMgr.registerType("rs-ext-sliderpagingtoolbar",Rs.ext.grid.SliderPagingToolbar)})();(function(){Rs.ext.grid.RowCellSelectionModel=function(a){Rs.ext.grid.RowCellSelectionModel.superclass.constructor.call(this,a);this.cellselection=null;this.addEvents("beforecellselect","cellselect","cellselectionchange")};Ext.extend(Rs.ext.grid.RowCellSelectionModel,Ext.grid.RowSelectionModel,{initEvents:function(){Rs.ext.grid.RowCellSelectionModel.superclass.initEvents.apply(this,arguments);this.grid.on("cellmousedown",this.handleCellMouseDown,this);this.grid.on(Ext.EventManager.getKeyEvent(),this.handleKeyDown,this);this.grid.getView().on({scope:this,refresh:this.onViewChange,rowupdated:this.onRowUpdated,beforerowremoved:this.clearCellSelections,beforerowsinserted:this.clearCellSelections});if(this.grid.isEditor){this.grid.on("beforeedit",this.beforeEdit,this)}},beforeEdit:function(a){this.select(a.row,a.column,false,true,a.record)},onViewChange:function(){this.clearCellSelections(true)},onRowUpdated:function(a,b,c){if(this.cellselection&&this.cellselection.record==c){a.onCellSelect(b,this.cellselection.cell[1])}},handleCellMouseDown:function(b,d,a,c){if(c.button!==0||this.isLocked()){return}this.select(d,a)},select:function(f,c,b,e,d){if(this.fireEvent("beforecellselect",this,f,c)!==false){this.clearCellSelections();d=d||this.grid.store.getAt(f);this.cellselection={record:d,cell:[f,c]};if(!b){var a=this.grid.getView();a.onCellSelect(f,c);if(e!==true){a.focusCell(f,c)}}this.fireEvent("cellselect",this,f,c);this.fireEvent("cellselectionchange",this,this.cellselection)}},clearCellSelections:function(b){var a=this.cellselection;if(a){if(b!==true){this.grid.view.onCellDeselect(a.cell[0],a.cell[1])}this.cellselection=null;this.fireEvent("cellselectionchange",this,null)}},getSelectedCell:function(){return this.cellselection?this.cellselection.cell:null},hasCellSelection:function(){return this.cellselection?true:false},isSelectable:function(c,b,a){return !a.isHidden(b)},handleKeyDown:function(n){if(n.getKey()==n.C&&n.ctrlKey===true){var j=this.grid,m=this.cellselection,q,l,a;if(j&&m){q=j.getColumnModel();o=q.getColumnAt(m.cell[1]);l=o?o.dataIndex:undefined;a=m.record;if(a&&l){Rs.Clipboard.setData(a.get(l))}}return}if(!n.isNavKeyPress()){return}var d=n.getKey(),j=this.grid,v=this.cellselection,b=this,p=function(f,c,e){return j.walkCells(f,c,e,j.isEditor&&j.editing?b.acceptsNav:b.isSelectable,b)},u,h,a,o,t;switch(d){case n.ESC:case n.PAGE_UP:case n.PAGE_DOWN:break;default:n.stopEvent();break}if(!v){u=p(0,0,1);if(u){this.select(u[0],u[1])}return}u=v.cell;a=u[0];o=u[1];switch(d){case n.TAB:if(n.shiftKey){h=p(a,o-1,-1)}else{h=p(a,o+1,1)}break;case n.DOWN:h=p(a+1,o,1);break;case n.UP:h=p(a-1,o,-1);break;case n.RIGHT:h=p(a,o+1,1);break;case n.LEFT:h=p(a,o-1,-1);break;case n.ENTER:if(j.isEditor&&!j.editing){j.startEditing(a,o);return}break}if(h){a=h[0];o=h[1];this.select(a,o);if(j.isEditor&&j.editing){t=j.activeEditor;if(t&&t.field.triggerBlur){t.field.triggerBlur()}j.startEditing(a,o)}}}})})();(function(){Rs.ext.grid.CheckboxCellSelectionModel=function(a){Rs.ext.grid.CheckboxCellSelectionModel.superclass.constructor.call(this,a);if(this.checkOnly){this.handleMouseDown=Ext.emptyFn}};Ext.extend(Rs.ext.grid.CheckboxCellSelectionModel,Rs.ext.grid.RowCellSelectionModel,{checkOnly:true,header:'<div class="x-grid3-hd-checker">&#160;</div>',width:20,sortable:false,menuDisabled:true,fixed:true,hideable:false,dataIndex:"",id:"checker",isColumn:true,initEvents:function(){Rs.ext.grid.CheckboxCellSelectionModel.superclass.initEvents.call(this);this.grid.on("render",function(){Ext.fly(this.grid.getView().innerHd).on("mousedown",this.onHdMouseDown,this)},this)},processEvent:function(b,d,c,f,a){if(b=="mousedown"){this.onMouseDown(d,d.getTarget());return false}else{return Ext.grid.Column.prototype.processEvent.apply(this,arguments)}},onMouseDown:function(c,b){if(c.button===0&&b.className=="x-grid3-row-checker"){c.stopEvent();var d=c.getTarget(".x-grid3-row");if(d){var a=d.rowIndex;if(this.isSelected(a)){this.deselectRow(a)}else{this.selectRow(a,true);this.grid.getView().focusRow(a)}}}},onHdMouseDown:function(c,a){if(a.className=="x-grid3-hd-checker"){c.stopEvent();var b=Ext.fly(a.parentNode);var d=b.hasClass("x-grid3-hd-checker-on");if(d){b.removeClass("x-grid3-hd-checker-on");this.clearSelections()}else{b.addClass("x-grid3-hd-checker-on");this.selectAll()}}},renderer:function(b,c,a){return'<div class="x-grid3-row-checker">&#160;</div>'},onEditorSelect:function(b,a){if(a!=b&&!this.checkOnly){this.selectRow(b)}},isSelectable:function(c,b,a){if(a.getColumnAt(b) instanceof Ext.grid.CheckboxSelectionModel){return false}else{return !a.isHidden(b)}}})})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.GridSummary=function(a){Ext.apply(this,a)};Ext.extend(Rs.ext.grid.GridSummary,Ext.util.Observable,{init:function(b){this.grid=b;this.cm=b.getColumnModel();this.view=b.getView();var a=this.view;a.onLayout=this.onLayout;a.afterMethod("render",this.refreshSummary,this);a.afterMethod("refresh",this.refreshSummary,this);a.afterMethod("setSumValue",this.test,this);a.afterMethod("syncScroll",this.syncSummaryScroll,this);a.afterMethod("onColumnWidthUpdated",this.doWidth,this);a.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);a.afterMethod("onColumnHiddenUpdated",this.doHidden,this);a.afterMethod("onUpdate",this.refreshSummary,this);a.afterMethod("onRemove",this.refreshSummary,this);b.store.on("add",this.refreshSummary,this);b.store.on("remove",this.refreshSummary,this);b.store.on("clear",this.refreshSummary,this);if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row x-grid3-gridsummary-row-offset">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table>","</div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on">{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},calculate:function(e,l){var h={},d={},n={},a,p,m=this.cm.config,b;for(var g=0,k=l.length;g<k;g++){p=l[g];b=m[g];for(var f=0,q=e.length;f<q;f++){a=e[f];if(b&&b.summaryType){var o=b.summaryType;if(typeof o==="object"){o=b.summaryType.type}if(!h[p.name]){h[p.name]={}}h[p.name][o]=Rs.ext.grid.GridSummary.Calculations[o](h[p.name][o]||0,a,p.name,h[p.name][o],h[p.name])}}}return h},onLayout:function(a,b){if("number"!=Ext.type(b)){return}if(!this.grid.getGridEl().hasClass("x-grid-hide-gridsummary")){this.scroller.setHeight(b-this.summary.getHeight())}},syncSummaryScroll:function(){var a=this.view.scroller.dom;if(this.view.summaryWrap){this.view.summaryWrap.dom.scrollLeft=a.scrollLeft;this.view.summaryWrap.dom.scrollLeft=a.scrollLeft}},doWidth:function(c,a,b){if(this.view.summary){var d=this.view.summary.dom;d.firstChild.style.width=b;d.firstChild.rows[0].childNodes[c].style.width=a}},doAllWidths:function(a,b){var d=this.view.summary.dom,e=a.length;d.firstChild.style.width=b;cells=d.firstChild.rows[0].childNodes;for(var c=0;c<e;c++){cells[c].style.width=a[c]}},doHidden:function(b,d,a){var c=this.view.summary.dom;var e=d?"none":"";c.firstChild.style.width=a;c.firstChild.rows[0].childNodes[b].style.display=e},putSumInfo:null,setSumValue:function(b){var f=this.view.getColumnData();var d=[],j,h={},g=f.length-1;for(var e=0,a=f.length;e<a;e++){j=f[e];h.id=j.id;h.style=j.style;h.css=e==0?"x-grid3-cell-first ":(e==g?"x-grid3-cell-last ":"");if(b&&b[j.name]){h.value=b[j.name]}else{h.value=""}if(h.value==undefined||h.value===""){h.value=" "}d[d.length]=this.cellTpl.apply(h)}if(!this.view.summaryWrap){this.view.summaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}else{this.view.summary.remove()}this.putSumInfo=this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:d.join("")});this.view.summary=this.view.summaryWrap.insertHtml("afterbegin",this.putSumInfo,true)},refreshSumValue:function(){if(!this.view.summaryWrap){this.view.summaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}else{this.view.summary.remove()}this.view.summary=this.view.summaryWrap.insertHtml("afterbegin",this.putSumInfo,true)},renderSummary:function(d,h){h=h||this.view.getColumnData();var j=this.cm.config;var e=[],k,a={},b,l=h.length-1;for(var f=0,g=h.length;f<g;f++){k=h[f];b=j[f];a.id=k.id;a.style=k.style;a.css=f==0?"x-grid3-cell-first ":(f==l?"x-grid3-cell-last ":"");a.value=this.renderResultValue(b,a,d,k);if(a.value==undefined||a.value===""){a.value="&#160;"}e[e.length]=this.cellTpl.apply(a)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:e.join("")})},renderResultValue:function(b,d,f,h){if(b.summaryType||b.summaryRenderer){var g=b.summaryType;var e=2;if(typeof g==="object"){g=b.summaryType.type;e=b.summaryType.decimalPrecision}var a=Rs.ext.grid.GridSummary.SummaryRenderer[g];if(f.data[h.name]){return(b.summaryRenderer||a||h.renderer)(f.data[h.name][g],d,f,e)}else{return(b.summaryRenderer||a||h.renderer)(f.data[h.name],d,f,e)}}else{return""}},refreshSummary:function(){if(this.putSumInfo){this.refreshSumValue(this.putSumInfo);return}var d=this.grid,f=d.store;var c=this.view.getColumnData();var a=f.getRange();var e=this.calculate(a,c);var b=this.renderSummary({data:e},c);if(!this.view.summaryWrap){this.view.summaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}else{this.view.summary.remove()}this.view.summary=this.view.summaryWrap.insertHtml("afterbegin",b,true)},toggleSummary:function(b){var a=this.grid.getGridEl();if(a){if(b===undefined){b=a.hasClass("x-grid-hide-gridsummary")}a[b?"removeClass":"addClass"]("x-grid-hide-gridsummary");this.view.layout()}},getSummaryNode:function(){return this.view.summary}});Rs.ext.grid.GridSummary.Calculations={sum:function(b,a,c){return b+Ext.num(a.data[c],0)},count:function(b,a,d,c){return c?++c:(c=1)},max:function(c,b,e,d){var c=b.data[e];var a=(d===undefined)||(d==0)?(d=c):d;return Math.max(c,a)},min:function(b,a,e,d){var b=parseFloat(a.data[e]);var c=(d===undefined)||(d==0)?(d=b):d;return Math.min(b,c)},average:function(b,a,f,e,h){var g=h.count_avg?++h.count_avg:(h.count_avg=1);var d=(h.total=(parseFloat(h.total||0)+(Ext.num(a.data[f]||0))));return d===0?0:d/g}};Rs.ext.grid.GridSummary.SummaryRenderer={count:function(a,d,b,c){return a?"共"+Rs.ext.form.NumberField.rendererMillesimalMark(a,0)+"条":""},sum:function(a,d,b,c){return a?"合计值:"+Rs.ext.form.NumberField.rendererMillesimalMark(a,c):""},max:function(a,d,b,c){return a?"最大值:"+Rs.ext.form.NumberField.rendererMillesimalMark(a,c):""},min:function(a,d,b,c){return a?"最小值:"+Rs.ext.form.NumberField.rendererMillesimalMark(a,c):""},average:function(a,d,b,c){return a?"平均值:"+Rs.ext.form.NumberField.rendererMillesimalMark(a,c):""}}})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.GridPageSummary=function(a){Ext.apply(this,a)};Ext.extend(Rs.ext.grid.GridPageSummary,Ext.util.Observable,{init:function(b){this.grid=b;this.cm=b.getColumnModel();this.view=b.getView();var a=this.view;a.doRender=this.doRender.createDelegate(this);a.afterMethod("onUpdate",this.refreshPageSummary,this);a.afterMethod("onRemove",this.refreshPageSummary,this);b.store.on("add",this.refreshPageSummary,this);b.store.on("remove",this.refreshPageSummary,this);b.store.on("clear",this.refreshPageSummary,this);if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}" tabIndex="0" {cellAttr}>','<div class="x-grid3-pagesummary-cell-inner x-grid3-cell-inner x-grid3-col-{id}" unselectable="on" {attr}>{value}</div>',"</td>")}this.cellTpl.compile()},doRender:function(e,v,m,a,r,t){var h=this.view.templates,d=h.cell,y=h.row,o=r-1,b="width:"+this.view.getTotalWidth()+";",k=[],l=[],n={tstyle:b},q={},w=v.length,x,g,f,u,s,p;for(s=0;s<w;s++){f=v[s];l=[];p=s+a;for(u=0;u<r;u++){g=e[u];q.id=g.id;q.css=u===0?"x-grid3-cell-first ":(u==o?"x-grid3-cell-last ":"");q.attr=q.cellAttr="";q.style=g.style;q.value=g.renderer.call(g.scope,f.data[g.name],q,f,p,u,m);if(Ext.isEmpty(q.value)){q.value="&#160;"}if(this.markDirty&&f.dirty&&typeof f.modified[g.name]!="undefined"){q.css+=" x-grid3-dirty-cell"}l[l.length]=d.apply(q)}x=[];if(t&&((p+1)%2===0)){x[0]="x-grid3-row-alt"}if(f.dirty){x[1]=" x-grid3-dirty-row"}n.cols=r;if(this.getRowClass){x[2]=this.view.getRowClass(f,p,n,m)}n.alt=x.join(" ");n.cells=l.join("");k[k.length]=y.apply(n)}var c=Ext.get(this.view.mainBody.dom.childNodes[this.view.mainBody.dom.childNodes.length-1]);if(c&&c.hasClass&&c.hasClass("x-grid3-pagesummary-row")){c.remove()}k[k.length]=this.refreshSummary();return k.join("")},calculate:function(g,n){var l={},f={},p={},a,s,o=this.cm.config,d,b;var e=this.addline?this.addline:0;for(var k=0,m=n.length;k<m;k++){s=n[k];d=o[k];for(var h=0,t=g.length;h<t;h++){a=g[h];if(d&&d.summaryType){var q=d.summaryType;if(typeof q==="object"){q=d.summaryType.type}if(!l[s.name]){l[s.name]={}}l[s.name][q]=Rs.ext.grid.GridSummary.Calculations[q](l[s.name][q]||0,a,s.name,l[s.name][q],l[s.name])}}}return l},onLayout:function(a,b){if("number"!=Ext.type(b)){return}if(!this.grid.getGridEl().hasClass("x-grid-hide-gridsummary")){this.scroller.setHeight(b-this.summary.getHeight())}},syncSummaryScroll:function(){var a=this.view.scroller.dom;this.view.summaryWrap.dom.scrollLeft=a.scrollLeft;this.view.summaryWrap.dom.scrollLeft=a.scrollLeft},doWidth:function(c,a,b){var d=this.view.summary.dom;d.firstChild.style.width=b;d.firstChild.rows[0].childNodes[c].style.width=a},doAllWidths:function(a,b){var d=this.view.summary.dom,e=a.length;d.firstChild.style.width=b;cells=d.firstChild.rows[0].childNodes;for(var c=0;c<e;c++){cells[c].style.width=a[c]}},doHidden:function(b,d,a){var c=this.view.summary.dom;var e=d?"none":"";c.firstChild.style.width=a;c.firstChild.rows[0].childNodes[b].style.display=e},putSumInfo:null,refreshSumValue:function(){if(!this.view.summaryWrap){this.view.summaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}else{this.view.summary.remove()}this.view.summary=this.view.summaryWrap.insertHtml("afterbegin",this.putSumInfo,true)},renderSummary:function(f,l){l=l||this.view.getColumnData();var m=this.cm.config;var g=[],r,b={},d,s=l.length-1,e={},n="width:"+this.view.getTotalWidth()+";",j={tstyle:n};for(var h=0,k=l.length;h<k;h++){r=l[h];d=m[h];b.id=r.id;b.style=r.style;b.css=h==0?"x-grid3-cell-first ":(h==s?"x-grid3-cell-last ":"");var u=d.summaryType;if(u||d.summaryRenderer){var q=d.summaryType;var t=2;if(typeof q==="object"){q=d.summaryType.type;t=d.summaryType.decimalPrecision}var a=Rs.ext.grid.GridPageSummary.SummaryRenderer[q];b.value=(d.summaryRenderer||a||r.renderer)(f.data[r.name][q],b,f,t)}else{b.value=""}if(b.value==undefined||b.value===""){b.value="&#160;"}g[g.length]=this.cellTpl.apply(b)}j.alt="x-grid3-pagesummary-row";j.cells=g.join("");return j},refreshSummary:function(){if(this.putSumInfo){return this.putSumInfo}var d=this.grid,f=d.store;var c=this.view.getColumnData();var a=f.getRange();var e=this.calculate(a,c);var b=this.renderSummary({data:e},c);return this.pageSummary=this.view.templates.row.apply(b)},refreshPageSummary:function(){if(this.putSumInfo){return this.putSumInfo}var d=this.grid,f=d.store;var c=this.view.getColumnData();var a=f.getRange();if(this.pageSummary){var e=this.calculate(a,c);var b=this.renderSummary({data:e},c);var h=this.view.mainBody.dom.childNodes[this.view.mainBody.dom.childNodes.length-1];h.innerHTML=this.view.templates.rowInner.apply(b)}},toggleSummary:function(b){var a=this.grid.getGridEl();if(a){if(b===undefined){b=a.hasClass("x-grid-hide-gridsummary")}a[b?"removeClass":"addClass"]("x-grid-hide-gridsummary");this.view.layout()}},getSummaryNode:function(){return this.view.summary}});Rs.ext.grid.GridPageSummary.SummaryRenderer={count:function(a,d,b,c){return a?"共"+Rs.ext.form.NumberField.rendererMillesimalMark(a,0)+"条":""},sum:function(a,d,b,c){return a?"合计值:"+Rs.ext.form.NumberField.rendererMillesimalMark(a,c):""},max:function(a,d,b,c){return a?"最大值:"+Rs.ext.form.NumberField.rendererMillesimalMark(a,c):""},min:function(a,d,b,c){return a?"最小值:"+Rs.ext.form.NumberField.rendererMillesimalMark(a,c):""},average:function(a,d,b,c){return a?"平均值:"+Rs.ext.form.NumberField.rendererMillesimalMark(a,c):""}}})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.HybridGridSummary=function(a){Rs.ext.grid.HybridGridSummary.superclass.constructor.apply(this,arguments)};Ext.extend(Rs.ext.grid.HybridGridSummary,Rs.ext.grid.GridSummary,{init:function(a){Rs.ext.grid.HybridGridSummary.superclass.init.apply(this,arguments)},calculate:function(a,b){var c=this.getSummaryData();return c||Rs.ext.grid.HybridGridSummary.superclass.calculate.call(this,a,b)},getSummaryData:function(){var b=this.grid.getStore().reader,d=b.jsonData,a=b.recordType.prototype.fields,c;if(d&&d.summaryData){c=d.summaryData;if(c){return this.extractValues(c,a.items,a.length)}}return null},extractValues:function(b,h,g){var c=this.grid.getStore().reader;var e=this.cm.config;var d,l={};for(var a=0;a<g;a++){d=h[a];var k=c.ef[a](b);l[d.name]=d.convert((k!==undefined)?k:d.defaultValue,b)}return l},updateSummaryData:function(c,b){var a=this.grid.getStore().reader.jsonData;if(!a.summaryData){a.summaryData={}}a.summaryData=c;if(!b){this.refreshSummary()}},renderResultValue:function(d,e,g,j){if(d.summaryType||d.summaryRenderer){var h=d.summaryType;var f=2;if(typeof h==="object"){h=d.summaryType.type;f=d.summaryType.decimalPrecision}var a=Rs.ext.grid.HybridGridSummary.SummaryRenderer[h];var b;if(g.data[j.name]){b=(d.summaryRenderer||a||j.renderer)(g.data[j.name][h],e,g,f)}else{b=(d.summaryRenderer||a||j.renderer)(g.data[j.name],e,g,f)}if(b.search("null")>-1){return""}else{if(b.search("共:0条")>-1){return""}}return b}else{return""}},refreshSummary:function(){if(this.putSumInfo){this.refreshSumValue(this.putSumInfo);return}var d=this.grid,f=d.store;var c=this.view.getColumnData();var a=f.getRange();var e=this.calculate(a,c);var b=this.renderSummary({data:e},c);if(!this.view.totalsummaryWrap){this.view.totalsummaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}else{this.view.totalsummary.remove()}this.view.totalsummary=this.view.totalsummaryWrap.insertHtml("afterbegin",b,true)},refreshSumValue:function(){if(!this.view.totalsummaryWrap){this.view.totalsummaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}else{this.view.totalsummary.remove()}this.view.totalsummary=this.view.summaryWrap.insertHtml("afterbegin",this.putSumInfo,true)},setSumValue:function(b){var f=this.view.getColumnData();var d=[],j,h={},g=f.length-1;for(var e=0,a=f.length;e<a;e++){j=f[e];h.id=j.id;h.style=j.style;h.css=e==0?"x-grid3-cell-first ":(e==g?"x-grid3-cell-last ":"");if(b&&b[j.name]){h.value=b[j.name]}else{h.value=""}if(h.value==undefined||h.value===""){h.value=" "}d[d.length]=this.cellTpl.apply(h)}if(!this.view.totalsummaryWrap){this.view.totalsummaryWrap=Ext.DomHelper.insertAfter(this.view.scroller,{tag:"div",cls:"x-grid3-gridsummary-row-inner"},true)}else{this.view.totalsummary.remove()}this.putSumInfo=this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:d.join("")});this.view.totalsummary=this.view.totalsummaryWrap.insertHtml("afterbegin",this.putSumInfo,true)},onLayout:function(a,b){if("number"!=Ext.type(b)){return}if(!this.grid.getGridEl().hasClass("x-grid-hide-gridsummary")){this.scroller.setHeight(b-(this.summary?this.summary.getHeight():0)-this.totalsummary.getHeight())}},syncSummaryScroll:function(){Rs.ext.grid.HybridGridSummary.superclass.syncSummaryScroll.apply(this,arguments);var a=this.view.scroller.dom;if(this.view.totalsummaryWrap){this.view.totalsummaryWrap.dom.scrollLeft=a.scrollLeft;this.view.totalsummaryWrap.dom.scrollLeft=a.scrollLeft}},doWidth:function(c,a,b){Rs.ext.grid.HybridGridSummary.superclass.doWidth.apply(this,arguments);if(this.view.totalsummary){var d=this.view.totalsummary.dom;d.firstChild.style.width=b;d.firstChild.rows[0].childNodes[c].style.width=a}},doAllWidths:function(a,b){var d=this.view.totalsummary.dom,e=a.length;d.firstChild.style.width=b;cells=d.firstChild.rows[0].childNodes;for(var c=0;c<e;c++){cells[c].style.width=a[c]}},doHidden:function(b,d,a){var c=this.view.totalsummary.dom;var e=d?"none":"";c.firstChild.style.width=a;c.firstChild.rows[0].childNodes[b].style.display=e}});Rs.ext.grid.HybridGridSummary.SummaryRenderer={count:function(a,d,b,c){return a?"共"+Rs.ext.form.NumberField.rendererMillesimalMark(a,0)+"条":""},sum:function(a,d,b,c){return a?"合计值:"+Rs.ext.form.NumberField.rendererMillesimalMark(a,c):""},max:function(a,d,b,c){return a?"最大值:"+Rs.ext.form.NumberField.rendererMillesimalMark(a,c):""},min:function(a,d,b,c){return a?"最小值:"+Rs.ext.form.NumberField.rendererMillesimalMark(a,c):""},average:function(a,d,b,c){return a?"平均值:"+Rs.ext.form.NumberField.rendererMillesimalMark(a,c):""}}})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.GroupSummary=Ext.extend(Ext.util.Observable,{constructor:function(a){Ext.apply(this,a);Rs.ext.grid.GroupSummary.superclass.constructor.call(this)},init:function(b){this.grid=b;var a=this.view=b.getView();a.doGroupEnd=this.doGroupEnd.createDelegate(this);a.afterMethod("onColumnWidthUpdated",this.doWidth,this);a.afterMethod("onAllColumnWidthsUpdated",this.doAllWidths,this);a.afterMethod("onColumnHiddenUpdated",this.doHidden,this);a.afterMethod("onUpdate",this.doUpdate,this);a.afterMethod("onRemove",this.doRemove,this);if(!this.rowTpl){this.rowTpl=new Ext.Template('<div class="x-grid3-summary-row" style="{tstyle}">','<table class="x-grid3-summary-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr></tbody>","</table></div>");this.rowTpl.disableFormats=true}this.rowTpl.compile();if(!this.cellTpl){this.cellTpl=new Ext.Template('<td class="x-grid3-col x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div class="x-grid3-cell-inner x-grid3-col-{id}" unselectable="on">{value}</div>',"</td>");this.cellTpl.disableFormats=true}this.cellTpl.compile()},toggleSummaries:function(b){var a=this.grid.getGridEl();if(a){if(b===undefined){b=a.hasClass("x-grid-hide-summary")}a[b?"removeClass":"addClass"]("x-grid-hide-summary")}},renderSummary:function(d,h){h=h||this.view.getColumnData();var j=this.grid.getColumnModel().config,e=[],k,a={},b,l=h.length-1;for(var f=0,g=h.length;f<g;f++){k=h[f];b=j[f];a.id=k.id;a.style=k.style;a.css=f==0?"x-grid3-cell-first ":(f==l?"x-grid3-cell-last ":"");if(b.summaryType||b.summaryRenderer){a.value=(b.summaryRenderer||k.renderer)(d.data[k.name],a,d)}else{a.value=""}if(a.value==undefined||a.value===""){a.value="&#160;"}e[e.length]=this.cellTpl.apply(a)}return this.rowTpl.apply({tstyle:"width:"+this.view.getTotalWidth()+";",cells:e.join("")})},calculate:function(d,k){var g={},a,m,l=this.grid.getColumnModel().config,b;for(var e=0,n=d.length;e<n;e++){a=d[e];for(var f=0,h=k.length;f<h;f++){m=k[f];b=l[f];if(b.summaryType){g[m.name]=Rs.ext.grid.GroupSummary.Calculations[b.summaryType](g[m.name]||0,a,m.name,g)}}}return g},doGroupEnd:function(a,d,b,f,c){var e=this.calculate(d.rs,b);a.push("</div>",this.renderSummary({data:e},b),"</div>")},doWidth:function(e,b,d){if(!this.isGrouped()){return}var c=this.view.getGroups(),a=c.length,f=0,g;for(;f<a;++f){g=c[f].childNodes[2];g.style.width=d;g.firstChild.style.width=d;g.firstChild.rows[0].childNodes[e].style.width=b}},doAllWidths:function(g,d){if(!this.isGrouped()){return}var a=this.view.getGroups(),f=a.length,c=0,b,k,h,e=g.length;for(;c<f;c++){k=a[c].childNodes[2];k.style.width=d;k.firstChild.style.width=d;h=k.firstChild.rows[0].childNodes;for(b=0;b<e;b++){h[b].style.width=g[b]}}},doHidden:function(d,g,c){if(!this.isGrouped()){return}var b=this.view.getGroups(),a=b.length,e=0,f,h=g?"none":"";for(;e<a;e++){f=b[e].childNodes[2];f.style.width=c;f.firstChild.style.width=c;f.firstChild.rows[0].childNodes[d].style.display=h}},isGrouped:function(){return !Ext.isEmpty(this.grid.getStore().groupField)},refreshSummary:function(a){return this.refreshSummaryById(this.view.getGroupId(a))},getSummaryNode:function(a){var b=Ext.fly(a,"_gsummary");if(b){return b.down(".x-grid3-summary-row",true)}return null},refreshSummaryById:function(d){var f=Ext.getDom(d);if(!f){return false}var b=[];this.grid.getStore().each(function(g){if(g._groupId==d){b[b.length]=g}});var c=this.view.getColumnData(),h=this.calculate(b,c),a=this.renderSummary({data:h},c),e=this.getSummaryNode(d);if(e){f.removeChild(e)}Ext.DomHelper.append(f,a);return true},doUpdate:function(b,a){this.refreshSummaryById(a._groupId)},doRemove:function(d,a,b,c){if(!c){this.refreshSummaryById(a._groupId)}},showSummaryMsg:function(a,d){var b=this.view.getGroupId(a),c=this.getSummaryNode(b);if(c){c.innerHTML='<div class="x-grid3-summary-msg">'+d+"</div>"}}});Rs.ext.grid.GroupSummary.Calculations={sum:function(b,a,c){return b+(a.data[c]||0)},count:function(b,a,d,c){return c[d+"count"]?++c[d+"count"]:(c[d+"count"]=1)},max:function(c,b,e,d){var c=b.data[e];var a=d[e+"max"]===undefined?(d[e+"max"]=c):d[e+"max"];return c>a?(d[e+"max"]=c):a},min:function(b,a,e,d){var b=a.data[e];var c=d[e+"min"]===undefined?(d[e+"min"]=b):d[e+"min"];return b<c?(d[e+"min"]=b):c},average:function(b,a,f,e){var g=e[f+"count"]?++e[f+"count"]:(e[f+"count"]=1);var d=(e[f+"total"]=((e[f+"total"]||0)+(a.data[f]||0)));return d===0?0:d/g}}})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.HybridGroupSummary=function(a){Rs.ext.grid.HybridGroupSummary.superclass.constructor.apply(this,arguments)};Ext.extend(Rs.ext.grid.HybridGroupSummary,Rs.ext.grid.GroupSummary,{calculate:function(b,d){var a=this.view.getGroupField(),c=b[0].data[a],e=this.getGroupSummaryData(c);return e||Rs.ext.grid.HybridGroupSummary.superclass.calculate.call(this,b,d)},updateSummaryData:function(a,d,c){var b=this.grid.getStore().reader.jsonData;if(!b.summaryData){b.summaryData={}}b.summaryData[a]=d;if(!c){this.refreshSummary(a)}},getGroupSummaryData:function(c){var b=this.grid.getStore().reader,e=b.jsonData,a=b.recordType.prototype.fields,d;if(e&&e.groupSummaryData){d=e.groupSummaryData[c];if(d){return b.extractValues(d,a.items,a.length)}}return null}})})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.ExportButton=Ext.extend(Ext.Button,{paging:false,text:"导出CSV文件",iconCls:"rs-action-export",visibleOnly:true,handler:function(){var b=this.grid.getStore();var c=b.lastOptions.params;if(typeof(c)=="undefined"){c=b.baseParams}this.header=this.getHeader();var a=new Rs.data.Service({url:b.readUrl||b.url,method:"export",accept:"json",timeout:3000000});this.setIconClass("rs-action-exporting");this.disable();this.removeClass(this.disabledClass);a.call({params:{params:Ext.apply({header:this.header,paging:this.paging},c)}},function(d){this.enable();this.setIconClass("rs-action-export");var e=Ext.fly(this.id+"-iframe");if(e){e.remove()}e=Ext.DomHelper.append(Ext.getBody(),{tag:"div",id:this.id+"-iframe",style:"display:none",html:"<iframe src='"+(Ext.isEmpty(this.exportFileUrl,false)?"/rsc/rsclient/export":this.exportFileUrl)+"?sfilename="+d.filename+"&cfilename="+encodeURIComponent(encodeURIComponent(this.filename+".csv"))+"'></iframe>"})},this)},getHeader:function(){var f=[];var a=this.grid.getColumnModel();var e=a.getColumnCount();if(this.visibleOnly){for(var c=0;c<e;c++){if(!a.isHidden(c)){var b=a.getDataIndex(c);if(b){var d=[];d[0]=b;d[1]=a.getColumnHeader(c);d[2]=a.config[c].summaryType;if(d[2]&&(typeof d[2]==="string")){d[2]={type:a.config[c].summaryType,decimalPrecision:2}}f.push(d)}}}}else{for(var c=0;c<e;c++){var b=a.getDataIndex(c);if(b){var d=[];d[0]=b;d[1]=a.getColumnHeader(c);d[2]=a.config[c].summaryType;if(d[2]&&(typeof d[2]==="string")){d[2]={type:a.config[c].summaryType,decimalPrecision:2}}f.push(d)}}}return f}})})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.TreeColumn=function(a){a=Ext.apply(a||{},{});Rs.ext.grid.TreeColumn.superclass.constructor.call(this,a)};Ext.extend(Rs.ext.grid.TreeColumn,Ext.grid.Column,{emptyIcon:Ext.BLANK_IMAGE_URL,renderer:function(m,c,j,d,h,o,k){var f=j.node,l=f.attributes,e,g=false,b=this.getHref(l.href);e=['<div class="x-tree-root-ct x-tree-arrows x-tree-root-node x-tree-node"><div ext:tree-node-id="',f.id,'" class="x-tree-node-el '+(f.isLeaf()?"x-tree-node-leaf":f.isExpandable()&&f.isExpanded()?"x-tree-node-expanded":"x-tree-node-collapsed")+" x-unselectable ",l.cls,'" unselectable="on">','<span class="x-tree-node-indent">',this.getChildIndent(f),"</span>",'<img alt="" src="',this.emptyIcon,'" class="x-tree-ec-icon '+(f.isLeaf()?"x-tree-elbow-end":f.isExpandable()&&f.isExpanded()?"x-tree-elbow-minus":"x-tree-elbow-plus")+'" />','<img alt="" src="',l.icon||this.emptyIcon,'" class="x-tree-node-icon',(l.icon?" x-tree-node-inline-icon":""),(l.iconCls?" "+l.iconCls:""),'" unselectable="on" />',g?('<input class="x-tree-node-cb" type="checkbox" '+(l.checked?'checked="checked" />':"/>")):"",'<a hidefocus="on" class="x-tree-node-anchor" href="',b,'" tabIndex="1" ',l.hrefTarget?' target="'+l.hrefTarget+'"':"",'><span unselectable="on">',m,"</span></a></div>",'<ul class="x-tree-node-ct" style="display:none;"></ul>',"</div>"];return e.join("")},getHref:function(a){return Ext.isEmpty(a)?(Ext.isGecko?"":"#"):a},getChildIndent:function(b){var a=[],c=b?b.parentNode:null;while(c){if(!c.isRoot||(c.isRoot&&c.ownerTree.rootVisible)){if(!c.isLast()){a.unshift('<img alt="" src="'+this.emptyIcon+'" class="x-tree-elbow-line" />')}else{a.unshift('<img alt="" src="'+this.emptyIcon+'" class="x-tree-icon" />')}}c=c.parentNode}return a.join("")},processEvent:function(b,g,a,h,k){var d=g.getTarget().className.match(/x-tree-ec-icon/);if(d){if(b=="click"||b=="mousedown"){var j=a.getStore(),f,c;if(j&&(f=j.getAt(h))&&(c=f.node)){if(c.isExpanded()){j.collapse(f,true)}else{j.expand(f)}}}}return Rs.ext.grid.TreeColumn.superclass.processEvent.apply(this,arguments)}});Ext.grid.Column.types.treecolumn=Rs.ext.grid.TreeColumn})();Ext.ns("Rs.ext.grid");(function(){var a=function(d,c){this.idProperty=d&&d.idProperty?d.idProperty:"id";delete d.idProperty;a.superclass.constructor.call(this,d);if(c!=undefined){this.record=c;c.node=this}this.addEvents("beforeexpand","expand","beforecollapse","collapse")};Ext.extend(a,Ext.tree.AsyncTreeNode,{isNode:true,loading:-1,getId:function(){return this.id},isExpanded:function(){return this.expanded===true},isLoaded:function(){return this.loading>0},setLoaded:function(c){c===true?(this.loading=1):(this.loading=-1)},isLoading:function(){return this.loading===0},setLoading:function(){this.loading=0},isLeaf:function(){return this.attributes.leaf===true},createNode:function(c){if(c&&c.isNode===true){return c}else{if(c.data!=undefined){var d=c.data;node=new a(Ext.apply(d,{id:d[this.idProperty],idProperty:this.idProperty}),c);return node}}},appendChild:function(f){var e=this,c,d;if(Ext.isArray(f)){for(c=0,d=f.length;c<d;c++){e.appendChild(f[c])}}else{f=e.createNode(f);if(f!=undefined){return a.superclass.appendChild.call(this,f)}}},expand:function(c,f,d){var e=this;if(!e.isLeaf()&&!e.isExpanded()){e.fireEvent("beforeexpand",e,function(g){e.expanded=true;e.fireEvent("expand",e,e.childNodes);if(c===true){e.expandChildren(true,f,d)}else{e.runCallback(f,d||e,[e.childNodes])}},d)}else{e.runCallback(f,d||e,[])}},expandChildren:function(f,k,l){var j=this,g=0,c=j.childNodes,h=c.length,e,d=0;for(;g<h;++g){e=c[g];if(!e.isLeaf()&&!e.isExpanded()){d++;c[g].expand(f,function(){d--;if(k&&!d){j.runCallback(k,l||j,j.childNodes)}},j)}}if(!d&&k){j.runCallback(k,l||j,j.childNodes)}},removeChild:function(d,c){Ext.tree.TreeNode.superclass.removeChild.apply(this,arguments);if(!c){var e=d.ui.rendered;if(e){d.ui.remove()}if(e&&this.childNodes.length<1){this.collapse(false,false)}else{this.ui.updateExpandIcon()}if(!this.firstChild&&!this.isHiddenRoot()){this.childrenRendered=false}}return d},destroy:function(c){Ext.tree.TreeNode.superclass.destroy.call(this,c);Ext.destroy(this.ui,this.loader);this.ui=this.loader=null},collapse:function(c,f,d){var e=this;if(!e.isLeaf()&&e.isExpanded()){e.fireEvent("beforecollapse",e,function(g){e.expanded=false;if(c){e.collapseChildren(true,f,d);e.fireEvent("collapse",e,e.childNodes,false)}else{e.fireEvent("collapse",e,e.childNodes,false);e.runCallback(f,d||e,[e.childNodes])}},e)}else{e.runCallback(f,d||e)}},collapseChildren:function(f,k,l){var j=this,g=0,d=j.childNodes,h=d.length,e,c=0;for(;g<h;++g){e=d[g];if(!e.isLeaf()&&e.isExpanded()){c++;d[g].collapse(f,function(){c--;if(k&&!c){j.runCallback(k,l||j,j.childNodes)}})}}if(!c&&k){j.runCallback(k,l||j,j.childNodes)}},runCallback:function(c,e,d){if(Ext.isFunction(c)){c.apply(e,d)}}});var b=function(c){b.superclass.constructor.call(this,c)};Ext.extend(b,Ext.data.Tree,{proxyNodeEvent:function(j,g,f,e,c,o,n){if(j=="collapse"||j=="expand"||j=="beforecollapse"||j=="beforeexpand"||j=="move"||j=="beforemove"){j=j+"record"}if(j=="expandrecord"||j=="collapserecord"){var d=g.record,m=[];if(Ext.isArray(f)){for(var k=0,h=f.length;k<h;k++){if(f[k]!=undefined&&f[k].isNode&&f[k].record!=undefined){m.push(f[k].record)}}}else{if(f!=undefined&&f.isNode&&f.record!=undefined){m.push(f.record)}}return this.fireEvent(j,d,m,e,c,o,n)}else{var d=g.record;if(g.isRoot||d!=undefined){return this.fireEvent(j,d,f,e,c,o,n)}}}});Rs.ext.grid.TreeStore=function(d){var e=this,c;d=Ext.apply({},d);c=d.fields||e.fields;if(!c){d.fields=[{name:"text",type:"string"}]}d.autoLoad=false;Rs.ext.grid.TreeStore.superclass.constructor.call(this,Ext.applyIf(d,{root:"children"}));e.tree=new Ext.data.Tree();e.tree=new b();e.tree.on({scope:e,remove:e.onRemoveRecord,beforeexpandrecord:e.onBeforeExpandRecord,expandrecord:e.onExpandRecord,beforecollapserecord:e.onBeforeCollapseRecord,collapserecord:e.onCollapseRecord,beforeinsertrecord:e.onBeforeExpandRecord,insertrecord:e.onExpandRecord,beforemoverecord:e.onBeforeMoveRecord,moverecord:e.onMoveRecord});e.relayEvents(e.tree,["append","remove","move","insert","beforeappend","beforeremove","beforemove","beforeinsert","expand","collapse","beforeexpand","beforecollapse","sort","rootchange"]);e.addEvents("rootchange");this.rootNode=this.setRootNode(this.rootNode);this.getRootNode().expand()};Ext.extend(Rs.ext.grid.TreeStore,Rs.ext.data.Store,{clearOnLoad:true,nodeParameter:"node",nodeAttributesAsParameter:[],defaultRootId:"root",folderSort:false,setRootNode:function(c){var d=this;c=c||{};if(!c.isNode){c=new a(Ext.applyIf(c,{id:d.defaultRootId,idProperty:this.idProperty}))}d.tree.setRootNode(c);if(!c.isLoaded()&&c.isExpanded()){d.load({node:c})}this.fireEvent("rootchange",d,c);return c},getRootNode:function(){var c=this.tree.getRootNode();if(c==undefined){c=this.setRootNode({expanded:true})}return c},getNodeById:function(c){return this.tree.getNodeById(c)},load:function(c){c=c||{};c.params=c.params||{};var f=this,e=c.node||f.getRootNode();if(!e){e=f.setRootNode({expanded:true})}if(f.clearOnLoad){e.removeAll()}Ext.applyIf(c,{node:e});c.params[f.nodeParameter]=e?e.getId():"root";var d=[].concat(f.nodeAttributesAsParameter);if(d.length>0){Ext.copyTo(c.params,e.attributes,d)}Ext.applyIf(c.params,e.getOwnerTree().getRootNode().getLoader().baseParams);if(e){e.setLoading()}return Rs.ext.grid.TreeStore.superclass.load.call(this,c)},fillNode:function(h,e){var g=e?e.length:0,f=0,c=[];h.setLoaded(true);for(;f<g;f++){var d=e[f];if(h.fireEvent("beforeappendrecord",h,d)!==false){h.appendChild(d);c.push(d)}}return c},loadRecords:function(k,c,j){if(this.isDestroyed===true){return}this.totalLength=k.totalRecords||0;if(!k||j===false){if(j!==false){this.fireEvent("load",this,[],c)}if(c.callback){c.callback.call(c.scope||this,[],c,false,k)}return}k.records=this.fillNode(c.node,k.records);if(c.node==this.getRootNode()){var g=k.records,f=k.totalRecords||g.length;var e=[],h,d=0;for(i=0,len=g.length;i<len;++i){h=g[i];if(this.indexOfId(h.id)>-1){this.doUpdate(h)}else{e.push(h);++d}}this.totalLength=Math.max(f,this.data.length+d);this.add(e);this.fireEvent("load",this,e,c)}if(c.callback){c.callback.call(c.scope||this,k.records,c,true)}},collapse:function(d,c,h,e){var g=this,f=d.node;if(f!=undefined){return f.collapse(c,h,e)}else{if(Ext.isFunction(h)){h.call(e||this)}}},expand:function(d,c,h,e){var g=this,f=d.node;if(f!=undefined){return f.expand(c,h,e)}else{if(Ext.isFunction(h)){h.call(e||this)}}},onBeforeExpandRecord:function(c,g,d){var f=this,e=c?c.node:f.getRootNode();if(e.isLoaded()){f.runCallback(g,d||e,[e.childNodes])}else{if(e.isLoading()){this.on("load",function(){f.runCallback(g,d||e,[e.childNodes])},this,{single:true})}else{this.load({node:e,callback:function(){f.runCallback(g,d||e,[e.childNodes])}})}}},onExpandRecord:function(d,c,h,g){var e=this.indexOf(d),f=c||[];if(d!=undefined){f.unshift(d);this.remove(d)}this.insert(e>=0?e:0,f)},onBeforeCollapseRecord:function(c,f,d){var e=c?c.node:this.getRootNode();f.call(d||e,e.childNodes)},onCollapseRecord:function(d,c,h,g){var f=c||[],e;if(d!=undefined){e=this.indexOf(d);f.unshift(d);this.remove(f);this.insert(e>=0?e:0,[d])}else{this.remove(f)}},onRemoveRecord:function(){},onBeforeMoveRecord:function(){},onMoveRecord:function(){},onCreateRecords:function(d,c,e){},onUpdateRecords:function(d,c,e){},onDestroyRecords:function(d,c,e){},sortData:function(){var g=this,d=this.hasMultiSort?this.multiSortInfo:this.sortInfo,j=d.direction||"ASC",h=d.sorters,f=[];if(!this.hasMultiSort){h=[{direction:j,field:d.field}]}f=this.createSortFunction(h);var c=g.getRootNode();c.cascade(function(k){if(!k.isLeaf()&&k.hasChildNodes()&&k.isExpanded()){k.sort(f)}},g);var e=[];c.cascade(function(k){if(!k.isRoot&&k.record&&k.parentNode.isExpanded()){e.push(k.record)}},g);g.removeAll();g.add(e)},sortChildNodes:function(d,c){var e=[].concat(d.childNodes);while(d.firstChild){var f=d.firstChild;f.remove()}var e=this.sortNodeList(e,c);d.appendChild(e)},sortNodeList:function(d,f){if(d.length==0){return[]}var g=d.sort(f);for(var e=0,c=g.length;e<c;e++){this.sortChildNodes(g[e],f)}return g},createSortFunction:function(d){var c=this.fields;return function(j,h){var f=j.record,e=h.record;for(var g=0;g<d.length;g++){var l=c.get(d[g].field).sortType;var m=l(f.data[d[g].field]),k=l(e.data[d[g].field]);if(m==k){continue}else{return(d[g].direction.toUpperCase()=="DESC"?-1:1)*(m>k?1:-1)}}return 0}},runCallback:function(c,e,d){if(Ext.isFunction(c)){c.apply(e,d)}},destroy:function(){if(!this.isDestroyed){var c=this.getRootNode();if(c&&c.destroy){c.destroy(true)}}Rs.ext.grid.TreeStore.superclass.destroy.apply(this,arguments)}})})();Ext.ns("Rs.ext.grid");(function(){var a=function(b){a.superclass.constructor.call(this,Ext.apply(b||{},{cellSelectorDepth:5}))};Ext.extend(a,Ext.grid.GridView,{autoScrollToTop:false,onLoad:function(){if(this.autoScrollToTop===true){a.superclass.onLoad.apply(this,arguments)}}});Rs.ext.grid.TreeGridPanel=function(b){Rs.ext.grid.TreeGridPanel.superclass.constructor.call(this,b)};Ext.extend(Rs.ext.grid.TreeGridPanel,Ext.grid.EditorGridPanel,{getView:function(){if(!this.view){this.view=new a(this.viewConfig)}return this.view}});Ext.ComponentMgr.registerType("rs-ext-treegridpanel",Rs.ext.grid.TreeGridPanel)})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.GeneralselGridPanel=function(d){d=d||{};var a=d.progCode,c=d.progCondition,f=d.dataCompany;var b=d.store||d.ds||new Rs.ext.data.GeneralselStore({autoLoad:true,autoDestroy:true,progCode:a,progCondition:c,dataCompany:f});var e=d.columns||[];this.configColumns=e;delete d.columns;Ext.applyIf(d,{store:b,columns:e});Rs.ext.grid.GeneralselGridPanel.superclass.constructor.call(this,d);this.store.on("metachange",this.onStoreMeataChange,this)};Ext.extend(Rs.ext.grid.GeneralselGridPanel,Ext.grid.GridPanel,{onStoreMeataChange:function(o,p){var a=[],g=[],e,b,n;if(g=p?p.fields:undefined){if(this.selModel!=undefined&&this.selModel instanceof Ext.grid.CheckboxSelectionModel){a.push(this.selModel);if(this.rendered==true){this.getSelectionModel().init(this)}}if(this.configColumns.length==0){for(e=0,b=g.length;e<b;e++){for(var d in g){var h=g[d];if(h.seqNo==e){n=h;break}}var j={dataIndex:n.name,header:n.descCh||n.descEn||n.name,width:n.width,align:n.align,hidden:n.hidden,editable:false,hideable:true,sortable:true};a.push(j)}}else{a=Ext.combine(a,this.configColumns)}var m=new Ext.grid.ColumnModel(a);this.reconfigure(o,m)}}});Ext.ComponentMgr.registerType("rs-ext-generalselgridpanel",Rs.ext.grid.GeneralselGridPanel)})();Ext.ns("Rs.ext.grid");(function(){var a=function(b){b=b||{};var c=b.region;if(c=="west"||c=="east"){Ext.apply(b,{width:129,autoWidth:false,autoHeight:false})}else{Ext.apply(b,{autoWidth:false,autoHeight:true})}a.superclass.constructor.call(this,Ext.applyIf(b,{collapsible:true,collapsed:true,hideCollapseTool:true,collapseMode:"mini",split:true}));this.on("beforeexpand",function(){return this.configDisabled!=true},this);this.on("render",function(){if(this.configCollapsed===false&&this.loadFields===true){this.expand()}if(this.configDisabled==true){this.setDisabled(true)}},this,{scope:this,delay:10,single:true});this.on("resize",function(){if(this.ownerCt){this.ownerCt.doLayout()}},this,{delay:10})};Ext.extend(a,Ext.Panel,{bodyStyle:"padding:5px;",autoScroll:true,defaults:{border:false},animCollapse:false,configCollapsed:true,layout:"column",bbar:["->",{iconCls:"rs-action-query",text:"查询",handler:function(){this.ownerCt.ownerCt.doQuery()}},{xtype:"tbspacer"},{xtype:"tbspacer"},{iconCls:"rs-action-reset",text:"重置",handler:function(){this.ownerCt.ownerCt.doReset()}}],reconfigure:function(c,g){this.loadFields=false;this.generalselPanel=c;var b=[],h=[];for(var e=0,d=g.length;e<d;e++){if(!this.displayQueryField){var f=Ext.create(Ext.apply(g[e],{width:125,style:{marginRight:"4px",marginBottom:"2px"}}),"textfield");b.push({bodyStyle:"background:transparent;padding:3px 1px 1px 3px",width:132,items:f});h.push(f)}else{if(this.displayQueryField.indexOf(g[e]["dataIndex"])>-1){var f=Ext.create(Ext.apply(g[e],{width:125,style:{marginRight:"4px",marginBottom:"2px"}}),"textfield");b.push({bodyStyle:"background:transparent;padding:3px 1px 1px 3px",width:132,items:f});h.push(f)}}}this.removeFields();this.oldConditionFields=this.add(b);this.conditionFields=h;this.loadFields=true;if(this.configCollapsed===false&&this.rendered===true){this.expand()}this.fireEvent("resize")},removeFields:function(){var d=this.oldConditionFields||[];for(var c=0,b=d.length;c<b;c++){this.remove(d[c],true)}delete this.oldConditionFields},doQuery:function(){var b=this.conditionFields||[],h=[];for(var d=0,c=b.length;d<c;d++){var f=b[d],g=f.dataIndex,e=f.getValue();if(g!=undefined&&g.trim()!=""&&e!=undefined&&e.trim()!=""){h.push(g+" like '"+e+"%'")}}progCondtion=this.buildProgCondtion(h.join(" AND "));this.generalselPanel.query(progCondtion)},buildProgCondtion:function(b){return b},doReset:function(){var b=this.conditionFields||[];for(var d=0,c=b.length;d<c;d++){var e=b[d];e.reset()}},setDisabled:function(b){a.superclass.setDisabled.apply(this,arguments);this.configDisabled=b;if(b==true){(this.collapsed!=true)?this.collapse():null}else{(this.collapsed&&this.rendered)?this.expand():null}},onDestroy:function(){a.superclass.onDestroy.apply(this,arguments);this.removeFields()}});Rs.ext.grid.GeneralselPanel=function(c){c=c||{};var g=c.progCode,b=c.progCondition,k=c.displayQueryField,l=c.dataCompany;this.store=new Rs.ext.data.GeneralselStore({autoLoad:false,autoDestroy:true,progCode:g,progCondition:b,dataCompany:l});var h=c.gridConfig||{},f=h.columns||[];var m=c.pageSize;if(m!==false){m=Ext.isNumber(m)?m:20;this.pagingToolbar=new Rs.ext.grid.SliderPagingToolbar({pageSize:m,border:true,store:this.store,hasSlider:false,displayInfo:false});Ext.apply(c,{keys:[{key:36,fn:function(){var o=this.pagingToolbar.getPageData();if(o&&o.activePage>1){this.pagingToolbar.moveFirst()}},scope:this},{key:35,fn:function(){var o=this.pagingToolbar.getPageData();if(o&&o.activePage<o.pages){this.pagingToolbar.moveLast()}},scope:this},{key:33,fn:function(){var p=this.grid.getView().scroller.dom;if(p.scrollTop<=0){var o=this.pagingToolbar.getPageData();if(o&&o.activePage>1){this.pagingToolbar.movePrevious();p.scrollTop=p.scrollHeight-p.clientHeight}}},scope:this},{key:34,fn:function(){var p=this.grid.getView().scroller.dom;if(p.clientHeight+p.scrollTop>=p.scrollHeight){var o=this.pagingToolbar.getPageData();if(o&&o.activePage<o.pages){this.pagingToolbar.moveNext()}}},scope:this}]});Ext.apply(c,{bbar:this.pagingToolbar})}this.grid=new Rs.ext.grid.GeneralselGridPanel(Ext.apply(h,{store:this.store,columns:f,deferRowRender:false,enableHdMenu:false,loadMask:true,region:"center"}));var j=c.queryPanelConfig||{},e=c.queryPanelCollapsed,n=c.queryPanelPosition,d=c.queryPanelDisable;if(c.buildProgCondtion){buildProgCondtion=c.buildProgCondtion}if(c.queryPanel){this.queryPanel=c.queryPanel;this.queryPanel.bindStore(this.store,this.query,this);this.queryPanel.on("selectcondition",this.onQueryPanelChange,this);this.queryPanel.on("unselectcondition",this.onQueryPanelChange,this)}else{if(c.buildProgCondtion){this.queryPanel=new a(Ext.apply(j,{region:n||"north",configCollapsed:Ext.isBoolean(e)?e:true,configDisabled:Ext.isBoolean(d)?d:false,buildProgCondtion:buildProgCondtion}))}else{this.queryPanel=new a(Ext.apply(j,{region:n||"north",configCollapsed:Ext.isBoolean(e)?e:true,configDisabled:Ext.isBoolean(d)?d:false}))}this.buildinPanel=true}delete c.progCode;delete c.dataCompany;delete c.progCondition;delete c.displayQueryField;delete c.gridConfig;delete c.queryPanelCollapsed;delete c.queryPanelPosition;delete c.buildProgCondtion;Rs.ext.grid.GeneralselPanel.superclass.constructor.call(this,Ext.apply(c,{layout:"border"}));if(this.storeAutoLoad==true){this.store.load()}this.store.on("metachange",this.onStoreMeataChange,this);this.store.on("loadexception",this.onLoadException,this)};Ext.extend(Rs.ext.grid.GeneralselPanel,Ext.Panel,{storeAutoLoad:true,queryPanelDisable:false,initComponent:function(){Rs.ext.grid.GeneralselPanel.superclass.initComponent.apply(this,arguments);this.add(this.queryPanel);this.add(this.grid)},setQueryPanelDisable:function(b){if(this.queryPanelDisable!=b){this.queryPanelDisable=b;this.queryPanel&&this.queryPanel.setDisabled(b==true)}},onQueryPanelChange:function(){this.doLayout()},getStore:function(){return this.store},getGrid:function(){return this.grid},getPagingToolbar:function(){return this.pagingToolbar},onStoreMeataChange:function(d,h){var g=[],b,e,c,f,j;if(this.queryPanel&&(b=h?h.queryFields:undefined)){for(e=0,c=b.length;e<c;e++){f=b[e];j=f.descCh||f.descEn||f.name;g.push({dataIndex:f.name,allowBlank:f.allowBlank,emptyText:j,blankText:j+"不能为空"})}if(g.length>0){if(this.buildinPanel===true){this.queryPanel.reconfigure(this,g)}}}},onLoadException:function(d,c,b,f){},query:function(b,f,d){if(Ext.isFunction(f)){this.store.on("load",function(h,g,j){f.call(d||this,h,g,j)},this,{single:true})}var c=this.getPagingToolbar();if(c!=undefined){c.setStart(0)}if(!Ext.isEmpty(b,false)&&Ext.isString(b)){var e={};Ext.apply(e,{progCondition:b});this.store.load({params:e})}else{this.store.load()}},onDestroy:function(){Rs.ext.grid.GeneralselPanel.superclass.onDestroy.apply(this,arguments);if(this.store){this.store.un("metachange",this.onStoreMeataChange,this);this.store.un("load",this.onLoadSelectFirstRow,this);this.store.un("loadexception",this.onLoadException,this);this.store.destroy()}if(this.grid){this.grid.destroy()}if(this.pagingToolbar){this.pagingToolbar.destroy()}if(this.queryPanel){this.queryPanel.destroy()}},setProgCode:function(b,c){this.store.setProgCode(b,c)},setDataCompany:function(b){this.store.setDataCompany(b)}});Ext.ComponentMgr.registerType("rs-ext-generalselpanel",Rs.ext.grid.GeneralselPanel)})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.BufferView=Ext.extend(Ext.grid.GridView,{rowHeight:19,borderHeight:2,scrollDelay:100,cacheSize:20,cleanDelay:500,initTemplates:function(){Rs.ext.grid.BufferView.superclass.initTemplates.call(this);var a=this.templates;a.rowHolder=new Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}"></div>');a.rowHolder.disableFormats=true;a.rowHolder.compile();a.rowBody=new Ext.Template('<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody><tr>{cells}</tr>",(this.enableRowBody?'<tr class="x-grid3-row-body-tr" style="{bodyStyle}"><td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on"><div class="x-grid3-row-body">{body}</div></td></tr>':""),"</tbody></table>");a.rowBody.disableFormats=true;a.rowBody.compile()},getStyleRowHeight:function(){return Ext.isBorderBox?(this.rowHeight+this.borderHeight):this.rowHeight},getCalculatedRowHeight:function(){return this.rowHeight+this.borderHeight},getVisibleRowCount:function(){var b=this.getCalculatedRowHeight(),a=this.scroller.dom.clientHeight;return(a<1)?0:Math.ceil(a/b)},getVisibleRows:function(){var a=this.getVisibleRowCount(),b=this.scroller.dom.scrollTop,c=(b===0?0:Math.floor(b/this.getCalculatedRowHeight())-1);return{first:Math.max(c,0),last:Math.min(c+a+2,this.ds.getCount()-1)}},doRender:function(g,k,u,a,s,A,l){var b=this.templates,f=b.cell,h=b.row,x=b.rowBody,n=s-1,t=this.getStyleRowHeight(),z=this.getVisibleRows(),d="width:"+this.getTotalWidth()+";height:"+t+"px;",D=[],w,E,v={},m={tstyle:d},q;for(var y=0,C=k.length;y<C;y++){q=k[y];w=[];var o=(y+a),e=o>=z.first&&o<=z.last;if(e){for(var B=0;B<s;B++){E=g[B];v.id=E.id;v.css=B===0?"x-grid3-cell-first ":(B==n?"x-grid3-cell-last ":"");v.attr=v.cellAttr="";v.value=E.renderer(q.data[E.name],v,q,o,B,u);v.style=E.style;if(v.value===undefined||v.value===""){v.value="&#160;"}if(q.dirty&&typeof q.modified[E.name]!=="undefined"){v.css+=" x-grid3-dirty-cell"}w[w.length]=f.apply(v)}}var F=[];if(A&&((o+1)%2===0)){F[0]="x-grid3-row-alt"}if(q.dirty){F[1]=" x-grid3-dirty-row"}m.cols=s;if(this.getRowClass){F[2]=this.getRowClass(q,o,m,u)}m.alt=F.join(" ");m.cells=w.join("");D[D.length]=!e?b.rowHolder.apply(m):(l?x.apply(m):h.apply(m))}return D.join("")},isRowRendered:function(a){var b=this.getRow(a);return b&&b.childNodes.length>0},syncScroll:function(){Rs.ext.grid.BufferView.superclass.syncScroll.apply(this,arguments);this.update()},update:function(){if(this.scrollDelay){if(!this.renderTask){this.renderTask=new Ext.util.DelayedTask(this.doUpdate,this)}this.renderTask.delay(this.scrollDelay)}else{this.doUpdate()}},onRemove:function(d,a,b,c){Rs.ext.grid.BufferView.superclass.onRemove.apply(this,arguments);if(c!==true){this.update()}},doUpdate:function(){if(this.getVisibleRowCount()>0){var f=this.grid,b=f.colModel,h=f.store,e=this.getColumnData(),a=this.getVisibleRows(),j;for(var d=a.first;d<=a.last;d++){if(!this.isRowRendered(d)&&(j=this.getRow(d))){var c=this.doRender(e,[h.getAt(d)],h,d,b.getColumnCount(),f.stripeRows,true);j.innerHTML=c}}this.clean()}},clean:function(){if(!this.cleanTask){this.cleanTask=new Ext.util.DelayedTask(this.doClean,this)}this.cleanTask.delay(this.cleanDelay)},doClean:function(){if(this.getVisibleRowCount()>0){var b=this.getVisibleRows();b.first-=this.cacheSize;b.last+=this.cacheSize;var c=0,d=this.getRows();if(b.first<=0){c=b.last+1}for(var a=this.ds.getCount();c<a;c++){if((c<b.first||c>b.last)&&d[c].innerHTML){d[c].innerHTML=""}}}},removeTask:function(b){var a=this[b];if(a&&a.cancel){a.cancel();this[b]=null}},destroy:function(){this.removeTask("cleanTask");this.removeTask("renderTask");Rs.ext.grid.BufferView.superclass.destroy.call(this)},layout:function(){Rs.ext.grid.BufferView.superclass.layout.call(this);this.update()}})})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.RowEditor=Ext.extend(Ext.Panel,{floating:true,shadow:false,layout:"hbox",cls:"x-small-editor",buttonAlign:"center",baseCls:"x-row-editor",elements:"header,footer,body",frameWidth:5,buttonPad:3,clicksToEdit:"auto",monitorValid:true,focusDelay:250,errorSummary:true,saveText:"确定",cancelText:"取消",commitChangesText:"您必须将修改内容保存或取消",errorText:"提示",defaults:{normalWidth:true},initComponent:function(){Rs.ext.grid.RowEditor.superclass.initComponent.call(this);this.addEvents("beforeedit","canceledit","validateedit","afteredit")},init:function(a){this.grid=a;this.ownerCt=a;if(this.clicksToEdit===2){a.on("rowdblclick",this.onRowDblClick,this)}else{a.on("rowclick",this.onRowClick,this);if(Ext.isIE){a.on("rowdblclick",this.onRowDblClick,this)}}a.getStore().on("remove",function(){this.stopEditing(false)},this);a.on({scope:this,keydown:this.onGridKey,columnresize:this.verifyLayout,columnmove:this.onColumnMove,reconfigure:this.refreshFields,beforedestroy:this.beforedestroy,destroy:this.destroy,bodyscroll:{buffer:250,fn:this.positionButtons}});a.getColumnModel().on("hiddenchange",this.verifyLayout,this,{delay:1});a.getView().on("refresh",this.stopEditing.createDelegate(this,[false]))},beforedestroy:function(){this.stopMonitoring();this.grid.getStore().un("remove",this.onStoreRemove,this);this.stopEditing(false);Ext.destroy(this.btns,this.tooltip)},refreshFields:function(){this.initFields();this.verifyLayout(true)},reinitFields:function(){this.stopEditing();this.initialized=false},isDirty:function(){var a;this.items.each(function(b){if(String(this.values[b.id])!==String(b.getValue())){a=true;return false}},this);return a},startEditing:function(k,p){if(this.editing&&this.isDirty()){this.showTooltip(this.commitChangesText);return}if(Ext.isObject(k)){k=this.grid.getStore().indexOf(k)}if(this.fireEvent("beforeedit",this,k)!==false){this.editing=true;var e=this.grid,l=e.getView(),o=l.getRow(k),c=e.store.getAt(k);this.record=c;this.rowIndex=k;this.values={};if(!this.rendered){this.render(l.getEditorParent())}var m=Ext.fly(o).getWidth();this.setSize(m);if(!this.initialized){this.initFields()}var n=e.getColumnModel(),d=this.items.items,j,a;for(var b=0,h=n.getColumnCount();b<h;b++){a=this.preEditValue(c,n.getDataIndex(b));j=d[b];j.setValue(a);this.values[j.id]=Ext.isEmpty(a)?"":a}this.verifyLayout(true);if(!this.isVisible()){this.setPagePosition(Ext.fly(o).getXY())}else{this.el.setXY(Ext.fly(o).getXY(),{duration:0.15})}if(!this.isVisible()){this.show().doLayout()}if(p!==false){this.doFocus.defer(this.focusDelay,this)}}},stopEditing:function(l){this.editing=false;if(!this.isVisible()){return}if(l===false||!this.isValid()){this.hide();this.fireEvent("canceledit",this,l===false);return}var g={},b=this.record,h=false,k=this.grid.colModel,e=this.items.items;for(var d=0,f=k.getColumnCount();d<f;d++){if(!k.isHidden(d)){var c=k.getDataIndex(d);if(!Ext.isEmpty(c)){var a=b.data[c],j=this.postEditValue(e[d].getValue(),a,b,c);if(String(a)!==String(j)){g[c]=j;h=true}}}}if(h&&this.fireEvent("validateedit",this,g,b,this.rowIndex)!==false){b.beginEdit();Ext.iterate(g,function(m,n){b.set(m,n)});b.endEdit();this.fireEvent("afteredit",this,g,b,this.rowIndex)}this.hide()},verifyLayout:function(e){if(this.el&&(this.isVisible()||e===true)){var g=this.grid.getView().getRow(this.rowIndex);this.setSize(Ext.fly(g).getWidth(),Ext.isIE?Ext.fly(g).getHeight()+9:undefined);var c=this.grid.colModel,b=this.items.items;for(var d=0,a=c.getColumnCount();d<a;d++){if(!c.isHidden(d)){var f=0;if(d===(a-1)){f+=3}else{f+=1}b[d].show();aw=c.getColumnWidth(d)-f;b[d].setWidth(aw);b[d].width=aw}else{b[d].hide()}}this.doLayout();this.positionButtons()}},onColumnMove:function(d,e){if(!this.initialized){this.refreshFields()}else{var a=this.items.items;if(d>e){a[d].el.setX(a[e].el.getX());for(var c=e;c<d;c++){a[c].el.setX(a[c].el.getX()+a[d].el.getWidth())}}else{for(var c=d+1;c<=e;c++){a[c].el.setX(a[c].el.getX()-a[d].el.getWidth())}a[d].el.setX(a[e].el.getX()+a[e].el.getWidth())}if(d==0){if(a[0] instanceof Ext.form.DisplayField){a[0].el.removeClass("x-grid3-roweditor-uneditable-first-left");a[0].el.addClass("x-grid3-roweditor-uneditable-left")}}var b=this.items.items.splice(d,1);this.items.items.splice(e,0,b[0])}},slideHide:function(){this.hide()},initFields:function(){var b=this.grid.getColumnModel(),f=Ext.layout.ContainerLayout.prototype.parseMargins;this.removeAll(false);for(var e=0,a=b.getColumnCount();e<a;e++){var g=b.getColumnAt(e);var d=g.getEditor?g.getEditor():null;if(!d){d=g.displayEditor||(e==0?new Ext.form.DisplayField({cls:"x-grid3-roweditor-uneditable-first x-grid3-roweditor-uneditable-first-left"}):new Ext.form.DisplayField({cls:"x-grid3-roweditor-uneditable x-grid3-roweditor-uneditable-left"}))}if(e==0){d.margins=f("0 1 2 1")}else{if(e==a-1){d.margins=f("0 0 2 1")}else{if(Ext.isIE){d.margins=f("0 0 2 0")}else{d.margins=f("0 1 2 0")}}}d.setWidth(b.getColumnWidth(e));d.column=g;if(d.ownerCt!==this){d.on("focus",this.ensureVisible,this);d.on("specialkey",this.onKey,this)}this.insert(e,d)}this.initialized=true},onKey:function(a,b){if(b.getKey()===b.ENTER){this.stopEditing(true);b.stopPropagation()}},onGridKey:function(c){if(c.getKey()===c.ENTER&&!this.isVisible()){var b=this.grid.getSelectionModel().getSelected();if(b){var a=this.grid.store.indexOf(b);this.startEditing(a);c.stopPropagation()}}},ensureVisible:function(a){if(this.isVisible()){this.grid.getView().ensureVisible(this.rowIndex,this.grid.colModel.getIndexById(a.column.id),true)}},onRowClick:function(b,d,c){if(this.clicksToEdit=="auto"){var a=this.lastClickIndex;this.lastClickIndex=d;if(a!=d&&!this.isVisible()){return}}this.startEditing(d,false);this.doFocus.defer(this.focusDelay,this,[c.getPoint()])},onRowDblClick:function(a,c,b){this.startEditing(c,false);this.doFocus.defer(this.focusDelay,this,[b.getPoint()])},onRender:function(){Rs.ext.grid.RowEditor.superclass.onRender.apply(this,arguments);this.el.swallowEvent(["keydown","keyup","keypress"]);this.btns=new Ext.Panel({baseCls:"x-plain",cls:"x-btns",elements:"body",layout:"table",width:(this.minButtonWidth*2)+(this.frameWidth*2)+(this.buttonPad*4),items:[{ref:"saveBtn",itemId:"saveBtn",xtype:"button",text:this.saveText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[true])},{xtype:"button",text:this.cancelText,width:this.minButtonWidth,handler:this.stopEditing.createDelegate(this,[false])}]});this.btns.render(this.bwrap)},afterRender:function(){Rs.ext.grid.RowEditor.superclass.afterRender.apply(this,arguments);this.positionButtons();if(this.monitorValid){this.startMonitoring()}},onShow:function(){if(this.monitorValid){this.startMonitoring()}Rs.ext.grid.RowEditor.superclass.onShow.apply(this,arguments)},onHide:function(){Rs.ext.grid.RowEditor.superclass.onHide.apply(this,arguments);this.stopMonitoring();this.grid.getView().focusRow(this.rowIndex)},positionButtons:function(){if(this.btns){var e=this.grid,d=this.el.dom.clientHeight,b=e.getView(),a=b.scroller.dom.scrollLeft,f=this.btns.getWidth(),c=Math.min(e.getWidth(),e.getColumnModel().getTotalWidth());this.btns.el.shift({left:(c/2)-(f/2)+a,top:d-2,stopFx:true,duration:0.2})}},preEditValue:function(a,c){var b=a.data[c];return this.autoEncode&&typeof b==="string"?Ext.util.Format.htmlDecode(b):b},postEditValue:function(c,a,b,d){return this.autoEncode&&typeof c=="string"?Ext.util.Format.htmlEncode(c):c},doFocus:function(f){if(this.isVisible()){var d=0,b=this.grid.getColumnModel(),g;if(f){d=this.getTargetColumnIndex(f)}for(var e=d||0,a=b.getColumnCount();e<a;e++){g=b.getColumnAt(e);if(!g.hidden&&g.getEditor&&g.getEditor()){g.getEditor().focus();break}}}},getTargetColumnIndex:function(k){var a=this.grid,j=a.view,h=k.left,f=a.colModel.config,b=0,d=false;for(var e=f.length,g;g=f[b];b++){if(!g.hidden){if(Ext.fly(j.getHeaderCell(b)).getRegion().right>=h){d=b;break}}}return d},startMonitoring:function(){if(!this.bound&&this.monitorValid){this.bound=true;Ext.TaskMgr.start({run:this.bindHandler,interval:this.monitorPoll||200,scope:this})}},stopMonitoring:function(){this.bound=false;if(this.tooltip){this.tooltip.hide()}},isValid:function(){var a=true;this.items.each(function(b){if(!b.isValid(true)){a=false;return false}});return a},bindHandler:function(){if(!this.bound){return false}var a=this.isValid();if(!a&&this.errorSummary){this.showTooltip(this.getErrorText().join(""))}this.btns.saveBtn.setDisabled(!a);this.fireEvent("validation",this,a)},lastVisibleColumn:function(){var a=this.items.getCount()-1,b;for(;a>=0;a--){b=this.items.items[a];if(!b.hidden){return b}}},showTooltip:function(f){var c=this.tooltip;if(!c){c=this.tooltip=new Ext.ToolTip({maxWidth:600,cls:"errorTip",width:300,title:this.errorText,autoHide:false,anchor:"left",anchorToTarget:true,mouseOffset:[40,0]})}var b=this.grid.getView(),e=parseInt(this.el.dom.style.top,10),a=b.scroller.dom.scrollTop,d=this.el.getHeight();if(e+d>=a){c.initTarget(this.lastVisibleColumn().getEl());if(!c.rendered){c.show();c.hide()}c.body.update(f);c.doAutoWidth(20);c.show()}else{if(c.rendered){c.hide()}}},getErrorText:function(){var a=["<ul>"];this.items.each(function(b){if(!b.isValid(true)){a.push("<li>",b.getActiveError(),"</li>")}});a.push("</ul>");return a}})})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.RowExpander=Ext.extend(Ext.util.Observable,{expandOnEnter:true,expandOnDblClick:true,header:"",width:20,sortable:false,fixed:true,hideable:false,menuDisabled:true,dataIndex:"",id:"expander",lazyRender:true,enableCaching:true,constructor:function(a){Ext.apply(this,a);this.addEvents({beforeexpand:true,expand:true,beforecollapse:true,collapse:true});Rs.ext.grid.RowExpander.superclass.constructor.call(this);if(this.tpl){if(typeof this.tpl=="string"){this.tpl=new Ext.Template(this.tpl)}this.tpl.compile()}this.state={};this.bodyContent={}},getRowClass:function(a,e,d,c){d.cols=d.cols-1;var b=this.bodyContent[a.id];if(!b&&!this.lazyRender){b=this.getBodyContent(a,e)}if(b){d.body=b}return this.state[a.id]?"x-grid3-row-expanded":"x-grid3-row-collapsed"},init:function(b){this.grid=b;var a=b.getView();a.getRowClass=this.getRowClass.createDelegate(this);a.enableRowBody=true;b.on("render",this.onRender,this);b.on("destroy",this.onDestroy,this)},onRender:function(){var a=this.grid;var b=a.getView().mainBody;b.on("mousedown",this.onMouseDown,this,{delegate:".x-grid3-row-expander"});if(this.expandOnEnter){this.keyNav=new Ext.KeyNav(this.grid.getGridEl(),{enter:this.onEnter,scope:this})}if(this.expandOnDblClick){a.on("rowdblclick",this.onRowDblClick,this)}},onDestroy:function(){if(this.keyNav){this.keyNav.disable();delete this.keyNav}var a=this.grid.getView().mainBody;if(a){a.un("mousedown",this.onMouseDown,this)}},onRowDblClick:function(a,b,c){this.toggleRow(b)},onEnter:function(h){var f=this.grid;var j=f.getSelectionModel();var b=j.getSelections();for(var c=0,a=b.length;c<a;c++){var d=f.getStore().indexOf(b[c]);this.toggleRow(d)}},getBodyContent:function(a,b){if(!this.enableCaching){return this.tpl.apply(a.data)}var c=this.bodyContent[a.id];if(!c){c=this.tpl.apply(a.data);this.bodyContent[a.id]=c}return c},onMouseDown:function(b,a){b.stopEvent();var c=b.getTarget(".x-grid3-row");this.toggleRow(c)},renderer:function(b,c,a){c.cellAttr='rowspan="2"';return'<div class="x-grid3-row-expander">&#160;</div>'},beforeExpand:function(b,a,c){if(this.fireEvent("beforeexpand",this,b,a,c)!==false){if(this.tpl&&this.lazyRender){a.innerHTML=this.getBodyContent(b,c)}return true}else{return false}},toggleRow:function(a){if(typeof a=="number"){a=this.grid.view.getRow(a)}this[Ext.fly(a).hasClass("x-grid3-row-collapsed")?"expandRow":"collapseRow"](a)},expandRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.DomQuery.selectNode("tr:nth(2) div.x-grid3-row-body",c);if(this.beforeExpand(b,a,c.rowIndex)){this.state[b.id]=true;Ext.fly(c).replaceClass("x-grid3-row-collapsed","x-grid3-row-expanded");this.fireEvent("expand",this,b,a,c.rowIndex)}},collapseRow:function(c){if(typeof c=="number"){c=this.grid.view.getRow(c)}var b=this.grid.store.getAt(c.rowIndex);var a=Ext.fly(c).child("tr:nth(1) div.x-grid3-row-body",true);if(this.fireEvent("beforecollapse",this,b,a,c.rowIndex)!==false){this.state[b.id]=false;Ext.fly(c).replaceClass("x-grid3-row-expanded","x-grid3-row-collapsed");this.fireEvent("collapse",this,b,a,c.rowIndex)}}})})();Ext.ns("Rs.ext.grid");(function(){Rs.ext.grid.ColumnModel=Ext.extend(Ext.grid.ColumnModel,{getColumnHeader:function(a){var b=this.config[a].editor;if(b==null||b==undefined){return this.config[a].header}var c=this.config[a].header;return c+" <span class='rs-cell-editor'>&nbsp;&nbsp;&nbsp;&nbsp;</span>"}})})();Ext.ns("Rs.ext.grid");Rs.ext.grid.EditorGridViewPlugin=function(a){Ext.apply(this,a)};Ext.extend(Rs.ext.grid.EditorGridViewPlugin,Ext.util.Observable,{init:function(b){var a=b.getView();Ext.apply(a,{initTemplates:function(){var e=a.templates||{},f,d,h=new Ext.Template('<td class="x-grid3-hd x-grid3-cell x-grid3-td-{id} {css}" style="{style}">','<div {tooltip} {attr} class="x-grid3-hd-inner x-grid3-hd-{id}" unselectable="on" style="{istyle}">',a.grid.enableHdMenu?'<a class="x-grid3-hd-btn" href="#"></a>':"","{value}",'<img alt="" class="rs-cell-editor" src="',Ext.BLANK_IMAGE_URL,'" />','<img alt="" class="x-grid3-sort-icon" src="',Ext.BLANK_IMAGE_URL,'" />',"</div>","</td>"),c=['<tr class="x-grid3-row-body-tr" style="{bodyStyle}">','<td colspan="{cols}" class="x-grid3-body-cell" tabIndex="0" hidefocus="on">','<div class="x-grid3-row-body">{body}</div>',"</td>","</tr>"].join(""),g=['<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody>","<tr>{cells}</tr>",a.enableRowBody?c:"","</tbody>","</table>"].join("");Ext.applyIf(e,{hcell:h,cell:a.cellTpl,body:a.bodyTpl,header:a.headerTpl,master:a.masterTpl,row:new Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}">'+g+"</div>"),rowInner:new Ext.Template(g)});for(d in e){f=e[d];if(f&&Ext.isFunction(f.compile)&&!f.compiled){f.disableFormats=true;f.compile()}}a.templates=e;a.colRe=new RegExp("x-grid3-td-([^\\s]+)","")},render:function(){if(this.autoFill){var c=this.grid.ownerCt;if(c&&c.getLayout()){c.on("afterlayout",function(){this.fitColumns(true,true);this.updateHeaders();this.updateHeaderSortState()},this,{single:true})}}else{if(this.forceFit){this.fitColumns(true,false)}else{if(this.grid.autoExpandColumn){this.autoExpand(true)}}}this.grid.getGridEl().dom.innerHTML=this.renderUI();this.afterRenderUI();this.updateEditorPen()},updateEditorPen:function(){var f=a.cm.config;for(var e=0,d=f.length;e<d;e++){var g=f[e];if(g.editor){a.mainHd.select("td").item(e).addClass("rs-grid-editor")}}},onDataChange:function(){this.refresh(true);this.updateHeaderSortState();this.updateEditorPen();this.syncFocusEl(0)},onColumnMove:function(c,e,d){this.indexMap=null;this.refresh(true);this.updateEditorPen();this.restoreScroll(this.getScrollState());this.afterMove(d);this.grid.fireEvent("columnmove",e,d)}})}});(function(){Rs.ext.grid.LockingGridView=Ext.extend(Ext.grid.GridView,{lockText:"Lock",unlockText:"Unlock",rowBorderWidth:1,lockedBorderWidth:1,syncHeights:false,initTemplates:function(){var a=this.templates||{};if(!a.masterTpl){a.masterTpl=this.masterTpl}var b=['<table class="x-grid3-row-table" border="0" cellspacing="0" cellpadding="0" style="{tstyle}">',"<tbody>",'<tr style="height:19px;">{cells}</tr>',this.enableRowBody?rowBodyText:"","</tbody>","</table>"].join("");if(!a.row){a.row=new Ext.Template('<div class="x-grid3-row {alt}" style="{tstyle}">'+b+"</div>")}if(!a.rowInner){a.rowInner=new Ext.Template(b)}this.templates=a;Rs.ext.grid.LockingGridView.superclass.initTemplates.call(this)},masterTpl:new Ext.Template('<div class="x-grid3" hidefocus="true">','<div class="x-grid3-locked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{lstyle}">{lockedHeader}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{lstyle}">{lockedBody}</div><div class="x-grid3-scroll-spacer"></div></div>',"</div>",'<div class="x-grid3-viewport x-grid3-unlocked">','<div class="x-grid3-header"><div class="x-grid3-header-inner"><div class="x-grid3-header-offset" style="{ostyle}">{header}</div></div><div class="x-clear"></div></div>','<div class="x-grid3-scroller"><div class="x-grid3-body" style="{bstyle}">{body}</div><a href="#" class="x-grid3-focus" tabIndex="-1"></a></div>',"</div>",'<div class="x-grid3-resize-marker">&#160;</div>','<div class="x-grid3-resize-proxy">&#160;</div>',"</div>"),getEditorParent:function(a){return this.el.dom},initElements:function(){var e=Ext.get(this.grid.getGridEl().dom.firstChild),g=e.child("div.x-grid3-locked"),c=g.child("div.x-grid3-header"),b=g.child("div.x-grid3-scroller"),f=e.child("div.x-grid3-viewport"),d=f.child("div.x-grid3-header"),a=f.child("div.x-grid3-scroller");if(this.grid.hideHeaders){c.setDisplayed(false);d.setDisplayed(false)}if(this.forceFit){a.setStyle("overflow-x","hidden")}Ext.apply(this,{el:e,mainWrap:f,mainHd:d,innerHd:d.dom.firstChild,scroller:a,mainBody:a.child("div.x-grid3-body"),focusEl:a.child("a"),resizeMarker:e.child("div.x-grid3-resize-marker"),resizeProxy:e.child("div.x-grid3-resize-proxy"),lockedWrap:g,lockedHd:c,lockedScroller:b,lockedBody:b.child("div.x-grid3-body"),lockedInnerHd:c.child("div.x-grid3-header-inner",true)});this.focusEl.swallowEvent("click",true)},getLockedRows:function(){return this.hasRows()?this.lockedBody.dom.childNodes:[]},getLockedRow:function(a){return this.getLockedRows()[a]},getCell:function(c,a){var b=this.cm.getLockedCount();if(a<b){return this.getLockedRow(c).getElementsByTagName("td")[a]}return Rs.ext.grid.LockingGridView.superclass.getCell.call(this,c,a-b)},getHeaderCell:function(a){var d=this.cm.getLockedCount();var c=this.lockedHd.dom.getElementsByTagName("td");if(a<d){if(c[a]){return c[a]}else{return this.el.dom.getElementsByTagName("td")[a]}}var b=this.mainHd.dom.getElementsByTagName("td");if(b[a-d]){return b[a-d]}return this.el.dom.getElementsByTagName("td")[a]},addRowClass:function(c,a){var b=this.getLockedRow(c);if(b){this.fly(b).addClass(a)}Rs.ext.grid.LockingGridView.superclass.addRowClass.call(this,c,a)},removeRowClass:function(c,a){var b=this.getLockedRow(c);if(b){this.fly(b).removeClass(a)}Rs.ext.grid.LockingGridView.superclass.removeRowClass.call(this,c,a)},removeRow:function(a){Ext.removeNode(this.getLockedRow(a));Rs.ext.grid.LockingGridView.superclass.removeRow.call(this,a)},removeRows:function(c,b){var a=this.lockedBody.dom,d=c;for(;d<=b;d++){Ext.removeNode(a.childNodes[c])}Rs.ext.grid.LockingGridView.superclass.removeRows.call(this,c,b)},syncScroll:function(a){this.lockedScroller.dom.scrollTop=this.scroller.dom.scrollTop;Rs.ext.grid.LockingGridView.superclass.syncScroll.call(this,a)},updateSortIcon:function(d,c){var a=this.sortClasses,e=this.lockedHd.select("td").removeClass(a),g=this.mainHd.select("td").removeClass(a),f=this.cm.getLockedCount(),b=a[c=="DESC"?1:0];if(d<f){e.item(d).addClass(b)}else{g.item(d-f).addClass(b)}},updateAllColumnWidths:function(){var g=this.getTotalWidth(),n=this.cm.getColumnCount(),b=this.getLockedWidth(),d=this.cm.getLockedCount(),k=[],h,e;this.updateLockedWidth();for(e=0;e<n;e++){k[e]=this.getColumnWidth(e);var f=this.getHeaderCell(e);f.style.width=k[e]}var a=this.getLockedRows(),m=this.getRows(),o,l,c;for(e=0,h=m.length;e<h;e++){o=a[e];o.style.width=b;if(o.firstChild){o.firstChild.style.width=b;l=o.firstChild.rows[0];for(c=0;c<d;c++){l.childNodes[c].style.width=k[c]}}o=m[e];o.style.width=g;if(o.firstChild){o.firstChild.style.width=g;l=o.firstChild.rows[0];for(c=d;c<n;c++){l.childNodes[c-d].style.width=k[c]}}}this.onAllColumnWidthsUpdated(k,g);this.syncHeaderHeight()},updateColumnWidth:function(d,a){var l=this.getColumnWidth(d),e=this.cm.getLockedCount(),k,b,j,m;this.updateLockedWidth();if(d<e){k=this.getLockedRows();b=this.getLockedWidth();j=d}else{k=this.getRows();b=this.getTotalWidth();j=d-e}var g=this.getHeaderCell(d);g.style.width=l;for(var f=0,h=k.length;f<h;f++){m=k[f];m.style.width=b;if(m.firstChild){m.firstChild.style.width=b;m.firstChild.rows[0].childNodes[j].style.width=l}}this.onColumnWidthUpdated(d,l,this.getTotalWidth());this.syncHeaderHeight()},updateColumnHidden:function(b,g){var d=this.cm.getLockedCount(),l,a,k,m,j=g?"none":"";this.updateLockedWidth();if(b<d){l=this.getLockedRows();a=this.getLockedWidth();k=b}else{l=this.getRows();a=this.getTotalWidth();k=b-d}var f=this.getHeaderCell(b);f.style.display=j;for(var e=0,h=l.length;e<h;e++){m=l[e];m.style.width=a;if(m.firstChild){m.firstChild.style.width=a;m.firstChild.rows[0].childNodes[k].style.display=j}}this.onColumnHiddenUpdated(b,g,this.getTotalWidth());delete this.lastViewWidth;this.layout()},doRender:function(g,l,t,a,s,x){var d=this.templates,f=d.cell,h=d.row,n=s-1,e="width:"+this.getTotalWidth()+";",b="width:"+this.getLockedWidth()+";",A=[],D=[],v,k,B,u={},m={},q;for(var w=0,z=l.length;w<z;w++){q=l[w];v=[];k=[];var o=(w+a);for(var y=0;y<s;y++){B=g[y];u.id=B.id;u.css=(y===0?"x-grid3-cell-first ":(y==n?"x-grid3-cell-last ":""))+(this.cm.config[y].cellCls?" "+this.cm.config[y].cellCls:"");u.attr=u.cellAttr="";u.value=B.renderer.call(B.scope,q.data[B.name],u,q,o,y,t);u.style=B.style;if(Ext.isEmpty(u.value)){u.value="&#160;"}if(this.markDirty&&q.dirty&&Ext.isDefined(q.modified[B.name])){u.css+=" x-grid3-dirty-cell"}if(B.locked){k[k.length]=f.apply(u)}else{v[v.length]=f.apply(u)}}var C=[];if(x&&((o+1)%2===0)){C[0]="x-grid3-row-alt"}if(q.dirty){C[1]=" x-grid3-dirty-row"}m.cols=s;if(this.getRowClass){C[2]=this.getRowClass(q,o,m,t)}m.alt=C.join(" ");m.cells=v.join("");m.tstyle=e;A[A.length]=h.apply(m);m.cells=k.join("");m.tstyle=b;D[D.length]=h.apply(m)}return[A.join(""),D.join("")]},processRows:function(b,h){if(!this.ds||this.ds.getCount()<1){return}var f=this.getRows(),e=this.getLockedRows(),g,d;h=h||!this.grid.stripeRows;b=b||0;for(var c=0,a=f.length;c<a;++c){g=f[c];d=e[c];g.rowIndex=c;d.rowIndex=c;if(!h){g.className=g.className.replace(this.rowClsRe," ");d.className=d.className.replace(this.rowClsRe," ");if((c+1)%2===0){g.className+=" x-grid3-row-alt";d.className+=" x-grid3-row-alt"}}this.syncRowHeights(g,d)}if(b===0){Ext.fly(f[0]).addClass(this.firstRowCls);Ext.fly(e[0]).addClass(this.firstRowCls)}Ext.fly(f[f.length-1]).addClass(this.lastRowCls);Ext.fly(e[e.length-1]).addClass(this.lastRowCls)},syncRowHeights:function(f,e){if(this.syncHeights){var d=Ext.get(f),b=Ext.get(e),c=d.getHeight(),a=b.getHeight();if(c>a){b.setHeight(c)}else{if(a>c){d.setHeight(a)}}}},afterRender:function(){if(!this.ds||!this.cm){return}var a=this.renderRows()||["&#160;","&#160;"];this.mainBody.dom.innerHTML=a[0];this.lockedBody.dom.innerHTML=a[1];this.processRows(0,true);if(this.deferEmptyText!==true){this.applyEmptyText()}this.grid.fireEvent("viewready",this.grid)},renderUI:function(){var b=this.templates,c=this.renderHeaders(),a=b.body.apply({rows:"&#160;"});return b.masterTpl.apply({body:a,header:c[0],ostyle:"width:"+this.getOffsetWidth()+";",bstyle:"width:"+this.getTotalWidth()+";",lockedBody:a,lockedHeader:c[1],lstyle:"width:"+this.getLockedWidth()+";"})},afterRenderUI:function(){var a=this.grid;this.initElements();Ext.fly(this.innerHd).on("click",this.handleHdDown,this);Ext.fly(this.lockedInnerHd).on("click",this.handleHdDown,this);this.mainHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.lockedHd.on({scope:this,mouseover:this.handleHdOver,mouseout:this.handleHdOut,mousemove:this.handleHdMove});this.scroller.on("scroll",this.syncScroll,this);if(a.enableColumnResize!==false){this.splitZone=new Ext.grid.GridView.SplitDragZone(a,this.mainHd.dom);this.splitZone.setOuterHandleElId(Ext.id(this.lockedHd.dom));this.splitZone.setOuterHandleElId(Ext.id(this.mainHd.dom))}if(a.enableColumnMove){this.columnDrag=new Ext.grid.GridView.ColumnDragZone(a,this.innerHd);this.columnDrag.setOuterHandleElId(Ext.id(this.lockedInnerHd));this.columnDrag.setOuterHandleElId(Ext.id(this.innerHd));this.columnDrop=new Ext.grid.HeaderDropZone(a,this.mainHd.dom)}if(a.enableHdMenu!==false){this.hmenu=new Ext.menu.Menu({id:a.id+"-hctx"});this.hmenu.add({itemId:"asc",text:this.sortAscText,cls:"xg-hmenu-sort-asc"},{itemId:"desc",text:this.sortDescText,cls:"xg-hmenu-sort-desc"});if(this.grid.enableColLock!==false){this.hmenu.add("-",{itemId:"lock",text:this.lockText,cls:"xg-hmenu-lock"},{itemId:"unlock",text:this.unlockText,cls:"xg-hmenu-unlock"})}if(a.enableColumnHide!==false){this.colMenu=new Ext.menu.Menu({id:a.id+"-hcols-menu"});this.colMenu.on({scope:this,beforeshow:this.beforeColMenuShow,itemclick:this.handleHdMenuClick});this.hmenu.add("-",{itemId:"columns",hideOnClick:false,text:this.columnsText,menu:this.colMenu,iconCls:"x-cols-icon"})}this.hmenu.on("itemclick",this.handleHdMenuClick,this)}if(a.trackMouseOver){this.mainBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut});this.lockedBody.on({scope:this,mouseover:this.onRowOver,mouseout:this.onRowOut})}if(a.enableDragDrop||a.enableDrag){this.dragZone=new Ext.grid.GridDragZone(a,{ddGroup:a.ddGroup||"GridDD"})}this.updateHeaderSortState()},layout:function(){if(!this.mainBody){return}var d=this.grid;var h=d.getGridEl();var a=h.getSize(true);var b=a.width;if(!d.hideHeaders&&(b<20||a.height<20)){return}this.syncHeaderHeight();if(d.autoHeight){this.scroller.dom.style.overflow="visible";this.lockedScroller.dom.style.overflow="visible";if(Ext.isWebKit){this.scroller.dom.style.position="static";this.lockedScroller.dom.style.position="static"}}else{this.el.setSize(a.width,a.height);var f=this.mainHd.getHeight();var e=a.height-(f)}this.updateLockedWidth();if(this.forceFit){if(this.lastViewWidth!=b){this.fitColumns(false,false);this.lastViewWidth=b}}else{this.autoExpand();this.syncHeaderScroll()}this.onLayout(b,e)},getOffsetWidth:function(){return(this.cm.getTotalWidth()-this.cm.getTotalLockedWidth()+this.getScrollOffset())+"px"},renderHeaders:function(){var h=this.cm,f=this.templates,d=f.hcell,b=[],g=[],a={},e=h.getColumnCount(),j=e-1;for(var c=0;c<e;c++){a.id=h.getColumnId(c);a.value=h.getColumnHeader(c)||"";a.style=this.getColumnStyle(c,true);a.tooltip=this.getColumnTooltip(c);a.css=(c===0?"x-grid3-cell-first ":(c==j?"x-grid3-cell-last ":""))+(h.config[c].headerCls?" "+h.config[c].headerCls:"");if(h.config[c].align=="right"){a.istyle="padding-right:16px"}else{delete a.istyle}if(h.isLocked(c)){g[g.length]=d.apply(a)}else{b[b.length]=d.apply(a)}}return[f.header.apply({cells:b.join(""),tstyle:"width:"+this.getTotalWidth()+";"}),f.header.apply({cells:g.join(""),tstyle:"width:"+this.getLockedWidth()+";"})]},updateHeaders:function(){var b=this.renderHeaders();this.innerHd.firstChild.innerHTML=b[0];this.innerHd.firstChild.style.width=this.getOffsetWidth();this.innerHd.firstChild.firstChild.style.width=this.getTotalWidth();this.lockedInnerHd.firstChild.innerHTML=b[1];var a=this.getLockedWidth();this.lockedInnerHd.firstChild.style.width=a;this.lockedInnerHd.firstChild.firstChild.style.width=a},getResolvedXY:function(a){if(!a){return null}var d=a.cell,b=a.row;return d?Ext.fly(d).getXY():[this.scroller.getX(),Ext.fly(b).getY()]},syncFocusEl:function(c,a,b){Rs.ext.grid.LockingGridView.superclass.syncFocusEl.call(this,c,a,a<this.cm.getLockedCount()?false:b)},ensureVisible:function(c,a,b){return Rs.ext.grid.LockingGridView.superclass.ensureVisible.call(this,c,a,a<this.cm.getLockedCount()?false:b)},insertRows:function(a,g,d,f){var c=a.getCount()-1;if(!f&&g===0&&d>=c){this.refresh()}else{if(!f){this.fireEvent("beforerowsinserted",this,g,d)}var b=this.renderRows(g,d),e=this.getRow(g);if(e){if(g===0){this.removeRowClass(0,this.firstRowCls)}Ext.DomHelper.insertHtml("beforeBegin",e,b[0]);e=this.getLockedRow(g);Ext.DomHelper.insertHtml("beforeBegin",e,b[1])}else{this.removeRowClass(c-1,this.lastRowCls);Ext.DomHelper.insertHtml("beforeEnd",this.mainBody.dom,b[0]);Ext.DomHelper.insertHtml("beforeEnd",this.lockedBody.dom,b[1])}if(!f){this.fireEvent("rowsinserted",this,g,d);this.processRows(g)}else{if(g===0||g>=c){this.addRowClass(g,g===0?this.firstRowCls:this.lastRowCls)}}}this.syncFocusEl(g)},getColumnStyle:function(a,c){var b=!c?this.cm.config[a].cellStyle||this.cm.config[a].css||"":this.cm.config[a].headerStyle||"";b+="width:"+this.getColumnWidth(a)+";";if(this.cm.isHidden(a)){b+="display:none;"}var d=this.cm.config[a].align;if(d){b+="text-align:"+d+";"}return b},getLockedWidth:function(){return this.cm.getTotalLockedWidth()+"px"},getTotalWidth:function(){return(this.cm.getTotalWidth()-this.cm.getTotalLockedWidth())+"px"},getColumnData:function(){var d=[],a=this.cm,e=a.getColumnCount();for(var c=0;c<e;c++){var b=a.getDataIndex(c);d[c]={name:(!Ext.isDefined(b)?this.ds.fields.get(c).name:b),renderer:a.getRenderer(c),scope:a.getRendererScope(c),id:a.getColumnId(c),style:this.getColumnStyle(c),locked:a.isLocked(c)}}return d},renderBody:function(){var a=this.renderRows()||["&#160;","&#160;"];return[this.templates.body.apply({rows:a[0]}),this.templates.body.apply({rows:a[1]})]},refreshRow:function(c){var g=this.ds,r=this.cm.getColumnCount(),b=this.getColumnData(),l=r-1,a=["x-grid3-row"],k={tstyle:String.format("width: {0};",this.getTotalWidth())},j={tstyle:String.format("width: {0};",this.getLockedWidth())},f=[],e=[],o=this.templates.cell,n,h,m,d,q,p,s;if(Ext.isNumber(c)){n=c;c=g.getAt(n)}else{n=g.indexOf(c)}if(!c||n<0){return}for(s=0;s<r;s++){d=b[s];if(s==0){p="x-grid3-cell-first"}else{p=(s==l)?"x-grid3-cell-last ":""}q={id:d.id,style:d.style,css:p,attr:"",cellAttr:""};q.value=d.renderer.call(d.scope,c.data[d.name],q,c,n,s,g);if(Ext.isEmpty(q.value)){q.value=" "}if(this.markDirty&&c.dirty&&typeof c.modified[d.name]!="undefined"){q.css+=" x-grid3-dirty-cell"}if(d.columnlocked){e[s]=o.apply(q)}else{f[s]=o.apply(q)}}h=this.getRow(n);h.className="";m=this.getLockedRow(n);m.className="";if(this.grid.stripeRows&&((n+1)%2===0)){a.push("x-grid3-row-alt")}if(this.getRowClass){k.cols=r;a.push(this.getRowClass(c,n,k,g))}this.fly(h).addClass(a).setStyle(k.tstyle);k.cells=f.join("");h.innerHTML=this.templates.rowInner.apply(k);this.fly(m).addClass(a).setStyle(j.tstyle);j.cells=e.join("");m.innerHTML=this.templates.rowInner.apply(j);m.rowIndex=n;this.syncRowHeights(h,m);this.fireEvent("rowupdated",this,n,c)},refresh:function(b){this.fireEvent("beforerefresh",this);this.grid.stopEditing(true);var a=this.renderBody();this.mainBody.update(a[0]).setWidth(this.getTotalWidth());this.lockedBody.update(a[1]).setWidth(this.getLockedWidth());if(b===true){this.updateHeaders();this.updateHeaderSortState()}this.processRows(0,true);this.layout();this.applyEmptyText();this.fireEvent("refresh",this)},onDenyColumnLock:function(){},initData:function(b,a){if(this.cm){this.cm.un("columnlockchange",this.onColumnLock,this)}Rs.ext.grid.LockingGridView.superclass.initData.call(this,b,a);if(this.cm){this.cm.on("columnlockchange",this.onColumnLock,this)}},onColumnLock:function(){this.refresh(true)},handleHdMenuClick:function(d){var b=this.hdCtxIndex,a=this.cm,e=d.getItemId(),c=a.getLockedCount();switch(e){case"lock":if(a.getColumnCount(true)<=c+1){this.onDenyColumnLock();return undefined}a.setLocked(b,true);if(c!=b){a.moveColumn(b,c)}this.grid.fireEvent("columnmove",b,c);break;case"unlock":if(c-1!=b){a.setLocked(b,false,true);a.moveColumn(b,c-1)}else{a.setLocked(b,false)}this.grid.fireEvent("columnmove",b,c-1);break;default:return Rs.ext.grid.LockingGridView.superclass.handleHdMenuClick.call(this,d)}return true},handleHdDown:function(g,d){Rs.ext.grid.LockingGridView.superclass.handleHdDown.call(this,g,d);if(this.grid.enableColLock!==false){if(Ext.fly(d).hasClass("x-grid3-hd-btn")){var f=this.findHeaderCell(d),c=this.getCellIndex(f),b=this.hmenu.items,a=this.cm;b.get("lock").setDisabled(a.isLocked(c));b.get("unlock").setDisabled(!a.isLocked(c))}}},syncHeaderHeight:function(){var d=Ext.fly(this.innerHd).child("tr",true),b=Ext.fly(this.lockedInnerHd).child("tr",true);d.style.height="auto";b.style.height="auto";var e=d.offsetHeight,c=b.offsetHeight,a=Math.max(c,e)+"px";d.style.height=a;b.style.height=a},updateLockedWidth:function(){var g=this.cm.getTotalLockedWidth(),a=this.cm.getTotalWidth()-g,c=this.grid.getGridEl().getSize(true),b=Ext.isBorderBox?0:this.lockedBorderWidth,d=Ext.isBorderBox?0:this.rowBorderWidth,e=(c.width-g-b-d)+"px",f=this.getScrollOffset();if(!this.grid.autoHeight){var h=(c.height-this.mainHd.getHeight())+"px";this.lockedScroller.dom.style.height=h;this.scroller.dom.style.height=h}this.lockedWrap.dom.style.width=(g+d)+"px";this.scroller.dom.style.width=e;this.mainWrap.dom.style.left=(g+b+d)+"px";if(this.innerHd){this.lockedInnerHd.firstChild.style.width=g+"px";this.lockedInnerHd.firstChild.firstChild.style.width=g+"px";this.innerHd.style.width=e;this.innerHd.firstChild.style.width=(a+d+f)+"px";this.innerHd.firstChild.firstChild.style.width=a+"px"}if(this.mainBody){this.lockedBody.dom.style.width=(g+d)+"px";this.mainBody.dom.style.width=(a+d)+"px"}}})})();(function(){Rs.ext.grid.LockingColumnModel=Ext.extend(Rs.ext.grid.ColumnModel,{isLocked:function(a){return this.config[a].columnlocked===true},setLocked:function(b,c,a){if(this.isLocked(b)==c){return}this.config[b].columnlocked=c;if(!a){this.fireEvent("columnlockchange",this,b,c)}},getTotalLockedWidth:function(){var b=0;for(var c=0,a=this.config.length;c<a;c++){if(this.isLocked(c)&&!this.isHidden(c)){b+=this.getColumnWidth(c)}}return b},getLockedCount:function(){var a=this.config.length;var c=0;for(var b=0;b<a;b++){if(this.isLocked(b)){c++}}return c},moveColumn:function(d,c){var a=this.isLocked(d),b=this.isLocked(c);if(d<c&&a&&!b){this.setLocked(d,false,true)}else{if(d>c&&!a&&b){this.setLocked(d,true,true)}}Rs.ext.grid.LockingColumnModel.superclass.moveColumn.apply(this,arguments)}})})();Ext.namespace("Rs.ext.grid");(function(){Rs.ext.grid.PagingSelectPlugin=function(a){this.cfg=a;Ext.apply(this,a);this.addEvents("submit")};Ext.extend(Rs.ext.grid.PagingSelectPlugin,Ext.util.Observable,{init:function(a){this.grid=a},initWindow:function(c){var f=this.createStore(c);var g=this.createSelectModel(c);var h=this.createColumnModel(c,g);this.leftGrid=new Ext.grid.GridPanel({border:false,hideBorders:true,store:f,sm:g,stripeRows:true,colModel:h,clicksToEdit:1,bbar:new Rs.ext.grid.SliderPagingToolbar({pageSize:10,hasSlider:false,store:f,displayInfo:false})});var a=new Ext.data.JsonStore({fields:c.store.fields.keys});var d=this.createSelectModel(c);var e=this.createColumnModel(c,d);this.rightGrid=new Ext.grid.GridPanel({border:false,hideBorders:true,store:a,sm:d,stripeRows:true,colModel:e,clicksToEdit:1});this.buttonPanel=new Ext.Panel({layout:"vbox",layoutConfig:{align:"center",pack:"center"},defaults:{margins:"10 0 10 0"},frame:true,border:false,hideBorders:true,items:[new Ext.Button({tooltip:"添加",iconCls:"rs-action-goright",handler:this.doAppend,scope:this}),new Ext.Button({tooltip:"移除",iconCls:"rs-action-goleft",handler:this.doRemove,scope:this}),new Ext.Button({tooltip:"全部添加",iconCls:"rs-action-bacthgoright",handler:this.doAppendAll,scope:this}),new Ext.Button({tooltip:"全部移除",iconCls:"rs-action-bacthgoleft",handler:this.doRemoveAll,scope:this})]});var b={layout:"fit",closable:true,modal:true,resizable:true,border:false,hideBorders:true,width:800,height:600,items:[{layout:"column",items:[{columnWidth:0.5,layout:"fit",items:[this.leftGrid]},{padding:2,margins:3,items:[this.buttonPanel]},{columnWidth:0.5,layout:"fit",items:[this.rightGrid]}]}],buttonAlign:"center",buttons:[{xtype:"button",text:"确定",iconCls:"rs-action-ok",handler:this.doSubmit,scope:this},{xtype:"button",text:"取消",iconCls:"rs-action-cancel",handler:this.doCancel,scope:this}],listeners:{resize:this.doLayoutPanel,scope:this}};Rs.apply(b,this.cfg);this.win=new Ext.Window(b)},doLayoutPanel:function(d){var a=d.getInnerHeight()-2,b=d.getInnerWidth();this.leftGrid.setHeight(a);this.buttonPanel.setHeight(a);this.rightGrid.setHeight(a)},createStore:function(b){var a=this.createStoreConfig(b);return new Rs.ext.data.Store(a)},createStoreConfig:function(b){var a=b.getStore(),c=Rs.apply(c||{},a.baseParams);cfg={autoLoad:true,autoDestroy:true,url:a.url,fields:a.fields.keys,baseParams:c};if(a.sortInfo){Rs.apply(cfg,{sortInfo:a.sortInfo})}if(a.idProperty){Rs.apply(cfg,{idProperty:a.idProperty})}return cfg},createColumnModel:function(c,d){var a=c.getColumnModel();var b=[d];Ext.each(a.config,function(g,f,e){if(!(g instanceof Ext.grid.AbstractSelectionModel||g instanceof Ext.grid.ActionColumn)){b.push(Rs.apply({},g))}},this);return new Ext.grid.ColumnModel(b)},createSelectModel:function(a){var b=a.getSelectionModel();if(b instanceof Ext.grid.CheckboxSelectionModel){b=new Ext.grid.CheckboxSelectionModel()}else{b=new Rs.ext.grid.CheckboxCellSelectionModel({})}return b},doAppend:function(){var d=this.leftGrid.getSelectionModel(),b=d.getSelections(),a=this.rightGrid.getStore();var c=[];Ext.each(b,function(e,g,f){if(a.getRange().indexOf(e)==-1){c.push(e)}},this);if(!Ext.isEmpty(c)){this.rightGrid.getStore().add(c)}},doRemove:function(){var a=this.rightGrid.getSelectionModel().getSelections();if(!Ext.isEmpty(a)){this.rightGrid.getStore().remove(a)}},doAppendAll:function(){this.leftGrid.getSelectionModel().selectAll();this.doAppend()},doRemoveAll:function(){this.rightGrid.getStore().removeAll()},doSubmit:function(){this.fireEvent("submit",this.plugin,this.win,this.rightGrid.getStore().getRange(),this)},doCancel:function(){this.win.close()},getLeftGrid:function(){return this.leftGrid},getRightGrid:function(){return this.rightGrid},getPluginWindow:function(){this.initWindow(this.grid);return this.win}})})();Ext.ns("Rs.ext.gird.plugin");(function(){Rs.ext.gird.plugin.GridCreateRecordPlugin=function(a){Ext.apply(this,a);this.addEvents("beforecreatenewline","aftercreatenewline","validatenotpass","validatepass");Rs.ext.gird.plugin.GridCreateRecordPlugin.superclass.constructor.apply(this,arguments)};Ext.extend(Rs.ext.gird.plugin.GridCreateRecordPlugin,Ext.util.Observable,{buttonPosition:0,createDefaultJson:{},validateEditors:[],init:function(b){this.grid=b;var a=this;Ext.each(this.validateEditors,function(e,d,f){if(e.isFormField){e.on({scope:this,change:this.validateRemoteDataUnique.createDelegate(this.grid,[a],true)})}},this);var c=new Ext.KeyMap(Ext.getBody(),{key:[78],ctrl:false,alt:false,shift:true,fn:this.newAddLine,scope:this});this.initCreateButton()},initCreateButton:function(){var a=this.grid.getTopToolbar();this.addButton=new Ext.Button({text:"新增",iconCls:"rs-action-create",tooltip:"新增操作",tooltipType:"qtip",handler:this.newAddLine,scope:this});a.insert(this.buttonPosition,this.addButton)},newAddLine:function(){if(this.fireEvent("beforecreatenewline",this.grid,this)!==false){var e={};Rs.apply(e,this.createDefaultJson);var d=this.grid;var c=d.getStore(),a=new c.recordType(e);a.data.rowType="N";d.stopEditing();var b="#"+((d.addColor&&d.addColor.getValue())||"CAF9DB");if(d.position&&d.position.getValue()["inputValue"]===1){c.insert(0,a);a.commit();d.view.getRow(0).setAttribute("style","background-color:"+b)}else{c.insert(c.getCount(),a);a.commit();d.view.getRow(c.getCount()-1).setAttribute("style","background-color:"+b)}this.fireEvent("aftercreatenewline",this.grid,this)}},validateRemoteDataUnique:function(c,f,b,a){var d=c.gridEditor.record;if(!Ext.isEmpty(a.params)&&!Ext.isObject(a.params)){throw Rs.error("params is not Object")}var g=a.params||{},e=true;if(Ext.isArray(a.validateEditors)){Ext.each(a.validateEditors,function(k,j,o){try{if(k.isFormField){var h=this.getColumnModel().getColumnsBy(function(q,p){return q.editor===k},this);var l=h[0]["dataIndex"||"id"];if(k===c){g[l]=f.trim()}else{var m=d.get(l);g[l]=m?m.trim():""}}else{var m=d.get(k);g[k]=m?m.trim():""}}catch(n){e=false;return}},this)}else{Rs.error("您的异步验证规则validateEditors配置错误，请检查！")}if(!e){return}Rs.Service.call({url:this.store.url,method:"validate",params:{params:g}},function(h){if(h.success!=="true"){var j=function(){a.fireEvent("validatenotpass",d,this.grid,a,h)};Ext.MessageBox.show({title:"错误",msg:h.msg,fn:j,buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR})}else{a.fireEvent("validatepass",d,this.grid,a,h)}},this)}});Ext.reg("rs-ext-plugin-gridcreaterecordplugin",Rs.ext.gird.plugin.GridCreateRecordPlugin)})();Ext.ns("Rs.ext.gird.plugin");Rs.ext.gird.plugin.GridDeleteRecordPlugin=function(a){Ext.apply(this,a);this.addEvents("beforedelete","deletefailure","deletesuccess");Rs.ext.gird.plugin.GridDeleteRecordPlugin.superclass.constructor.apply(this,arguments)};Ext.extend(Rs.ext.gird.plugin.GridDeleteRecordPlugin,Ext.util.Observable,{buttonPosition:1,destroyMethod:"destroy",fields:null,deleteMsg:"您确定要删除选中的记录吗?",noSavaMsg:"您有数据尚未保存，是否继续删除操作?",init:function(b){this.grid=b;var a=this;var c=new Ext.KeyMap(Ext.getBody(),{key:[68],ctrl:false,alt:false,shift:true,fn:this.deleteRecord.createDelegate(this.grid,[a],0),scope:this});this.initDeleteButton()},initDeleteButton:function(){var b=this.grid.getTopToolbar();var a=this;this.deleteButton=new Ext.Button({text:"删除",iconCls:"rs-action-remove",tooltip:"删除操作",tooltipType:"qtip",handler:this.deleteRecord.createDelegate(this.grid,[a],0),scope:this});b.insert(1,this.deleteButton)},deleteRecord:function(d){var a=d;var c=this.getSelectionModel().getSelections(),e=this.getStore();if(!c||c.length<1){Ext.MessageBox.show({title:"错误",msg:"请先选择要删除的数据行",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var b=function(j,k,h){if(j==="ok"){var g=a.doDeleteAction;if(a.fireEvent("beforedelete",this,a,g)!==false){a.doDeleteAction(this,a)}}};var f=this.getStore().getModifiedRecords();if(!Ext.isEmpty(f)){Ext.MessageBox.show({title:"提示",msg:d.noSavaMsg+"<br/>选择【确定】则执行删除操作，且删除的数据不可恢复。<br/>选择【取消】则返回",buttons:Ext.MessageBox.OKCANCEL,fn:b,icon:Ext.MessageBox.QUESTION,scope:this});return}Ext.Msg.show({title:"提示",msg:d.deleteMsg+"<br/>选择【确定】则执行删除操作，且删除的数据不可恢复。<br/>选择【取消】则返回",buttons:Ext.Msg.OKCANCEL,icon:Ext.MessageBox.QUESTION,fn:b,scope:this})},doDeleteAction:function(e,c){var d=e.getSelectionModel().getSelections(),g=e.getStore();g.remove(d);g.modified=[];var b=g.removed;var f=[];var a=c.fields;Ext.each(b,function(k,l,j){if(Ext.isArray(a)){var m={};Ext.each(a,function(p,o,n){m[p]=k.get(p);m[g.writer.meta.idProperty]=k.id});f.push(m)}else{if(!Ext.isEmpty(a)){var m={};m[a]=k.get(a);m[g.writer.meta.idProperty]=k.id;f.push(m)}else{var m={};m[g.writer.meta.idProperty]=k.id;f.push(m)}}},this);var h={};Rs.apply(h,g.baseParams,{xaction:c.destroyMethod,data:f});Rs.Service.call({url:g.url,method:c.destroyMethod,params:{params:h}},function(j){if(j.success==false){c.fireEvent("deletefailure",e,c,j)}else{c.fireEvent("deletesuccess",e,c,j)}g.removed=[]},this)}});Ext.ns("Rs.ext.gird.plugin");(function(){Rs.ext.gird.plugin.GridSaveRecordPlugin=function(a){Ext.apply(this,a);this.addEvents("beforemodify","modifyfailure","modifysuccess","beforecreate","createfailure","createsuccess");Rs.ext.gird.plugin.GridSaveRecordPlugin.superclass.constructor.apply(this,arguments)};Ext.extend(Rs.ext.gird.plugin.GridSaveRecordPlugin,Ext.util.Observable,{buttonPosition:2,rules:{},uniqueFields:[],modifyMethod:"update",modifySuccessMethod:Ext.emptyFn,modifyFailureMethod:Ext.emptyFn,modifyFields:null,createMethod:"create",init:function(b){this.grid=b;var a=this;this.grid.store.on("load",function(e,d,f){e.on("beforeload",a.beforeLoadCheckData,a)},this);var c=new Ext.KeyMap(Ext.getBody(),{key:[83],ctrl:false,alt:false,shift:true,fn:this.doSave.createDelegate(this.grid,[a],0),scope:this});this.initSaveButton()},initSaveButton:function(){var b=this.grid.getTopToolbar();var a=this;this.saveButton=new Ext.Button({text:"保存",iconCls:"rs-action-save",tooltip:"保存操作",tooltipType:"qtip",handler:this.doSave.createDelegate(this.grid,[a],0),scope:this});b.insertButton(2,[this.saveButton,"-"])},doSave:function(l){var k=l.rules,a=l.uniqueFields;var h=this.getStore(),j=h.getModifiedRecords();if(j.length>0){var d=l.doCheckMustInputField(k,j);if(!Ext.isEmpty(d)){Ext.MessageBox.show({title:"错误",msg:d.join("<br/>"),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}d=l.validateLocalDataUnique(a);if(!Ext.isEmpty(d)){Ext.MessageBox.show({title:"错误",msg:d.join("<br/>"),buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.ERROR});return}var e=l.getModifyCreateRecord(h);var f=e[0],c=e[1];if(!Ext.isEmpty(c)){var g=l.doModifyAction;if(l.fireEvent("beforemodify",this,l,g)!==false){l.doModifyAction(this,l)}return}if(!Ext.isEmpty(f)){var b=l.doCreateAction;if(l.fireEvent("beforecreate",this,l,b)!==false){l.doCreateAction(this,l)}}}else{Ext.MessageBox.show({title:"提示",msg:"数据没有发生变化,不需要保存",buttons:Ext.MessageBox.OK,icon:Ext.MessageBox.INFO})}},doModifyAction:function(a,k){var j=a.getStore();var f=k.getModifyCreateRecord(j);var g=f[0],d=f[1];var e=[],h=k.modifyFields,c=[];Ext.each(d,function(l,n,m){var q={};if(Ext.isArray(h)){Ext.each(h,function(s,p,r){q[s]=l.get(s)})}else{if(!Ext.isEmpty(h)){q[h]=l.get(h)}}q[j.writer.meta.idProperty]=l.id;for(var o in l.modified){q[o]=l.get(o)}e.push(q)},this);var b={};Rs.apply(b,j.baseParams,{xaction:k.modifyMethod,data:e.concat(c)});Rs.Service.call({url:j.url,method:k.modifyMethod,params:{params:b}},function(l){var m=!Ext.isEmpty(g);if(l.success==false){if(k.fireEvent("modifyfailure",a,k,l,m)!==false){if(k.modifyFailureMethod.call(k,a,k,l,m)!==false){if(!Ext.isEmpty(g)){var n=function(p,q,o){if(p==="ok"){k.removeModifyRecord(a,l.data);k.doCreateAction(a,k)}};Ext.MessageBox.show({title:"提示",msg:"您修改数据保存出错,是否继续保存新增的数据?<br>选择【确定】则继续保存新增数据。<br/>选择【取消】则返回!",buttons:Ext.MessageBox.OKCANCEL,fn:n,icon:Ext.MessageBox.QUESTION,scope:k})}}}}else{k.removeModifyRecord(a,l.data);if(k.fireEvent("modifysuccess",a,k,l,m)!==false){if(k.modifySuccessMethod.call(k,a,k,l,m)!==false){if(!Ext.isEmpty(g)){k.doCreateAction(a,k)}}}}},this)},doCreateAction:function(d,c){var b=d.getStore();var a=c.getModifyCreateRecord(b);var e=a[0];var f=[];Ext.each(e,function(h,j,k){delete h.data.rowType;f.push(h.data)},this);var g={};Rs.apply(g,b.baseParams,{xaction:c.createMethod,data:f});Rs.Service.call({url:b.url,method:c.createMethod,params:{params:g}},function(h){if(h.success==false){c.fireEvent("createfailure",d,c,h)}else{c.removeModifyRecord(d,h.data);c.fireEvent("createsuccess",d,c,h)}},this)},removeModifyRecord:function(d,a){var b=d.getStore(),c=b.writer.meta.idProperty,e=b.modified;Ext.each(a,function(l,h,f){var k=c;for(var j=0;j<e.length;){var g=e[j];if(g&&g.get(k)==l[k]){b.modified.remove(g);break}else{j++}}},this)},getModifyCreateRecord:function(b){var a=b.getModifiedRecords(),e=[],c=[];if(a.length){for(var d=a.length-1;d>=0;d--){var f=a[d];if(f.phantom===true){if(f.isValid()){e.push(f)}}else{if(f.isValid()){c.push(f)}}}}return[e,c]},doCheckMustInputField:function(d,f){var c=[];var a={};Ext.each(f,function(g,h,l){data=g.data;for(var j in d){if(!data[j]||Ext.isEmpty(data[j].trim())){if(!a[j]){a[j]=[]}var k=this.grid.store.indexOf(g)+1;a[j].push(k)}}},this);for(var e in a){if(!Ext.isEmpty(a[e])){var b="第"+a[e].sort(function(h,g){if(h>g){return 1}else{return -1}}).join("、")+"行"+d[e]+"不能为空";c.push(b)}}return c},validateLocalDataUnique:function(e){var d={},h=[],g=this.grid.getStore(),f=[];var c=new Ext.util.MixedCollection();g.each(function(k,m,l){var o="";if(Ext.isArray(e)){Ext.each(e,function(t,q,s){var r=k.get(t);o+="?"+(Ext.isEmpty(r)?"":r)},this);if(!Ext.isEmpty(o)&&c.containsKey(o)){var n=d[o]||[];if(Ext.isEmpty(n)){var p=c.get(o)+1;n.push(p)}n.push(m+1);d[o]=n}else{c.add(o,m)}}else{Rs.error("您的验证规则validateFields配置错误，请检查！")}},this);if(Ext.isEmpty(d)){return true}else{for(var a in d){var j=d[a].sort(function(l,k){if(l>k){return 1}else{return -1}});var b="第"+j.join("、")+"行数据重复！";f.push(b)}}return f},beforeLoadCheckData:function(a,b){var c=[];c=a.getModifiedRecords();if(c.length>0){Ext.Msg.show({title:"提示",msg:"有数据发生变化,是否需要先保存?<br/>选择【确定】则执行先保存数据。<br/>选择【取消】则直接加载数据。",buttons:Ext.Msg.OKCANCEL,icon:Ext.MessageBox.QUESTION,fn:function(d,e){a.un("beforeload",this.beforeLoadCheckData,this);if(d=="ok"){this.grid.loadMask.hide();this.doSave.createDelegate(this.grid,[this],0)();a.on("beforeload",this.beforeLoadCheckData,this)}else{a.reload()}},scope:this});return false}else{return true}}})})();Ext.ns("Rs.ext.chart");Rs.ext.chart.ChartPanel=Ext.extend(Ext.Panel,{chartType:"",height:500,width:600,refreshTime:0,enableShowValues:true,enableShowLegend:true,enableShowLabels:true,constructor:function(b){if(b.dataSet&&!b.store){Rs.error("没有配置store")}b.chart=Rs.applyIf(b.chart||b.jsonData.chart||{},{numberprefix:"￥",formatNumberScale:"0"});Rs.ext.chart.ChartPanel.superclass.constructor.call(this,b||{});this.setDefaultChart();this.chartId=Ext.id("chart-gen-");this.chartDir=b.chartDir||"/com/rsc/rs/pub/rsclient2/rs/lib/FusionCharts_v3/";this.getViewStyle(this.chartType);if(this.store){var a=false;this.store.on("load",function(d,c,e){this.setJsonData(d);if(!a){this.myChart.render(this.body.id);a=true}},this);this.startRefreshData();this.store.on("update",function(d,c,e){this.setJsonData(d)},this)}else{this.myChart.setJSONData(this.jsonData);this.myChart.render(this.body.id)}},getViewStyle:function(b){var b=this.chartType,a=this.chartDir;if(b=="Column3D"){a=a+"Column3D.swf"}else{if(b=="Column2D"){a=a+"Column2D.swf"}else{if(b=="Line"){a=a+"Line.swf"}else{if(b=="Area2D"){a=a+"Area2D.swf"}else{if(b=="Bar2D"){a=a+"Bar2D.swf"}else{if(b=="Pie2D"){a=a+"Pie2D.swf"}else{if(b=="Pie3D"){a=a+"Pie3D.swf"}else{if(b=="Doughnut2D"){a=a+"Doughnut2D.swf"}else{if(b=="Doughnut3D"){a=a+"Doughnut3D.swf"}else{if(b=="Pareto2D"){a=a+"Pareto2D.swf"}else{if(b=="Pareto3D"){a=a+"Pareto3D.swf"}else{if(b=="MSColumn2D"){a=a+"MSColumn2D.swf"}else{if(b=="MSColumn3D"){a=a+"MSColumn3D.swf"}else{if(b=="MSLine"){a=a+"MSLine.swf"}else{if(b=="MSBar2D"){a=a+"MSBar2D.swf"}else{if(b=="MSBar3D"){a=a+"MSBar3D.swf"}else{if(b=="MSArea"){a=a+"MSArea.swf"}else{if(b=="Marimekko"){a=a+"Marimekko.swf"}else{if(b=="ZoomLine"){a=a+"ZoomLine.swf"}else{if(b=="StackedColumn3D"){a=a+"StackedColumn3D.swf"}else{if(b=="StackedColumn2D"){a=a+"StackedColumn2D.swf"}else{if(b=="StackedBar2D"){a=a+"StackedBar2D.swf"}else{if(b=="StackedBar3D"){a=a+"StackedBar3D.swf"}else{if(b=="StackedArea2D"){a=a+"StackedArea2D.swf"}else{if(b=="MSCombi3D"){a=a+"MSCombi3D.swf"}else{if(b=="MSCombi2D"){a=a+"MSCombi2D.swf"}else{if(b=="MSColumnLine3D"){a=a+"MSColumnLine3D.swf"}else{if(b=="StackedColumn2DLine"){a=a+"StackedColumn2DLine.swf"}else{if(b=="StackedColumn3DLine"){a=a+"StackedColumn3DLine.swf"}else{if(b=="MSCombiDY2D"){a=a+"MSCombiDY2D.swf"}else{if(b=="MSColumn3DLineDY"){a=a+"MSColumn3DLineDY.swf"}else{if(b=="StackedColumn3DLineDY"){a=a+"StackedColumn3DLineDY.swf"}else{if(b=="ScrollColumn2D"){a=a+"ScrollColumn2D.swf"}else{if(b=="ScrollArea2D"){a=a+"ScrollArea2D.swf"}else{if(b=="ScrollStackedColumn2D"){a=a+"ScrollStackedColumn2D.swf"}else{if(b=="ScrollCombi2D"){a=a+"ScrollCombi2D.swf"}else{if(b=="ScrollCombiDY2D"){a=a+"ScrollCombiDY2D.swf"}else{Rs.error("你配置的图形显示样式错误,请检查")}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}}this.myChart=new FusionCharts(a,this.chartId,"100%","100%","0","0")},setJsonData:function(a){if(this.jsonData){if(this.dataSet){this.jsonData.dataSet=this.getDataSet(a)}this.myChart.setJSONData(this.jsonData)}else{var b=Rs.apply(this.jsonData||{},{});if(this.chart){b.chart=this.getChart()}if(this.categories&&this.dataSet){b.categories=[this.getCategory(a)];b.dataSet=this.getDataSet(a)}else{if(this.data){b.data=this.getData(a)}else{Rs.error("categories,dataset  or data 必须配置一组")}}if(this.trendLines){b.trendLines=this.getTrendLines()}if(this.styles){b.styles=this.getStyles()}this.myChart.setJSONData(b)}},getCategory:function(a){var d=[],b=this.categories.dataIndex,c=this.categories.renderer,e=Ext.isFunction(c)?c:function(f){return f};a.each(function(f){d.push({label:e.call(this,f.get(b))})},this);return{category:d}},getDataSet:function(b){var e=[];for(var d=0,a=this.dataSet.length;d<a;d++){var c=this.dataSet[d]["legend"],h=[],f=this.dataSet[d]["renderer"],g=Ext.isFunction(f)?f:function(j){return j};b.each(function(j){h.push({value:g.call(this,j.get(c))})},this);e[d]={seriesname:this.dataSet[d]["seriesname"]||this.dataSet[d]["legend"],parentYAxis:this.dataSet[d]["parentYAxis"]||"P",data:h}}return e},getChart:function(){return this.chart},getData:function(a){var b=[];a.each(function(c){b.push({label:c.get(this.data.dataIndex),value:c.get(this.data.legend)})},this);return b},getTrendLines:function(){return this.trendLines},getStyles:function(){return this.styles},setDefaultChart:function(){if(!this.enableShowValues){this.chart.showvalues="0"}if(!this.enableShowLabels){this.chart.showLabels="0"}if(!this.enableShowLegend){this.chart.showlegend="0"}else{this.chart.showlegend="1"}},startRefreshData:function(){if(this.refreshTime>0){Ext.TaskMgr.start({run:function(){this.store.reload()},interval:this.refreshTime,scope:this})}}});Ext.ns("Rs.ext.form");(function(){var a=function(){a.superclass.constructor.apply(this,arguments)};Ext.extend(a,Ext.form.Action.Load,{run:function(){var e=this.options,d=e.url||this.form.url||this.form.el.dom.action;Rs.Service.call({url:d,method:"load",scope:this,accept:"html",params:this.getParams(),success:this.success,failure:this.failure,timeout:(e.timeout*1000)||(this.form.timeout*1000),upload:this.form.fileUpload?this.success:undefined},this)},getParams:function(){var d=this.form.baseParams;var e=this.options.params;if(e){if(typeof e=="object"){e=Rs.urlEncode(Rs.applyIf(e,d))}else{if(typeof e=="string"&&d){e+="&"+Rs.urlEncode(d)}}}else{if(d){e=Rs.urlEncode(d)}}return e}});var b=function(){b.superclass.constructor.apply(this,arguments)};Ext.extend(b,Ext.form.Action.Submit,{run:function(){var h=this.options;if(h.clientValidation===false||this.form.isValid()){if(h.submitEmptyText===false){var d=this.form.items,g=[],e=function(j){if(j.el.getValue()==j.emptyText){g.push(j);j.el.dom.value=""}if(j.isComposite&&j.rendered){j.items.each(e)}};d.each(e)}var f=h.url||this.form.url||this.form.el.dom.action;Rs.Service.call({form:this.form.el.dom,url:f,accept:"html",method:h.method,params:this.getParams(),success:this.success,failure:this.failure,scope:this,timeout:(h.timeout*1000)||(this.form.timeout*1000),upload:this.form.fileUpload?this.success:undefined,isUpload:this.form.fileUpload});if(h.submitEmptyText===false){Ext.each(g,function(j){if(j.applyEmptyText){j.applyEmptyText()}})}}else{if(h.clientValidation!==false){this.failureType=Ext.form.Action.CLIENT_INVALID;this.form.afterAction(this,false)}}},getParams:function(){var d=this.form.baseParams;var e=this.options.params;if(e){if(typeof e=="object"){e=Rs.urlEncode(Rs.applyIf(e,d))}else{if(typeof e=="string"&&d){e+="&"+Rs.urlEncode(d)}}}else{if(d){e=Rs.urlEncode(d)}}return e}});var c={load:a,submit:b};Rs.ext.form.BasicForm=function(){Rs.ext.form.BasicForm.superclass.constructor.apply(this,arguments)};Ext.extend(Rs.ext.form.BasicForm,Ext.form.BasicForm,{loadMethod:"load",submitMethod:"submit",waitTitle:"请稍等...",doAction:function(e,d){if(Ext.isString(e)){e=new c[e](this,d)}if(this.fireEvent("beforeaction",this,e)!==false){this.beforeAction(e);e.run.defer(100,e)}return this},submit:function(e){e=e||{};Ext.apply(e,{method:this.submitMethod});if(this.standardSubmit){var d=e.clientValidation===false||this.isValid();if(d){var f=this.el.dom;if(this.url&&Ext.isEmpty(f.action)){f.action=this.url}f.submit()}return d}this.doAction("submit",e);return this},load:function(d){Ext.apply(d,{method:this.loadMethod});this.doAction("load",d);return this}})})();Ext.ns("Rs.ext.form");(function(){Rs.ext.form.FormPanel=function(){Rs.ext.form.FormPanel.superclass.constructor.apply(this,arguments)};Ext.extend(Rs.ext.form.FormPanel,Ext.form.FormPanel,{loadMethod:"load",submitMethod:"submit",createForm:function(){var a=Ext.applyIf({listeners:{}},this.initialConfig);return new Rs.ext.form.BasicForm(null,a)}});Ext.reg("rs-ext-formpanel",Rs.ext.form.FormPanel)})();Ext.ns("Rs.ext.form");(function(){Rs.ext.form.KindEditorPanel=function(b){if(!b.uploadJson&&b.upload){var a=b.upload;b.uploadJson=a.url+"?Rs-method="+a.method+"&Rs-accept=html&fileDir="+a.fileDir;delete b.upload}Ext.apply(this,b);Rs.ext.form.KindEditorPanel.superclass.constructor.apply(this,arguments)};Ext.extend(Rs.ext.form.KindEditorPanel,Ext.Panel,{editoritems:["source","|","undo","redo","|","print","rstemplate","code","cut","copy","paste","plainpaste","wordpaste","|","justifyleft","justifycenter","justifyright","justifyfull","insertorderedlist","insertunorderedlist","indent","outdent","subscript","superscript","clearhtml","quickformat","selectall","|","fullscreen","/","formatblock","fontname","fontsize","|","forecolor","hilitecolor","bold","italic","underline","strikethrough","lineheight","removeformat","|","image","multiimage","flash","media","insertVideo","table","hr","emoticons","baidumap","pagebreak","anchor","link","unlink","|","about"],resizeType:2,uploadJson:"",upload:{},height:500,width:"90%",editorConfig:{},htmlEditor:{},onRender:function(d,b){Rs.ext.form.KindEditorPanel.superclass.onRender.apply(this,arguments);var c=KindEditor,e=Ext.getDom(d.dom),a=e.childNodes.length,f;function g(h){if(Ext.getDom(h).childNodes.length>0){return g(h.childNodes[0])}else{return h}}if(a){f=g(d.dom)}Rs.apply(this.editorConfig||{},{items:this.editoritems,uploadJson:this.uploadJson,height:this.height,filterMode:false,width:this.width,resizeType:this.resizeType});htmlEditor=c.create(f,this.editorConfig)},setValue:function(a){this.getEditor().html(a)},getValue:function(){return htmlEditor.html()},clearValue:function(){htmlEditor.html("")},getEditor:function(){return htmlEditor}});Ext.reg("kindeditor",Rs.ext.form.KindEditorPanel)})();Ext.ns("Rs.ext.form");(function(){Rs.ext.form.SimpleFileUploadPanel=function(a){if(a.width&&a.width<745){a.width=745}Ext.apply(this,a);this.attachmentIdTextField=new Ext.form.TextField({dataIndex:"attachmentIdTextField",hidden:true,value:-1});this.gp=new Ext.grid.GridPanel({stripeRows:true,autoHeight:true,border:false,hideHeaders:true,store:new Ext.data.Store({fields:["attachmentId","attachmentIndex","id","name","type","size","state","percent"]}),columns:[{header:"附件编码",width:10,hidden:true,dataIndex:"attachmentId",menuDisabled:true},{header:"附件索引",width:10,hidden:true,dataIndex:"attachmentIndex",menuDisabled:true},{header:"文件名",width:190,sortable:true,dataIndex:"name",menuDisabled:true},{header:"类型",width:50,sortable:true,dataIndex:"type",menuDisabled:true},{header:"大小",width:80,sortable:true,dataIndex:"size",menuDisabled:true,renderer:this.formatFileSize},{header:"进度",width:150,sortable:true,dataIndex:"percent",menuDisabled:true,renderer:this.formatProgressBar,scope:this},{header:"状态",width:70,sortable:true,dataIndex:"state",menuDisabled:true,renderer:this.formatFileState,scope:this},{header:"&nbsp;",width:200,dataIndex:"id",menuDisabled:true,renderer:this.formatDelBtn}]});this.setting={upload_url:this.uploadUrl,flash_url:this.flashUrl,file_size_limit:this.fileSize||(1024*50),file_post_name:this.filePostName,file_types:this.fileTypes||"*.*",file_types_description:"All Files",file_upload_limit:this.uploadLimit?(this.uploadLimit+""):"0",file_queue_limit:"10",post_params:this.postParams,use_query_string:true,debug:false,button_cursor:SWFUpload.CURSOR.HAND,button_window_mode:SWFUpload.WINDOW_MODE.TRANSPARENT,custom_settings:{scope_handler:this},file_queued_handler:this.onFileQueued,swfupload_loaded_handler:function(){},file_dialog_start_handler:function(){},file_dialog_complete_handler:this.onDiaogComplete,upload_start_handler:this.onUploadStart,upload_success_handler:this.onUploadSuccess,swfupload_loaded_handler:function(){},upload_progress_handler:this.uploadProgress,upload_complete_handler:this.onUploadComplete,upload_error_handler:this.onUploadError,file_queue_error_handler:this.onFileError};this.uppanel=new Ext.Panel({hidden:true,autoHeight:true,items:[this.attachmentIdTextField,this.gp],border:false});Ext.apply(this.listeners||{},{afterrender:function(){var d=this.getTopToolbar().get(0).el.child("em");var c=Ext.id();d.setStyle({position:"relative",display:"block","z-index":1});d.createChild({tag:"div",id:c});this.swfupload=new SWFUpload(Ext.apply(this.setting,{button_width:d.getWidth(),button_height:d.getHeight(),button_placeholder_id:c}));this.swfupload.uploadStopped=false;Ext.get(this.swfupload.movieName).setStyle({position:"absolute",top:"0px",left:"-2px","z-index":2})},scope:this,delay:100});this.addBtn=new Ext.Button({text:"添加文件",iconCls:"rs-action-addfile"}),this.uploadBtn=new Ext.Button({text:"上传文件",iconCls:"rs-action-uploadfile",handler:this.startUpload,scope:this});this.stopBtn=new Ext.Button({text:"停止上传",iconCls:"rs-action-stopfile",handler:this.stopUpload,scope:this});this.deleteBtn=new Ext.Button({text:"删除所有",iconCls:"rs-action-cleanfile",handler:this.deleteAll,scope:this});var b=[this.addBtn,"-"];if(this.enableFile){b.push(this.uploadBtn);b.push("-");b.push(this.stopBtn);b.push("-")}b.push(this.deleteBtn);Rs.ext.form.SimpleFileUploadPanel.superclass.constructor.call(this,{border:false,tbar:new Ext.Toolbar({hideBorders:true,style:"background-color:#FFFFFF; background-image:url();",items:[b]}),layout:"fit",items:[this.uppanel]});this.addEvents("diaogcomplete","uploadsuccess","deletefile")};Ext.extend(Rs.ext.form.SimpleFileUploadPanel,Ext.Panel,{flashUrl:"/com/rsc/rs/pub/rsclient2/rs/ext/resources/swfupload.swf",enableFile:true,width:745,fieldLabel:null,fileSize:1024*50,uploadUrl:null,fileTypes:"*.*",uploadLimit:"10",postParams:{},toggleBtn:function(a){this.addBtn.setDisabled(a);if(this.uploadBtn){this.uploadBtn.setDisabled(a)}if(this.stopBtn){this.stopBtn.setDisabled(!a)}this.deleteBtn.setDisabled(a);this.gp.getColumnModel().setHidden(6,a)},onUploadStart:function(b){var a=this.settings.post_params;Ext.apply(a,{fileName:encodeURIComponent(b.name),attachmentId:this.customSettings.scope_handler.attachmentIdTextField.getValue(),uploadType:"simplePanel"});this.setPostParams(a)},startUpload:function(){if(this.swfupload){if(this.swfupload.getStats().files_queued>0){this.swfupload.uploadStopped=false;this.toggleBtn(true);this.swfupload.startUpload()}}},formatFileSize:function(c,b,a){return Ext.util.Format.fileSize(c)},formatFileState:function(a){switch(a){case -1:return"未上传";break;case -2:return"正在上传";break;case -3:return'<div style="color:red;">上传失败</div>';break;case -4:return"上传成功";break;case -5:return"取消上传";break;default:return a}},formatProgressBar:function(a){var b=this.getTplStr(a);return b},getTplStr:function(a){var b="#6593CF";var c="#7FA9E4";return String.format('<div><div style="border:1px solid {0};height:10px;width:{1}px;margin:4px 0px 1px 0px;float:left;"><div style="float:left;background:{2};width:{3}%;height:10px;"><div></div></div></div><div style="text-align:center;float:right;width:40px;margin:3px 0px 1px 0px;height:10px;font-size:12px;">{3}%</div></div>',c,(90),b,a)},onUploadComplete:function(c){var d=this.customSettings.scope_handler;if(c.filestatus==-4){var e=d.gp.store;for(var b=0;b<e.getCount();b++){var a=e.getAt(b);if(a.get("id")==c.id){a.set("percent",100);if(a.get("state")!=-3){a.set("state",c.filestatus)}a.commit()}}}if(this.getStats().files_queued>0&&this.uploadStopped==false){this.startUpload()}else{d.toggleBtn(false);d.linkBtnEvent()}},onFileQueued:function(a){var b=this.customSettings.scope_handler;var c=new Ext.data.Record({id:a.id,name:a.name,size:a.size,type:a.type,state:a.filestatus,percent:0});b.gp.getStore().add(c)},onUploadSuccess:function(c,a){var d=this.customSettings.scope_handler;var e=d.gp.store;if(Ext.util.JSON.decode(a).success){for(var b=0;b<e.getCount();b++){var f=e.getAt(b);if(f.get("id")==c.id){f.set("state",c.filestatus);f.set("attachmentId",Ext.util.JSON.decode(a).attachmentId);f.set("attachmentIndex",Ext.util.JSON.decode(a).attachmentIndex);d.attachmentIdTextField.setValue(Ext.util.JSON.decode(a).attachmentId);f.commit()}}}else{for(var b=0;b<e.getCount();b++){var f=e.getAt(b);if(f.get("id")==c.id){f.set("percent",0);f.set("state",-3);f.commit()}}}d.linkBtnEvent();d.fireEvent("uploadsuccess",d,Ext.util.JSON.decode(a),c)},uploadProgress:function(c,h,g){var e=this.customSettings.scope_handler;var d=Math.ceil((h/g)*100);d=d==100?99:d;var f=e.gp.store;for(var b=0;b<f.getCount();b++){var a=f.getAt(b);if(a.get("id")==c.id){a.set("percent",d);a.set("state",c.filestatus);a.commit()}}},onUploadError:function(b,f,d){var c=this.customSettings.scope_handler;c.linkBtnEvent();var e=c.gp.store;for(var a=0;a<e.getCount();a++){var g=e.getAt(a);if(g.get("id")==b.id){g.set("percent",0);g.set("state",b.filestatus);g.commit()}}},onFileError:function(a,c){switch(c){case -100:b("待上传文件列表数量超限，不能选择！");break;case -110:b("文件太大，不能选择！");break;case -120:b("该文件大小为0，不能选择！");break;case -130:b("该文件类型不可以上传！");break}function b(d){Ext.Msg.show({title:"提示",msg:d,width:280,icon:Ext.Msg.WARNING,buttons:Ext.Msg.OK})}},onDiaogComplete:function(){var a=this.customSettings.scope_handler;a.linkBtnEvent();a.uppanel.show();a.fireEvent("diaogcomplete",a)},stopUpload:function(){if(this.swfupload){this.swfupload.uploadStopped=true;this.swfupload.stopUpload()}var a=this.customSettings.scope_handler;a.fireEvent("stopupload",a)},deleteAll:function(){var d=this.gp.store;for(var b=0;b<d.getCount();b++){var a=d.getAt(b);var c=a.get("id");this.deleteFile(a.get("attachmentId"),a.get("attachmentIndex"),a.get("state"));this.swfupload.cancelUpload(c,false);this.updateQueuedStats(a.get("state"))}d.removeAll();this.swfupload.uploadStopped=false;this.fireEvent("removeall",this);this.uppanel.hide();this.uppanel.doLayout()},formatDelBtn:function(a){return"<a href='#' id='"+a+"'  style='color:red' class='link' ext:qtip='移除该文件'>移除</a>"},linkBtnEvent:function(){this.gp.on("cellclick",function(c,j,d,g){var b=this.gp.getColumnModel().getDataIndex(d);if(b=="id"&&g.getTarget().tagName=="A"){var f=this.gp.store;for(var a=0;a<f.getCount();a++){var h=f.getAt(a);if(h.get("id")==g.getTarget().id){this.swfupload.cancelUpload(h.get("id"),false);this.updateQueuedStats(h.get("state"));f.remove(h);this.deleteFile(h.get("attachmentId"),h.get("attachmentIndex"),h.get("state"))}}}},this)},updateQueuedStats:function(e){var d=this.swfupload.getStats();var h=d.files_queued,c=d.files_queued,b=d.queue_errors,f=d.successful_uploads,g=d.upload_cancelled,a=d.upload_errors;if(e==-1){h-=1}else{if(e==-2){h-=1;c-=1}else{if(e==-3){a-=1}else{if(e==-4){f-=1}else{if(e==-5){g-=1}}}}}this.swfupload.setStats({files_queued:h,in_progress:c,queue_errors:b,successful_uploads:f,upload_cancelled:g,upload_errors:a})},deleteFile:function(b,c,a){if(a!=-4){return}Rs.Service.call({url:"/rsc/rsclient/attachment",method:"deleteFile",params:{attachmentId:b,attachmentIndex:c}},function(d){this.fireEvent("deletefile",this,d)},this)}});Ext.reg("rs-ext-simplefileuploadpanel",Rs.ext.form.SimpleFileUploadPanel)})();Ext.ns("Rs.ext.form");(function(){Rs.ext.form.DateField=function(a){a=a||{};Rs.ext.form.DateField.superclass.constructor.apply(this,arguments)};Ext.extend(Rs.ext.form.DateField,Ext.form.DateField,{setValue:function(a){var a=Rs.ext.form.DateField.superclass.setValue.apply(this,arguments);return a},getValue:function(){return Ext.form.DateField.superclass.getValue.apply(this,arguments)||""},onTriggerClick:function(){if(this.disabled){return}if(this.menu==null){this.menu=new Ext.menu.DateMenu({hideOnClick:false,focusOnSelect:false})}this.onFocus();Ext.apply(this.menu.picker,{minDate:this.minValue,maxDate:this.maxValue,disabledDatesRE:this.disabledDatesRE,disabledDatesText:this.disabledDatesText,disabledDays:this.disabledDays,disabledDaysText:this.disabledDaysText,format:this.format,showToday:this.showToday,startDay:this.startDay,minText:String.format(this.minText,this.formatDate(this.minValue)),maxText:String.format(this.maxText,this.formatDate(this.maxValue))});var a=this.parseDate(this.getValue())||"";this.menu.picker.setValue(a||new Date());this.menu.show(this.el,"tl-bl?");this.menuEvents("on")}});Ext.ComponentMgr.registerType("rs-ext-datefield",Rs.ext.form.DateField)})();Ext.ns("Rs.ext.form");(function(){Rs.ext.form.PeriodField=function(e){Rs.ext.form.PeriodField.superclass.constructor.call(this,Ext.apply({},e||{}))};Ext.extend(Rs.ext.form.PeriodField,Ext.form.DateField,{format:"Y-m",altFormats:"m/Y|m-Y|mY|Ym|Y-m|Y.m|m.Y|m月Y年|Y年m月",triggerClass:"x-form-date-trigger",parseDate:function(k){if(!k||Ext.isDate(k)){return k}var f=this.safeParse(k,this.format),g=this.altFormats,j=this.altFormatsArray;if(!f&&g){j=j||g.split("|");for(var h=0,e=j.length;h<e&&!f;h++){if(j[h].charAt(0)!=this.format.charAt(0)){continue}f=this.safeParse(k,j[h])}}return f},setValue:function(e){this.value=e;Rs.ext.form.PeriodField.superclass.setValue.call(this,e)},getValue:function(){return this.value},menuListeners:{select:function(e,f){this.setValue(f.format(this.format))},show:function(){this.onFocus()},hide:function(){this.focus.defer(10,this);var e=this.menuListeners;this.menu.un("select",e.select,this);this.menu.un("show",e.show,this);this.menu.un("hide",e.hide,this)}},onTriggerClick:function(){if(this.disabled){return}if(this.menu==null){this.menu=new d()}Ext.apply(this.menu.picker,{});this.menu.on(Ext.apply({},this.menuListeners,{scope:this}));this.menu.show(this.el,"tl-bl?")}});var d=function(f){d.superclass.constructor.call(this,f);this.plain=true;var e=new a(f);this.add(e);this.picker=e.picker;this.relayEvents(e,["select"])};Ext.extend(d,Ext.menu.Menu,{cls:"x-date-menu"});var c=function(f,e){c.superclass.constructor.call(this,e);this.component=f};Ext.extend(c,Ext.menu.BaseItem,{canActivate:true,onRender:function(f,e){this.component.render(f);this.el=this.component.getEl()},activate:function(){if(this.disabled){return false}this.component.focus();this.fireEvent("activate",this);return true},deactivate:function(){this.fireEvent("deactivate",this)},disable:function(){this.component.disable();c.superclass.disable.call(this)},enable:function(){this.component.enable();c.superclass.enable.call(this)}});var a=function(e){a.superclass.constructor.call(this,new b(e),e);this.picker=this.component;this.addEvents("select");this.picker.on("render",function(f){f.getEl().swallowEvent("click");f.container.addClass("x-menu-date-item")});this.picker.on("select",this.onSelect,this)};Ext.extend(a,c,{onSelect:function(f,e){this.fireEvent("select",this,e,f);f.hideMonthPicker()}});var b=Ext.extend(Ext.Component,{format:"M-y",okText:"当前年月",cancelText:"取消",constrainToViewport:true,monthNames:["1月","2月","3月","4月","5月","6月","7月","8月","9月","10月","11月","12月"],startDay:0,value:0,noPastYears:false,initComponent:function(){b.superclass.initComponent.call(this);this.value=this.value?this.value.clearTime():new Date().clearTime();this.addEvents("select");if(this.handler){this.on("select",this.handler,this.scope||this)}},focus:function(){if(this.el){this.update(this.activeDate)}},onRender:function(g,f){var e=['<div style="width: 200px; height:175px;"></div>'];e[e.length]='<div class="x-date-mp"></div>';var h=document.createElement("div");h.className="x-date-picker";h.innerHTML=e.join("");g.dom.insertBefore(h,f);this.el=Ext.get(h);this.monthPicker=this.el.down("div.x-date-mp");this.monthPicker.enableDisplayMode("block");this.el.unselectable();this.showMonthPicker();if(Ext.isIE){this.el.repaint()}this.update(this.value)},createMonthPicker:function(){if(!this.monthPicker.dom.firstChild){var e=['<table border="0" cellspacing="0">'];for(var f=0;f<6;f++){e.push("<tr>",f==0?'<td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-prev"></a></td><td class="x-date-mp-ybtn" align="center"><a class="x-date-mp-next x-date-mp-sep"></a></td>':'<td class="x-date-mp-year"><a href="#"></a></td><td class="x-date-mp-year  x-date-mp-sep"><a href="#"></a></td>','<td class="x-date-mp-month"><a href="#">',this.monthNames[f].substr(0,3),"</a></td>",'<td class="x-date-mp-month"><a href="#">',this.monthNames[f+6].substr(0,3),"</a></td></tr>")}e.push('<tr class="x-date-mp-btns"><td colspan="4"><button type="button" class="x-date-mp-ok">',this.okText,'</button><button type="button" class="x-date-mp-cancel">',this.cancelText,"</button></td></tr>","</table>");this.monthPicker.update(e.join(""));this.monthPicker.on("click",this.onMonthDblClick,this);this.monthPicker.on("dblclick",this.onMonthDblClick,this);this.mpMonths=this.monthPicker.select("td.x-date-mp-month");this.mpYears=this.monthPicker.select("td.x-date-mp-year");this.mpMonths.each(function(g,h,j){j+=1;if((j%2)==0){g.dom.xmonth=5+Math.round(j*0.5)}else{g.dom.xmonth=Math.round((j-1)*0.5)}})}},showMonthPicker:function(){this.createMonthPicker();var e=this.el.getSize();this.monthPicker.setSize(e);this.monthPicker.child("table").setSize(e);this.mpSelMonth=(this.activeDate||this.value).getMonth();this.updateMPMonth(this.mpSelMonth);this.mpSelYear=(this.activeDate||this.value).getFullYear();this.updateMPYear(this.mpSelYear);this.monthPicker.show()},updateMPYear:function(k){if(this.noPastYears){var h=new Date().getFullYear();if(k<(h+4)){k=h+4}}this.mpyear=k;var g=this.mpYears.elements;for(var f=1;f<=10;f++){var j=g[f-1],e;if((f%2)==0){e=k+Math.round(f*0.5);j.firstChild.innerHTML=e;j.xyear=e}else{e=k-(5-Math.round(f*0.5));j.firstChild.innerHTML=e;j.xyear=e}this.mpYears.item(f-1)[e==this.mpSelYear?"addClass":"removeClass"]("x-date-mp-sel")}},updateMPMonth:function(e){this.mpMonths.each(function(f,g,h){f[f.dom.xmonth==e?"addClass":"removeClass"]("x-date-mp-sel")})},selectMPMonth:function(e){},onMonthClick:function(j,g){j.stopEvent();var h=new Ext.Element(g),f;if(h.is("button.x-date-mp-cancel")){this.hideMonthPicker()}else{if(h.is("button.x-date-mp-ok")){this.update(new Date().clearTime());this.fireEvent("select",this,this.value)}else{if(f=h.up("td.x-date-mp-month",2)){this.mpMonths.removeClass("x-date-mp-sel");f.addClass("x-date-mp-sel");this.mpSelMonth=f.dom.xmonth}else{if(f=h.up("td.x-date-mp-year",2)){this.mpYears.removeClass("x-date-mp-sel");f.addClass("x-date-mp-sel");this.mpSelYear=f.dom.xyear}else{if(h.is("a.x-date-mp-prev")){this.updateMPYear(this.mpyear-10)}else{if(h.is("a.x-date-mp-next")){this.updateMPYear(this.mpyear+10)}}}}}}},onMonthDblClick:function(j,g){j.stopEvent();var h=new Ext.Element(g),f;if(h.is("button.x-date-mp-cancel")){this.hideMonthPicker()}else{if(h.is("button.x-date-mp-ok")){this.activeDate=new Date().clearTime();this.value=this.activeDate;this.mpSelMonth=(this.activeDate||this.value).getMonth();this.updateMPMonth(this.mpSelMonth);this.mpSelYear=(this.activeDate||this.value).getFullYear();this.updateMPYear(this.mpSelYear);this.update(this.activeDate||this.value);this.fireEvent("select",this,this.value)}else{if(f=h.up("td.x-date-mp-month",2)){this.mpMonths.removeClass("x-date-mp-sel");f.addClass("x-date-mp-sel");this.mpSelMonth=f.dom.xmonth;this.update(new Date(this.mpSelYear,f.dom.xmonth,(this.activeDate||this.value).getDate()));this.fireEvent("select",this,this.value)}else{if(f=h.up("td.x-date-mp-year",2)){this.mpYears.removeClass("x-date-mp-sel");f.addClass("x-date-mp-sel");this.mpSelYear=f.dom.xyear}else{if(h.is("a.x-date-mp-prev")){this.updateMPYear(this.mpyear-10)}else{if(h.is("a.x-date-mp-next")){this.updateMPYear(this.mpyear+10)}}}}}}},hideMonthPicker:function(e){Ext.menu.MenuMgr.hideAll()},showPrevMonth:function(f){this.update(this.activeDate.add("mo",-1))},showNextMonth:function(f){this.update(this.activeDate.add("mo",1))},showPrevYear:function(){this.update(this.activeDate.add("y",-1))},showNextYear:function(){this.update(this.activeDate.add("y",1))},update:function(g){this.activeDate=g;this.value=g;if(!this.internalRender){var e=this.el.dom.firstChild;var f=e.offsetWidth;this.el.setWidth(f+this.el.getBorderWidth("lr"));Ext.fly(e).setWidth(f);this.internalRender=true;if(Ext.isOpera&&!this.secondPass){e.rows[0].cells[1].style.width=(f-(e.rows[0].cells[0].offsetWidth+e.rows[0].cells[2].offsetWidth))+"px";this.secondPass=true;this.update.defer(10,this,[g])}}}})})();Rs.ns("Rs.ext.form");Rs.ext.form.TimeField=function(a){delete a.altFormats;this.validateFormat(a.format||"hh:mm");Rs.ext.form.TimeField.superclass.constructor.apply(this,arguments);this.addEvents("beforeexpand","expand","collapse","beforeselect","select","change")};Ext.extend(Rs.ext.form.TimeField,Ext.form.TriggerField,{format:"hh:mm",baseChars:"0123456789:",altFormats:["hh:mm:ss","hhmmss","hh:mm","hhmm"],triggerClass:"x-form-time-trigger",shadow:"sides",minlayerWidth:125,initComponent:function(){Rs.ext.form.TimeField.superclass.initComponent.call(this)},onRender:function(b,a){Rs.ext.form.TimeField.superclass.onRender.call(this,b,a);this.initTimeLayer()},initEvents:function(){var a=this.baseChars;a=Ext.escapeRe(a);this.maskRe=new RegExp("["+a+"]");Rs.ext.form.TimeField.superclass.initEvents.call(this);this.keyNav=new Ext.KeyNav(this.el,{down:function(b){if(!this.isExpanded()){this.onTriggerClick()}},enter:function(b){if(!this.isExpanded()){this.setValue(this.getRawValue())}},scope:this,forceKeyDown:true})},initTrigger:function(){this.mon(this.trigger,"click",this.onTriggerClick,this,{preventDefault:true})},isExpanded:function(){return this.timeLayer&&this.timeLayer.isVisible()},initTimeLayer:function(){var c=Ext.getDom(document.body||Ext.getBody());this.timeLayer=new Ext.Layer({parentEl:c,shadow:this.shadow,cls:" x-combo-list ",style:"border:0px;",constrain:false,zindex:this.getZIndex(c)});if(this.hasSecond()){this.timeLayer.setWidth(170)}else{this.timeLayer.setWidth(125)}this.timeLayer.alignTo(this.wrap,"tl-bl?");if(this.syncFont!==false){this.timeLayer.setStyle("font-size",this.el.getStyle("font-size"))}this.hourField=new Ext.form.TextField({maxValue:24,width:24,selectOnFocus:true,style:"border:0px;",minValue:0});this.hourLabel=new Ext.form.Label({style:"text-align:center",text:"时"});this.minuteField=new Ext.form.TextField({maxValue:59,width:24,style:"border:0px;",selectOnFocus:true,minValue:0});this.minuteLabel=new Ext.form.Label({style:"text-align:center",text:"分"});this.secondField=new Ext.form.TextField({maxValue:59,selectOnFocus:true,style:"border:0px;",width:24,minValue:0});this.secondLabel=new Ext.form.Label({text:"秒"});var b=[{columnWidth:(this.hasSecond()?0.15:0.2),bodyStyle:"border-top:0px;border-bottom:0px;border-left:0px;",items:[this.hourField]},{columnWidth:(this.hasSecond()?0.12:0.15),bodyStyle:"border:0px;",style:"text-align:center",items:[this.hourLabel]},{columnWidth:(this.hasSecond()?0.15:0.2),bodyStyle:"border-top:0px;border-bottom:0px;",items:[this.minuteField]},{columnWidth:(this.hasSecond()?0.12:0.15),bodyStyle:"border:0px;",style:"text-align:center",items:[this.minuteLabel]}];if(this.hasSecond()){b.push([{columnWidth:0.15,bodyStyle:"border-top:0px;border-bottom:0px;",items:[this.secondField]},{columnWidth:0.12,bodyStyle:"border:0px;",style:"text-align:center",items:[this.secondLabel]}])}b.push([{columnWidth:(this.hasSecond()?0.19:0.3),bodyStyle:"border:0px",items:[{xtype:"button",text:"确定",scope:this,style:(this.hasSecond()?"margin-left:5px;":"margin-left:7px;"),handler:this.doSelectInputTime}]}]);var a=new Ext.form.FormPanel({border:0,renderTo:this.timeLayer.dom,bodyStyle:"border:0px;margin:0 auto",style:"line-height:21px;",layout:"column",items:b});this.timeLayer.setHeight(a.getHeight())},getParentZIndex:function(){var a;if(this.ownerCt){this.findParentBy(function(b){a=parseInt(b.getPositionEl().getStyle("z-index"),10);return !!a})}return a},getZIndex:function(b){var b=b||Ext.getDom(document.body||Ext.getBody());var a=parseInt(Ext.fly(b).getStyle("z-index"),10);if(!a){a=this.getParentZIndex()}return(a||12000)+5},setFormat:function(a){this.validateFormat(a);this.format=a},expand:function(){if(this.fireEvent("beforeexpand",this)!==false){var a=new Date();this.hourField.setValue(this.doLpadZero(a.getHours()));this.minuteField.setValue(this.doLpadZero(a.getMinutes()));this.secondField.setValue(this.doLpadZero(a.getSeconds()));this.doShow();this.hourField.focus();this.mon(Ext.getDoc(),{scope:this,mousewheel:this.collapseIf,mousedown:this.collapseIf});this.fireEvent("expand",this)}},doShow:function(){if(this.hasSecond()){this.timeLayer.setWidth(170);this.secondLabel.show();this.secondField.show()}else{this.timeLayer.setWidth(125);this.secondLabel.hide();this.secondField.hide()}this.timeLayer.alignTo(this.wrap,"tl-bl?");this.timeLayer.show();this.hourKey=new Ext.KeyNav(this.hourField.el,{enter:function(a){this.doSelectInputTime()},esc:function(a){if(this.isExpanded()){this.collapse()}},scope:this,forceKeyDown:true});this.minuteKey=new Ext.KeyNav(this.minuteField.el,{enter:function(a){this.doSelectInputTime()},esc:function(a){if(this.isExpanded()){this.collapse()}},scope:this,forceKeyDown:true});if(this.hasSecond()){this.secondKey=new Ext.KeyNav(this.secondField.el,{enter:function(a){this.doSelectInputTime()},esc:function(a){if(this.isExpanded()){this.collapse()}},scope:this,forceKeyDown:true})}},hasSecond:function(){return this.format.indexOf("s")>-1},getErrors:function(d){if(Ext.isEmpty(d)){return[]}var g=Rs.ext.form.TimeField.superclass.getErrors.apply(this,arguments);var c=true,a,f,b;d=d.replace(/:/g,"");c=d.search(/\D/g)===-1;if(!c){g.push("日期只能输入数字和:符号");return g}var e=this.calculateHourMinSec(d);a=e[0];f=e[1];b=e[2];if(Number(a)>23){g.push("小时格式错误")}if(Number(f)>59){g.push("分钟格式错误")}if(this.hasSecond()){if(Number(b)>59){g.push("秒数格式错误")}}return g},doSelectInputTime:function(){var a=this.hourField.getValue();var d=this.minuteField.getValue();var b=this.secondField.getValue();var c=this.parseTime(a,d,b);if(this.fireEvent("beforeselect",this,a,d,b,c)!==false){this.setValue(c,true);this.collapse();this.focus();this.fireEvent("select",this,a,d,b,c)}},setValue:function(d,b){if(!Ext.isEmpty(d)){if(!b){var a,f,c,e=this.calculateHourMinSec(d);a=e[0];f=e[1];c=e[2];d=this.parseTime(a,f,c)}}Rs.ext.form.TimeField.superclass.setValue.call(this,d);this.validateTime(d);this.fireEvent("change",this,d,this.lastValue||"");this.lastValue=d},parseTime:function(a,c,b){a=this.doLpadZero(a);c=this.doLpadZero(c);b=this.doLpadZero(b);if(this.hasSecond()){return a+this.timeSeparator+c+this.timeSeparator+b}else{return a+this.timeSeparator+c}},validateTime:function(d){if(Ext.isEmpty(d)){return}var c=true,a,f,b,e=this.calculateHourMinSec(d);a=e[0];f=e[1];b=e[2];if(Number(a)>23){c=false;this.markInvalid("小时格式错误")}if(Number(f)>59){c=false;this.markInvalid("分钟格式错误")}if(this.hasSecond()){if(Number(b)>60){c=false;this.markInvalid("秒数格式错误")}}return c},calculateHourMinSec:function(j){var d=[],f,e,b,d;var c=j.replace(/:/g,"")+"";if(!Ext.isEmpty(c)){if(c.length>6){c=(c+"").substr(0,6)}else{if(c.length<6){var a=c.length;for(var g=0,h=6-a;g<h;g++){c+="0"}}}f=c.substr(0,2);e=c.substr(2,2);b=c.substr(4,2)}d.push(f);d.push(e);d.push(b);return d},doLpadZero:function(a){if(Number(a)<10){return"0"+Number(a)}return a},beforeBlur:function(){var d=this.getRawValue();d=d.replace(/:/g,"");if(Ext.isEmpty(d)){return}var c=this.validateTime(d);if(c){var a,f,b,e=this.calculateHourMinSec(d);a=e[0];f=e[1];b=e[2];this.setValue(this.parseTime(a,f,b),true)}},validateFormat:function(e){if(this.altFormats.indexOf(e)===-1){throw Rs.error("时间格式配置错误,请检查.")}var b=e;var d=[];if(!Ext.isEmpty(b)){for(var c=0,a=b.length;c<a;c++){if(["h","m","s"].indexOf(b.charAt(c))===-1){d.push(b.charAt(c))}}}d=Ext.unique(d);if(d.length>1){throw Rs.error("时间格式配置错误,请检查.")}this.timeSeparator=d[0]||""},collapse:function(){if(!this.isExpanded()){return}this.timeLayer.hide();this.hourKey.destroy();this.minuteKey.destroy();this.secondKey&&this.secondKey.destroy();Ext.getDoc().un("mousewheel",this.collapseIf,this);Ext.getDoc().un("mousedown",this.collapseIf,this);this.fireEvent("collapse",this)},collapseIf:function(a){if(!this.isDestroyed&&!a.within(this.timeLayer)){this.collapse()}},onTriggerClick:function(){if(this.readOnly||this.disabled){return}if(this.isExpanded()){return}this.expand()}});Ext.ns("Rs.ext.form");(function(){Rs.ext.form.GridLoaderField=function(d){d=d||{};var a=d.progCode,c=d.progCondition,b=d.queryPanelConfig,g=d.gridConfig,e=d.buildProgCondtion,f=d.dataCompany;this.columns=d.columns||[];delete d.columns;Rs.ext.form.GridLoaderField.superclass.constructor.call(this,Ext.apply(d,{enableKeyEvents:true,validationEvent:"blur"}));this.generalselPanel=this.initGeneralselPanel({progCode:a,dataCompany:f,progCondition:c,queryPanelConfig:b,gridConfig:g,buildProgCondtion:e});this.addEvents("beforeexpand","expand","collapse","beforeselect","select","change","passed","unpassed","clear")};Ext.extend(Rs.ext.form.GridLoaderField,Ext.form.TriggerField,{queryDelay:200,gridWidth:410,minGridWidth:410,maxGridWidth:800,gridHeight:320,minGridHeight:320,maxGridHeight:600,errorValueText:"错误数据",maskRe:/[^,;'"\\]/,keyNavConfig:{up:function(){if(this.isExpanded()){this.focusPrev()}},down:function(){if(!this.isExpanded()){this.onTriggerClick()}else{this.focusNext()}},enter:function(b){b.stopPropagation();var a=this.generalselPanel.getGrid();if(this.isExpanded()){if(!a.getStore().getCount()){this.collapse()}this.rowSelect(this.generalselPanel.grid.getSelectionModel().getSelections());this.onSelect()}},esc:function(){if(this.isExpanded()){this.collapse()}},home:function(c){var b=this.generalselPanel.getPagingToolbar(),a=b?b.getPageData():undefined;if(a&&a.activePage>1){b.moveFirst()}},end:function(){var b=this.generalselPanel.getPagingToolbar(),a=b?b.getPageData():undefined;if(a&&a.activePage<a.pages){b.moveLast()}},pageUp:function(){var b=this.generalselPanel.getPagingToolbar(),a=b?b.getPageData():undefined;if(a&&a.activePage>1){b.movePrevious()}},pageDown:function(){var b=this.generalselPanel.getPagingToolbar(),a=b?b.getPageData():undefined;if(a&&a.activePage<a.pages){b.moveNext()}},tab:function(a){this.collapse();return true},scope:this,doRelay:function(c,b,a){if(a=="down"||this.scope.isExpanded()){var d=Ext.KeyNav.prototype.doRelay.apply(this,arguments);if(!Ext.isIE&&Ext.EventManager.useKeydown){this.scope.fireKey(c)}return d}return true},forceKeyDown:true,defaultEventAction:"stopEvent"},fireKey:function(a){if(!this.isExpanded()){Rs.ext.form.GridLoaderField.superclass.fireKey.call(this,a)}},fieldKeyNavConfig:{},initGeneralselPanel:function(b){b=b||{};b=Ext.apply(b,{storeAutoLoad:false,queryPanelConfig:Ext.applyIf(b.queryPanelConfig||{},{border:true,margins:"1 1 0 1"}),queryPanelCollapsed:false,queryPanelDisable:this.readOnly==true,gridConfig:Ext.applyIf(b.gridConfig||{},{columns:this.columns,border:true,margins:"0 1 0 1"}),buildProgCondtion:b.buildProgCondtion,width:this.gridWidth,height:this.gridHeight,border:false});var a=new Rs.ext.grid.GeneralselPanel(b);return a},initEvents:function(){Rs.ext.form.GridLoaderField.superclass.initEvents.call(this);this.keyNav=new Ext.KeyNav(this.el,Ext.apply(this.keyNavConfig,{scope:this,forceKeyDown:true}));this.mon(this.el,"keyup",this.filterQuery,this);this.on("specialkey",this.tabKeyCollapse,this);this.quikTask=new Ext.util.DelayedTask(this.quickAhead,this)},initLayer:function(){this.view=new Ext.Layer({constrain:false,shadow:"sides",cls:" x-combo-list "});this.view.swallowEvent("mousewheel");this.view.swallowEvent("mousedown");this.resizer=new Ext.Resizable(this.view,{pinned:true,handles:"se",minWidth:this.minGridWidth,maxWidth:this.maxGridWidth,minHeight:this.minGridHeight,maxHeight:this.maxGridHeight});this.generalselPanel.render(this.view);this.initLayerEvents()},initLayerEvents:function(){this.fieldKeyNav=new Ext.KeyNav(this.generalselPanel.el,Ext.apply(this.fieldKeyNavConfig,{scope:this,forceKeyDown:true}));this.resizer.on("resize",function(d,b,c){this.generalselPanel.setWidth(b-2);this.generalselPanel.setHeight(c-2)},this);var a=this.generalselPanel.getGrid();if(a){a.on("rowclick",this.rowClick,this,{delay:20,scope:this})}},filterQuery:function(a){if(this.readOnly){return}if(!a.isSpecialKey()||a.getKey()==a.BACKSPACE||a.getKey()==a.DELETE){if(a.getKey()==a.BACKSPACE||a.getKey()==a.DELETE){this.setValue(this.getRawValue())}this.quikTask.delay(this.queryDelay);this.on("blur",this.clearQueryTask,this)}},clearQueryTask:function(){this.un("blur",this.clearQueryTask);this.quikTask.cancel()},quickAhead:function(){if(!this.isExpanded()){this.expand()}this.doQuery()},rowClick:function(b){var d;if(b&&(d=b.getSelectionModel())){this.rowSelect(d.getSelections());var a=b.getStore(),c=[];a.each(function(e){if(d.isSelected(e)==false){c.push(e)}},this);this.rowDeSelect(c)}this.focus()},rowSelect:function(a){this.onSelect()},rowDeSelect:function(a){},doQuery:function(){var c=this.getDisplayField(),b=this.getValueField(),d,a;if(this.readOnly==true){d=this.getValue();if(!Ext.isEmpty(b,false)&&!Ext.isEmpty(d,false)){a=b+" = '"+d+"'"}else{a="1 <> 1"}}else{d=this.getRawValue();if(!Ext.isEmpty(c,false)&&!Ext.isEmpty(d,false)){a=c+" like '"+d+"%'"}}a=this.buildProgCondtion(a);if(this.fireEvent("beforequery",this,a)!==false){this.generalselPanel.query(a,function(f,e,g){this.fireEvent("query",this,e,a)},this)}},buildProgCondtion:function(a){return a},isExpanded:function(){return this.view&&this.view.isVisible()},expand:function(){if(this.view==undefined){this.initLayer()}if(this.isExpanded()){return}if(this.fireEvent("beforeexpand",this)!==false){this.view.alignTo(this.wrap,"tl-bl?");this.view.show();Ext.getDoc().on("mousewheel",this.collapseIf,this);Ext.getDoc().on("mousedown",this.collapseIf,this);this.fireEvent("expand",this)}},beforeCollapse:Ext.emptyFn,collapse:function(){if(!this.isExpanded()){return}this.beforeCollapse();this.view.hide();Ext.getDoc().un("mousewheel",this.collapseIf,this);Ext.getDoc().un("mousedown",this.collapseIf,this);this.fireEvent("collapse",this);this.onCollapse()},onCollapse:Ext.emptyFn,collapseIf:function(a){if(a&&!a.within(this.wrap)&&!a.within(this.view)){this.collapse()}},tabKeyCollapse:function(b,a){if(a&&a.getKey()==a.TAB){this.collapse()}},validateBlur:function(){return !this.view||!this.view.isVisible()},onTriggerClick:function(){if(!this.isExpanded()&&!this.disabled){this.expand();this.doQuery()}else{this.collapse()}},focusFirst:function(){var b=this.generalselPanel.getGrid(),a=this.generalselPanel.getStore(),c=b.getSelectionModel();if(a.getCount()>0){c.selectFirstRow()}this.focus()},focusLast:function(){var b=this.generalselPanel.getGrid(),a=this.generalselPanel.getStore(),c=b.getSelectionModel();if(a.getCount()>0){c.selectLastRow()}this.focus()},focusPrev:function(){var a=this.generalselPanel.getGrid(),b=a.getSelectionModel();if(b.hasSelection()){b.selectPrevious()}else{b.selectFirstRow()}this.focus()},focusNext:function(){var a=this.generalselPanel.getGrid(),b=a.getSelectionModel();if(b.hasSelection()){b.selectNext()}else{b.selectFirstRow()}this.focus()},onSelect:function(){if(this.readOnly){this.collapse();return}var b=this.generalselPanel.getGrid(),a=this.generalselPanel.getStore(),e=b.getSelectionModel();record=e.getSelected();if(record&&this.fireEvent("beforeselect",this,record,a)){var d=record.get(this.getDisplayField()),c=record.get(this.getValueField());this.el.dom.value=d;if(String(this.lastValue)!=String(c)){this.fireEvent("change",this,c,this.lastValue)}this.lastValue=c;this.selectedRecord=record;this.collapse();this.fireEvent("select",this,record,c,d)}},clearValue:function(){delete this.lastValue;this.setRawValue("");delete this.selectedRecord;this.applyEmptyText();this.fireEvent("clear",this)},getValue:function(){var a=this.lastValue||"";if(Ext.isEmpty(a)){delete this.selectedRecord}return a},getValueRecord:function(){return this.selectedRecord},getDisplayField:function(){return this.displayField},setDisplayField:function(a){this.displayField=a},getValueField:function(){return this.valueField},setValueField:function(a){this.valueField=a},setValue:function(d){delete this.selectedRecord;var b=this.getValueField(),c=this.getDisplayField(),a;if(!Ext.isEmpty(b,false)&&!Ext.isEmpty(d,false)){this.lastValue=d;Rs.ext.form.GridLoaderField.superclass.setValue.call(this,d);a=b+" = '"+d+"'";a=this.buildProgCondtion(a);this.generalselPanel.query(a,function(g,f){var e=g.query(b,new RegExp("^"+d+"$")).get(0);if(e){if(this.generalselPanel.rendered){this.el.dom.value=e.get(c)}else{this.generalselPanel.on("render",function(){this.el.dom.value=e.get(c)},this,{single:true,scope:this})}var h=this.lastValue;this.lastValue=e.get(b);this.selectedRecord=e;this.fireEvent("change",this,this.lastValue,h);this.fireEvent("passed",this,e.get(b),e)}else{this.fireEvent("unpassed",this,d,b);this.applyEmptyText()}},this)}else{if(d!==undefined&&d.length==0){this.lastValue=d;Rs.ext.form.GridLoaderField.superclass.setValue.call(this,d)}else{this.lastValue=d;Rs.ext.form.GridLoaderField.superclass.setValue.call(this,d);this.fireEvent("unpassed",this,d,b);this.applyEmptyText()}}},updateEditState:function(){if(this.rendered){if(this.readOnly){this.el.dom.readOnly=true;this.el.addClass("x-trigger-noedit")}else{if(!this.editable){this.el.dom.readOnly=true;this.el.addClass("x-trigger-noedit");this.mun(this.el,"click",this.onTriggerClick,this);this.mon(this.el,"click",this.onTriggerClick,this)}else{this.el.dom.readOnly=false;this.el.removeClass("x-trigger-noedit");this.mun(this.el,"click",this.onTriggerClick,this)}this.trigger.setDisplayed(!this.hideTrigger)}this.onResize(this.width||this.wrap.getWidth())}},setReadOnly:function(a){Rs.ext.form.GridLoaderField.superclass.setReadOnly.apply(this,arguments);this.generalselPanel.setQueryPanelDisable(a==true)},focus:function(){Rs.ext.form.GridLoaderField.superclass.focus.defer(25,this)},isValid:function(a){if(this.disabled){return true}var c=this.preventMark;this.preventMark=a===true;var b=this.validateValue(this.processValue(this.getValue()));this.preventMark=c;return b},validate:function(){if(this.disabled||this.validateValue(this.processValue(this.getValue()))){this.clearInvalid();return true}return false},getErrors:function(a){var c=Rs.ext.form.GridLoaderField.superclass.getErrors.apply(this,arguments);a=Ext.isDefined(a)?a:this.processValue(this.getRawValue());var b=this.getValueError(a);b!=undefined?c.push(b):null;return c},getValueError:function(c){if(this.selectedRecord!=undefined){var b=this.getValueField(),a=this.selectedRecord.get(b);if(a!=c){return this.errorValueText}}},onDestroy:function(){if(this.quikTask){this.quikTask.cancel();this.quikTask=null}var a=this.generalselPanel.getGrid();if(a){a.un("rowclick",this.rowClick,this)}this.un("specialkey",this.tabKeyCollapse,this);Rs.ext.form.GridLoaderField.superclass.onDestroy.call(this)},setProgCode:function(a,b){this.progCode=a;this.progCondition=b;this.generalselPanel.setProgCode(this.progCode,this.progCondition)},setDataCompany:function(a){this.dataCompany=a;this.generalselPanel.setDataCompany(this.dataCompany)}});Ext.ComponentMgr.registerType("rs-ext-gridloaderfield",Rs.ext.form.GridLoaderField)})();Ext.ns("Rs.ext.form");(function(){Rs.ext.form.Telescope=function(a){a=a||{};Rs.ext.form.Telescope.superclass.constructor.call(this,a);if(this.singleSelect==false){this.setEditable(false)}this.cache={}};Ext.extend(Rs.ext.form.Telescope,Rs.ext.form.GridLoaderField,{separator:",",singleSelect:false,keyNavConfig:{up:function(){if(this.isExpanded()){this.focusPrev()}},down:function(){if(!this.isExpanded()){this.onTriggerClick()}else{this.focusNext()}},enter:function(b){b.stopPropagation();var a=this.generalselPanel.getGrid();if(this.isExpanded()){if(!a.getStore().getCount()){this.collapse()}this.rowSelect(this.generalselPanel.grid.getSelectionModel().getSelections());this.onSelect()}},esc:function(){if(this.isExpanded()){this.collapse();if(!this.selectedRecord){this.setRawValue("");delete this.lastValue}}},home:function(c){var b=this.generalselPanel.getPagingToolbar(),a=b?b.getPageData():undefined;if(a&&a.activePage>1){b.moveFirst()}},end:function(){var b=this.generalselPanel.getPagingToolbar(),a=b?b.getPageData():undefined;if(a&&a.activePage<a.pages){b.moveLast()}},pageUp:function(){var b=this.generalselPanel.getPagingToolbar(),a=b?b.getPageData():undefined;if(a&&a.activePage>1){b.movePrevious()}},pageDown:function(){var b=this.generalselPanel.getPagingToolbar(),a=b?b.getPageData():undefined;if(a&&a.activePage<a.pages){b.moveNext()}},tab:function(a){this.collapse();if(!this.selectedRecord){this.setRawValue("");delete this.lastValue}return true},scope:this,doRelay:function(c,b,a){if(a=="down"||this.scope.isExpanded()){var d=Ext.KeyNav.prototype.doRelay.apply(this,arguments);if(!Ext.isIE&&Ext.EventManager.useKeydown){this.scope.fireKey(c)}return d}return true},forceKeyDown:true,defaultEventAction:"stopEvent"},initGeneralselPanel:function(b){if(this.singleSelect==false){b=Ext.apply(b,{gridConfig:Ext.applyIf(b.gridConfig||{},{sm:new Ext.grid.CheckboxSelectionModel()})})}var a=Rs.ext.form.Telescope.superclass.initGeneralselPanel.call(this,b);var c=a.getBottomToolbar();c.add("->");c.add("-");c.addButton({text:"清空",iconCls:"rs-action-clear",handler:this.clear,scope:this});if(this.singleSelect==false){c.addButton({text:"确定",iconCls:"rs-action-submit",handler:this.submit,scope:this})}c.addButton({text:"取消",iconCls:"rs-action-cancel",handler:this.cancel,scope:this});return a},initEvents:function(){Rs.ext.form.Telescope.superclass.initEvents.call(this);var b=this.generalselPanel.getGrid(),a=b?b.getStore():undefined;if(a){a.on("load",this.checkSelected,this,{delay:20,scope:this})}},initLayerEvents:function(){Rs.ext.form.Telescope.superclass.initLayerEvents.call(this);var a=this.generalselPanel.getGrid();if(a){a.on("headerclick",this.selectModelHeaderClick,this,{delay:100,scope:this})}},selectModelHeaderClick:function(b,d){if(this.singleSelect==false){var a=b.getColumnModel();if(a&&a.getColumnAt(d) instanceof Ext.grid.AbstractSelectionModel){this.rowClick(b)}}},doQuery:function(c){if(c){if(this.singleSelect==true){var k=this.getDisplayField(),r=this.getValueField(),o,a;if(this.readOnly==true){o=this.getValue();if(!Ext.isEmpty(r,false)&&!Ext.isEmpty(o,false)){a=r+" = '"+o+"'"}else{a="1 <> 1"}}else{o=this.getRawValue();if(!Ext.isEmpty(k,false)&&!Ext.isEmpty(o,false)){a=k+" like '"+o+"%'"}}a=this.buildProgCondtion(a);if(this.fireEvent("beforequery",this,a)!==false){this.generalselPanel.query(a,function(l,d,s){this.fireEvent("query",this,d,a);if(d.length==1){var t=this.generalselPanel.grid;t.getSelectionModel().selectFirstRow();this.rowClick.defer(500,this,[t])}},this)}}else{var n=this.getDisplayField(),j=this.getValueField(),h=this.separator,b=[],m,q=[],p,g=[],o,a;if(this.readOnly==true){o=this.getValue();if(!Ext.isEmpty(j,false)&&!Ext.isEmpty(o,false)){q=o.split(h);for(var f=0,e=q.length;f<e;f++){p=q[f];g.push("("+j+" = '"+p+"')")}if(g.length>0){a="("+g.join(" OR ")+")"}else{a="1 <> 1"}}else{a="1 <> 1"}}else{o=this.getRawValue();if(!Ext.isEmpty(n,false)&&!Ext.isEmpty(o,false)){b=o.split(h);for(var f=0,e=b.length;f<e;f++){m=b[f];g.push("("+n+" like '"+m+"%')")}if(g.length>0){a="("+g.join(" OR ")+")"}}}a=this.buildProgCondtion(a);if(this.fireEvent("beforequery",this,a)!==false){this.generalselPanel.query(a,function(l,d,s){this.fireEvent("query",this,d,a)},this)}}}else{var a=this.buildProgCondtion(a);if(this.fireEvent("beforequery",this,a)!==false){this.generalselPanel.query(a,function(l,d,s){this.fireEvent("query",this,d,a)},this)}}},setValue:function(s){if(this.singleSelect==true){return Rs.ext.form.Telescope.superclass.setValue.apply(this,arguments)}else{delete this.selectedRecord;var k=this.getValueField(),q=this.getDisplayField(),j=this.separator,o,p,c=[],n,u,h=[],m=[],t,a,g=[],b;if(!Ext.isEmpty(k,false)&&!Ext.isEmpty(s,false)){this.lastValue=s;Rs.ext.form.GridLoaderField.superclass.setValue.call(this,s);u=s.split(j);for(var f=0,e=u.length;f<e;f++){t=u[f];g.push("("+k+" = '"+t+"')")}if(g.length>0){b="("+g.join(" OR ")+")"}b=this.buildProgCondtion(b);this.generalselPanel.query(b,function(w,v){var r=w.query(k,new RegExp("^"+u.join("|")+"$"));if(r&&r.length>0){for(var y=0,d=r.length;y<d;y++){a=r.get(y);t=a.get(k);n=a.get(q);h.push(t);c.push(n);m.push(a)}o=c.join(j);p=h.join(j);this.el.dom.value=o;var x=this.lastValue;this.lastValue=p;this.selectedRecord=r;this.fireEvent("change",this,this.lastValue,x);this.fireEvent("passed",this,p,r,k);this.rowSelect(m)}else{if(this.value!==undefined&&this.value.length==0){this.lastValue=this.value;Rs.ext.form.GridLoaderField.superclass.setValue.call(this,this.value)}else{this.fireEvent("unpassed",this,this.value,k);this.applyEmptyText()}}},this)}else{this.lastValue=s;Rs.ext.form.GridLoaderField.superclass.setValue.call(this,s);this.fireEvent("unpassed",this,s,k);this.applyEmptyText()}}},clear:function(){var b=this.generalselPanel.getGrid(),c=b?b.getSelectionModel():undefined;if(c){c.clearSelections()}this.cache={};var a=this.getValue();this.clearValue();this.collapse();this.focus();this.fireEvent("change",this,null,a)},submit:function(){var b=this.cache,m=[],c=[],e=[],a,j=this.getDisplayField(),g=this.getValueField(),f=this.separator;for(var d in b){a=b[d];if(a){m.push(a.get(g));c.push(a.get(j));e.push(a)}}if(this.fireEvent("beforeselect",this,e)){var h=c.join(f),l=m.join(f);this.el.dom.value=h;if(String(this.lastValue)!=String(l)){this.fireEvent("change",this,l,this.lastValue)}this.lastValue=l;this.selectedRecord=e;this.collapse();if(!this.selectedRecord){this.setRawValue("");delete this.lastValue}this.fireEvent("select",this,e,l,h)}},cancel:function(){this.collapse();if(!this.selectedRecord){this.setRawValue("");delete this.lastValue}this.focus()},checkSelected:function(n,d){var b=this.cache,a,m,e,h=[],j=this.generalselPanel.getGrid();if(j&&j.rendered){if((sm=j.getSelectionModel())&&sm instanceof Ext.grid.CheckboxSelectionModel){d=d||[];for(var f=0,c=d.length;f<c;f++){a=d[f];m=a&&a.data?a.data:undefined;if(m){e=Rs.hashCode(m);if(b[e]!=undefined){h.push(a)}}}if(h.length>0){sm.selectRecords(h,true)}}}},rowSelect:function(f){if(this.singleSelect==true){return Rs.ext.form.Telescope.superclass.rowSelect.apply(this,arguments)}else{var e=this.cache,d=f||[],h,c,b;for(var g=0,a=d.length;g<a;g++){h=d[g];c=h&&h.data?h.data:undefined;if(c){b=Rs.hashCode(c);e[b]=h}}}},rowDeSelect:function(e){if(this.singleSelect==true){return Rs.ext.form.Telescope.superclass.rowDeSelect.apply(this,arguments)}else{var d=e||[],g,c,b;for(var f=0,a=d.length;f<a;f++){g=d[f];c=g&&g.data?g.data:undefined;if(c){b=Rs.hashCode(c);delete this.cache[b]}}}},getValueError:function(){},onDestroy:function(){Rs.ext.form.Telescope.superclass.onDestroy.apply(this,arguments);var a=this.generalselPanel.getStore();if(a){a.un("load",this.checkSelected,this)}var b=this.generalselPanel.getGrid();if(b){b.un("headerclick",this.selectModelHeaderClick,this)}},onSelect:function(){if(this.readOnly){this.collapse();return}if(this.singleSelect){var b=this.generalselPanel.getGrid(),a=this.generalselPanel.getStore(),e=b.getSelectionModel();record=e.getSelected();if(record&&this.fireEvent("beforeselect",this,record,a)){var d=record.get(this.getDisplayField()),c=record.get(this.getValueField());this.el.dom.value=d;if(String(this.lastValue)!=String(c)){this.fireEvent("change",this,c,this.lastValue)}this.lastValue=c;this.selectedRecord=record;this.collapse();this.fireEvent("select",this,record,c,d)}}else{this.submit()}},quickAhead:function(){if(!this.isExpanded()){this.expand()}if(this.singleSelect==true){var a=true;this.doQuery(a)}else{var a=false;this.doQuery(a)}},onTriggerClick:function(){if(this.disabled||(this.readOnly&&this.singleSelect)){return}if(!this.isExpanded()&&!this.disabled){this.expand();var a=false;this.doQuery(a)}else{this.collapse();if(!this.selectedRecord){this.setRawValue("");delete this.lastValue}}},collapseIf:function(a){if(a&&!a.within(this.wrap)&&!a.within(this.view)){this.collapse();if(!this.selectedRecord){this.setRawValue("");delete this.lastValue}}}});Ext.ComponentMgr.registerType("rs-ext-telescope",Rs.ext.form.Telescope)})();Ext.ns("Rs.ext.form");(function(){Rs.ext.form.SuggestTag=function(a){a=a||{};Rs.ext.form.SuggestTag.superclass.constructor.call(this,a);if(this.singleSelect==false){this.setEditable(false)}this.cache={}};Ext.extend(Rs.ext.form.SuggestTag,Rs.ext.form.GridLoaderField,{separator:",",singleSelect:false,initGeneralselPanel:function(b){if(this.singleSelect==false){b=Ext.apply(b,{gridConfig:Ext.applyIf(b.gridConfig||{},{sm:new Ext.grid.CheckboxSelectionModel()})})}var a=Rs.ext.form.SuggestTag.superclass.initGeneralselPanel.call(this,b);var c=a.getBottomToolbar();c.add("->");c.add("-");c.addButton({text:"清空",iconCls:"rs-action-clear",handler:this.clear,scope:this});if(this.singleSelect==false){c.addButton({text:"确定",iconCls:"rs-action-submit",handler:this.submit,scope:this})}c.addButton({text:"取消",iconCls:"rs-action-cancel",handler:this.cancel,scope:this});return a},initEvents:function(){Rs.ext.form.SuggestTag.superclass.initEvents.call(this);var b=this.generalselPanel.getGrid(),a=b?b.getStore():undefined;if(a){a.on("load",this.checkSelected,this,{delay:20,scope:this})}},initLayerEvents:function(){Rs.ext.form.SuggestTag.superclass.initLayerEvents.call(this);var a=this.generalselPanel.getGrid();if(a){a.on("headerclick",this.selectModelHeaderClick,this,{delay:100,scope:this})}},selectModelHeaderClick:function(b,d){if(this.singleSelect==false){var a=b.getColumnModel();if(a&&a.getColumnAt(d) instanceof Ext.grid.AbstractSelectionModel){this.rowClick(b)}}},doQuery:function(c){if(c){if(this.singleSelect==true){return Rs.ext.form.SuggestTag.superclass.doQuery.call(this)}else{var m=this.getDisplayField(),j=this.getValueField(),h=this.separator,b=[],k,p=[],o,g=[],n,a;if(this.readOnly==true){n=this.getValue();if(!Ext.isEmpty(j,false)&&!Ext.isEmpty(n,false)){p=n.split(h);for(var f=0,e=p.length;f<e;f++){o=p[f];g.push("("+j+" = '"+o+"')")}if(g.length>0){a="("+g.join(" OR ")+")"}else{a="1 <> 1"}}else{a="1 <> 1"}}else{n=this.getRawValue();if(!Ext.isEmpty(m,false)&&!Ext.isEmpty(n,false)){b=n.split(h);for(var f=0,e=b.length;f<e;f++){k=b[f];g.push("("+m+" like '"+k+"%')")}if(g.length>0){a="("+g.join(" OR ")+")"}}}a=this.buildProgCondtion(a);if(this.fireEvent("beforequery",this,a)!==false){this.generalselPanel.query(a,function(l,d,q){this.fireEvent("query",this,d,a)},this)}}}else{var a=this.buildProgCondtion(a);if(this.fireEvent("beforequery",this,a)!==false){this.generalselPanel.query(a,function(l,d,q){this.fireEvent("query",this,d,a)},this)}}},setValue:function(s){if(this.singleSelect==true){return Rs.ext.form.SuggestTag.superclass.setValue.apply(this,arguments)}else{delete this.selectedRecord;var k=this.getValueField(),q=this.getDisplayField(),j=this.separator,o,p,c=[],n,u,h=[],m=[],t,a,g=[],b;if(!Ext.isEmpty(k,false)&&!Ext.isEmpty(s,false)){this.lastValue=s;Rs.ext.form.GridLoaderField.superclass.setValue.call(this,s);u=s.split(j);for(var f=0,e=u.length;f<e;f++){t=u[f];g.push("("+k+" = '"+t+"')")}if(g.length>0){b="("+g.join(" OR ")+")"}b=this.buildProgCondtion(b);this.generalselPanel.query(b,function(w,v){var r=w.query(k,new RegExp("^"+u.join("|")+"$"));if(r&&r.length>0){for(var y=0,d=r.length;y<d;y++){a=r.get(y);t=a.get(k);n=a.get(q);h.push(t);c.push(n);m.push(a)}o=c.join(j);p=h.join(j);this.el.dom.value=o;var x=this.lastValue;this.lastValue=p;this.selectedRecord=r;this.fireEvent("change",this,this.lastValue,x);this.fireEvent("passed",this,p,r,k);this.rowSelect(m)}else{if(this.value!==undefined&&this.value.length==0){this.lastValue=this.value;Rs.ext.form.GridLoaderField.superclass.setValue.call(this,this.value)}else{this.fireEvent("unpassed",this,this.value,k);this.applyEmptyText()}}},this)}else{this.lastValue=s;Rs.ext.form.GridLoaderField.superclass.setValue.call(this,s);this.fireEvent("unpassed",this,s,k);this.applyEmptyText()}}},clear:function(){var b=this.generalselPanel.getGrid(),c=b?b.getSelectionModel():undefined;if(c){c.clearSelections()}this.cache={};var a=this.getValue();this.clearValue();this.collapse();this.focus();this.fireEvent("change",this,null,a)},submit:function(){var b=this.cache,m=[],c=[],e=[],a,j=this.getDisplayField(),g=this.getValueField(),f=this.separator;for(var d in b){a=b[d];if(a){m.push(a.get(g));c.push(a.get(j));e.push(a)}}if(this.fireEvent("beforeselect",this,e)){var h=c.join(f),l=m.join(f);this.el.dom.value=h;if(String(this.lastValue)!=String(l)){this.fireEvent("change",this,l,this.lastValue)}this.lastValue=l;this.selectedRecord=e;this.collapse();this.fireEvent("select",this,e,l,h)}},cancel:function(){this.collapse();this.focus()},checkSelected:function(n,d){var b=this.cache,a,m,e,h=[],j=this.generalselPanel.getGrid();if(j&&j.rendered){if((sm=j.getSelectionModel())&&sm instanceof Ext.grid.CheckboxSelectionModel){d=d||[];for(var f=0,c=d.length;f<c;f++){a=d[f];m=a&&a.data?a.data:undefined;if(m){e=Rs.hashCode(m);if(b[e]!=undefined){h.push(a)}}}if(h.length>0){sm.selectRecords(h,true)}}}},rowSelect:function(f){if(this.singleSelect==true){return Rs.ext.form.SuggestTag.superclass.rowSelect.apply(this,arguments)}else{var e=this.cache,d=f||[],h,c,b;for(var g=0,a=d.length;g<a;g++){h=d[g];c=h&&h.data?h.data:undefined;if(c){b=Rs.hashCode(c);e[b]=h}}}},rowDeSelect:function(e){if(this.singleSelect==true){return Rs.ext.form.SuggestTag.superclass.rowDeSelect.apply(this,arguments)}else{var d=e||[],g,c,b;for(var f=0,a=d.length;f<a;f++){g=d[f];c=g&&g.data?g.data:undefined;if(c){b=Rs.hashCode(c);delete this.cache[b]}}}},onSelect:function(){if(this.readOnly){this.collapse();return}if(this.singleSelect){var b=this.generalselPanel.getGrid(),a=this.generalselPanel.getStore(),e=b.getSelectionModel();record=e.getSelected();if(record&&this.fireEvent("beforeselect",this,record,a)){var d=record.get(this.getDisplayField()),c=record.get(this.getValueField());this.el.dom.value=d;if(String(this.lastValue)!=String(c)){this.fireEvent("change",this,c,this.lastValue)}this.lastValue=c;this.selectedRecord=record;this.collapse();this.fireEvent("select",this,record,c,d)}}else{this.submit()}},quickAhead:function(){if(!this.isExpanded()){this.expand()}if(this.singleSelect==true){var a=true;this.doQuery(a)}else{var a=false;this.doQuery(a)}},onTriggerClick:function(){if(this.disabled||(this.readOnly&&this.singleSelect)){return}if(!this.isExpanded()&&!this.disabled){this.expand();var a=false;this.doQuery(a)}else{this.collapse()}},getValue:function(){if(this.selectedRecord){var a=this.lastValue||"";if(Ext.isEmpty(a)){delete this.selectedRecord}return a}else{return this.getRawValue()}},getValueError:function(){},onDestroy:function(){Rs.ext.form.SuggestTag.superclass.onDestroy.apply(this,arguments);var a=this.generalselPanel.getStore();if(a){a.un("load",this.checkSelected,this)}var b=this.generalselPanel.getGrid();if(b){b.un("headerclick",this.selectModelHeaderClick,this)}}});Ext.ComponentMgr.registerType("rs-ext-suggesttag",Rs.ext.form.SuggestTag)})();Ext.ns("Rs.ext.form");(function(){Rs.ext.form.SingleUploadField=Ext.extend(Ext.form.TextField,{buttonText:"上传文件",buttonOnly:false,buttonOffset:3,readOnly:true,autoSize:Ext.emptyFn,initComponent:function(){Rs.ext.form.SingleUploadField.superclass.initComponent.call(this);this.addEvents("fileselected","beforeclick")},onRender:function(c,a){Rs.ext.form.SingleUploadField.superclass.onRender.call(this,c,a);this.wrap=this.el.wrap({cls:"x-form-field-wrap x-form-file-wrap"});this.el.addClass("x-form-file-text");this.el.dom.removeAttribute("name");this.createFileInput();var b=Ext.applyIf(this.buttonCfg||{},{text:this.buttonText});this.button=new Ext.Button(Ext.apply(b,{renderTo:this.wrap,cls:"x-form-file-btn"+(b.iconCls?" x-btn-icon":"")}));if(this.buttonOnly){this.el.hide();this.wrap.setWidth(this.button.getEl().getWidth())}this.bindListeners();this.resizeEl=this.positionEl=this.wrap},bindListeners:function(){this.fileInput.on({scope:this,mouseenter:function(){this.button.addClass(["x-btn-over","x-btn-focus"])},mouseleave:function(){this.button.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},mousedown:function(){this.button.addClass("x-btn-click")},mouseup:function(){this.button.removeClass(["x-btn-over","x-btn-focus","x-btn-click"])},change:function(){var a=this.fileInput.dom.value;if(a){this.setValue(a);this.fireEvent("fileselected",this,a)}}});this.wrap.on("click",function(){this.fireEvent("beforeclick",this)},this)},createFileInput:function(){this.fileInput=this.wrap.createChild({id:this.getFileInputId(),name:this.name||this.getId(),cls:"x-form-file",tag:"input",type:"file",size:1})},reset:function(){this.fileInput.remove();this.createFileInput();this.bindListeners();Rs.ext.form.SingleUploadField.superclass.reset.call(this)},getFileInputId:function(){return this.id+"-file"},onResize:function(a,b){Rs.ext.form.SingleUploadField.superclass.onResize.call(this,a,b);this.wrap.setWidth(a);if(!this.buttonOnly){var a=this.wrap.getWidth()-this.button.getEl().getWidth()-this.buttonOffset;this.el.setWidth(a)}},onDestroy:function(){Rs.ext.form.SingleUploadField.superclass.onDestroy.call(this);Ext.destroy(this.fileInput,this.button,this.wrap)},onDisable:function(){Rs.ext.form.SingleUploadField.superclass.onDisable.call(this);this.doDisable(true)},onEnable:function(){Rs.ext.form.SingleUploadField.superclass.onEnable.call(this);this.doDisable(false)},doDisable:function(a){this.fileInput.dom.disabled=a;this.button.setDisabled(a)},preFocus:Ext.emptyFn,alignErrorIcon:function(){this.errorIcon.alignTo(this.wrap,"tl-tr",[2,0])},getUploadPanel:function(){return this.uppanel}});Ext.reg("rs-ext-singleuploadfield",Rs.ext.form.SingleUploadField)})();Ext.ns("Rs.ext.form");(function(){Rs.ext.form.TreeComboBox=Ext.extend(Ext.form.TriggerField,{width:120,initComponent:function(){this.addEvents(["select"]);Rs.ext.form.TreeComboBox.superclass.initComponent.call(this);this.emptyText="选择"+(this.name||"")},onRender:function(a,b){Rs.ext.form.TreeComboBox.superclass.onRender.call(this,a,b);this.el.dom.readOnly=true;this.el.setStyle({cursor:"pointer"});this.el.on("click",this.onTriggerClick,this)},onTriggerClick:function(){if(this.disabled){return}if(!this.view){this.initLayer()}if(this.expanded){this.collapse()}else{this.tree.collapseAll();this.expand()}},initLayer:function(){this.view=new Ext.Layer({constrain:false,shadow:"sides",cls:" x-combo-list "});this.view.swallowEvent("mousewheel");this.view.swallowEvent("mousedown");this.resizer=new Ext.Resizable(this.view,{pinned:true,handles:"se"});this.tree.render(this.view);this.resizer.on("resize",function(c,a,b){this.tree.setWidth(a-2);this.tree.setHeight(b-2)},this);this.on("blur",this.collapse,this);this.tree.getSelectionModel().on("selectionchange",this.onSelect,this)},expand:function(){this.view.alignTo(this.wrap,"tl-bl?");this.view.show();this.expanded=true;Ext.getDoc().on("mousewheel",this.collapseIf,this);Ext.getDoc().on("mousedown",this.collapseIf,this)},collapse:function(){this.view.hide();this.expanded=false;Ext.getDoc().un("mousewheel",this.collapseIf,this);Ext.getDoc().un("mousedown",this.collapseIf,this)},collapseIf:function(a){if(!a.within(this.wrap)&&!a.within(this.view)){this.collapse()}},onSelect:function(c,a){var b=a.attributes;this.member=b;this.collapse();this.fireEvent("submit",this,b)},getValue:function(){return this.member},setValue:function(a){this.member=a;this.fireEvent("submit",this,a)},onDestroy:function(){Rs.ext.form.TreeComboBox.superclass.onDestroy.call(this);if(this.tree){this.tree.destroy()}if(this.view){this.view.remove()}}});Ext.ComponentMgr.registerType("rs-ext-treecombobox",Rs.ext.form.TreeComboBox)})();Ext.ns("Rs.ext.form");Rs.ext.form.NumberField=function(a){Rs.ext.form.NumberField.superclass.constructor.call(this,a)};Ext.extend(Rs.ext.form.NumberField,Ext.form.NumberField,{setValue:function(a){a=typeof a=="number"?a:String(a).replace(this.decimalSeparator,".").replace(/,/g,"");var b=Rs.ext.form.NumberField.superclass.setValue.call(this,a);this.setRawValue(isNaN(a)?"":Rs.ext.form.NumberField.rendererMillesimalMark(a,this.decimalPrecision));return b},fixPrecision:function(b){var a=isNaN(b);if(!this.allowDecimals||this.decimalPrecision==-1||a||!b){return a?"":b}return Rs.ext.form.NumberField.toFixed(parseFloat(b),this.decimalPrecision)},validateValue:function(b){if(!Rs.ext.form.NumberField.superclass.validateValue.call(this,b)){return false}if(b.length<1){return true}b=String(b).replace(this.decimalSeparator,".").replace(/,/g,"");if(isNaN(b)){this.markInvalid(String.format(this.nanText,b));return false}var a=this.parseValue(b);if(a<this.minValue){this.markInvalid(String.format(this.minText,this.minValue));return false}if(a>this.maxValue){this.markInvalid(String.format(this.maxText,this.maxValue));return false}return true},processValue:function(a){var b=Rs.ext.form.NumberField.superclass.processValue.call(this,a);return this.parseValue(b)},parseValue:function(a){a=parseFloat(String(a).replace(this.decimalSeparator,".").replace(/,/g,""));return isNaN(a)?"":a}});Rs.ext.form.NumberField.toFixed=function(h,j){var g=h+"";if(!j){j=0}if(g.indexOf(".")==-1){g+="."}g+=new Array(j+1).join("0");if(new RegExp("^(-|\\+)?(\\d+(\\.\\d{0,"+(j+1)+"})?)\\d*$").test(g)){var g="0"+RegExp.$2,f=RegExp.$1,d=RegExp.$3.length,c=true;if(d==j+2){d=g.match(/\d/g);if(parseInt(d[d.length-1])>4){for(var e=d.length-2;e>=0;e--){d[e]=parseInt(d[e])+1;if(d[e]==10){d[e]=0;c=e!=1}else{break}}}g=d.join("").replace(new RegExp("(\\d+)(\\d{"+j+"})\\d$"),"$1.$2")}if(c){g=g.substr(1)}return(f+g).replace(/\.$/,"")}return h+""};Rs.ext.form.NumberField.rendererMillesimalMark=function(a,f){if(isNaN(a)){return a}a=Rs.ext.form.NumberField.toFixed(a,f);a=(a==Math.floor(a))?a+".00":((a*10==Math.floor(a*10))?a+"0":a);a=String(a);var e=a.split(".");var d=e[0];var b=e[1]?"."+e[1]:".00";var c=/(\d+)(\d{3})/;while(c.test(d)){d=d.replace(c,"$1,$2")}a=d+b;if(Ext.isEmpty(d)){return""}if(a.substr(a.indexOf(".")+1).length>f){a=a.substr(0,(a.indexOf(".")+1+f))}if(a.charAt(a.length-1)==="."){a=a.substr(0,a.length-1)}return a};Ext.ComponentMgr.registerType("rs-ext-numberfield",Rs.ext.form.NumberField);Ext.namespace("Rs.ext.form");Rs.ext.form.ColorPicker=Ext.extend(Ext.BoxComponent,{initComponent:function(){this.applyDefaultsCP();Rs.ext.form.ColorPicker.superclass.initComponent.apply(this,arguments);this.addEvents("select")},onRender:function(){Rs.ext.form.ColorPicker.superclass.onRender.apply(this,arguments);this.body=this.body||(this.container||(this.renderTo||Ext.DomHelper.append(Ext.getBody(),{},true)));if(!this.el){this.el=this.body;if(this.cls){Ext.get(this.el).addClass(this.cls)}}this.renderComponent()},applyDefaultsCP:function(){Ext.apply(this,{cls:"x-cp-mainpanel",resizable:this.resizable||false,HSV:{h:0,s:0,v:0},updateMode:null})},renderComponent:function(){Ext.DomHelper.append(this.body,{id:this.cpGetId("rgb"),cls:"x-cp-rgbpicker"});Ext.DomHelper.append(this.body,{id:this.cpGetId("hue"),cls:"x-cp-huepicker"});this.huePicker=Ext.DomHelper.append(this.body,{cls:"x-cp-hueslider"});this.hueDD=new Ext.dd.DD(this.huePicker,"huePicker");this.hueDD.constrainTo(this.cpGetId("hue"),{top:-7,right:-3,bottom:-7,left:-3});this.hueDD.onDrag=this.moveHuePicker.createDelegate(this);Ext.get(this.cpGetId("hue")).on("mousedown",this.clickHUEPicker.createDelegate(this));Ext.get(this.huePicker).moveTo(Ext.get(this.cpGetId("hue")).getLeft()-3,Ext.get(this.cpGetId("hue")).getTop()-7);this.rgbPicker=Ext.DomHelper.append(this.body,{cls:"x-cp-rgbslider"});this.rgbDD=new Ext.dd.DD(this.rgbPicker,"rgbPicker");this.rgbDD.constrainTo(this.cpGetId("rgb"),-7);this.rgbDD.onDrag=this.moveRGBPicker.createDelegate(this);Ext.get(this.cpGetId("rgb")).on("mousedown",this.clickRGBPicker.createDelegate(this));Ext.get(this.rgbPicker).moveTo(Ext.get(this.cpGetId("rgb")).getLeft()-7,Ext.get(this.cpGetId("rgb")).getTop()-7);this.formPanel=new Ext.form.FormPanel({renderTo:Ext.DomHelper.append(this.body,{id:this.cpGetId("fCont"),cls:"x-cp-formcontainer"},true),frame:true,labelAlign:"left",labelWidth:10,baseCls:"x-panel-mc",items:[{layout:"column",items:[{columnWidth:0.5,layout:"form",defaultType:"numberfield",defaults:{width:30,value:0,minValue:0,maxValue:255,allowBlank:true,labelSeparator:""},items:[{fieldLabel:"R",id:this.cpGetId("iRed")},{fieldLabel:"G",id:this.cpGetId("iGreen")},{fieldLabel:"B",id:this.cpGetId("iBlue")}]},{columnWidth:0.5,layout:"form",defaultType:"numberfield",defaults:{width:30,value:0,minValue:0,maxValue:255,allowBlank:true,labelSeparator:""},items:[{fieldLabel:"H",maxValue:360,id:this.cpGetId("iHue")},{fieldLabel:"S",id:this.cpGetId("iSat")},{fieldLabel:"V",id:this.cpGetId("iVal")}]}]},{layout:"form",defaultType:"textfield",labelAlign:"left",defaults:{width:85,value:"000000",labelSeparator:"",allowBlank:true},id:this.cpGetId("cCont"),items:[{fieldLabel:"#",id:this.cpGetId("iHexa"),value:"000000"}]}]});Ext.getCmp(this.cpGetId("iRed")).on("change",this.updateFromIRGB.createDelegate(this));Ext.getCmp(this.cpGetId("iGreen")).on("change",this.updateFromIRGB.createDelegate(this));Ext.getCmp(this.cpGetId("iBlue")).on("change",this.updateFromIRGB.createDelegate(this));Ext.getCmp(this.cpGetId("iHue")).on("change",this.updateFromIHSV.createDelegate(this));Ext.getCmp(this.cpGetId("iSat")).on("change",this.updateFromIHSV.createDelegate(this));Ext.getCmp(this.cpGetId("iVal")).on("change",this.updateFromIHSV.createDelegate(this));Ext.getCmp(this.cpGetId("iHexa")).on("change",this.updateFromIHexa.createDelegate(this));Ext.DomHelper.append(this.cpGetId("cCont"),{cls:"x-cp-colorbox",id:this.cpGetId("cWebSafe")},true).update(this.i18n.websafe);Ext.DomHelper.append(this.cpGetId("cCont"),{cls:"x-cp-colorbox",id:this.cpGetId("cInverse")},true).update(this.i18n.inverse);Ext.DomHelper.append(this.cpGetId("cCont"),{cls:"x-cp-colorbox",id:this.cpGetId("cColor")},true).update(this.i18n.pick_color);Ext.get(this.cpGetId("cWebSafe")).on("click",this.updateFromBox.createDelegate(this));Ext.get(this.cpGetId("cInverse")).on("click",this.updateFromBox.createDelegate(this));Ext.get(this.cpGetId("cColor")).on("click",this.selectColor.createDelegate(this));Ext.DomHelper.append(this.body,{tag:"br",cls:"x-cp-clearfloat"})},cpGetId:function(a){return this.getId()+"__"+(a||"cp")},updateRGBPosition:function(a,b){this.updateMode="click";a=a<0?0:a;a=a>181?181:a;b=b<0?0:b;b=b>181?181:b;this.HSV.s=this.getSaturation(a);this.HSV.v=this.getValue(b);Ext.get(this.rgbPicker).moveTo(Ext.get(this.cpGetId("rgb")).getLeft()+a-7,Ext.get(this.cpGetId("rgb")).getTop()+b-7,(this.animateMove||true));this.updateColor()},updateHUEPosition:function(a){this.updateMode="click";a=a<1?1:a;a=a>181?181:a;this.HSV.h=Math.round(360/181*(181-a));Ext.get(this.huePicker).moveTo(Ext.get(this.huePicker).getLeft(),Ext.get(this.cpGetId("hue")).getTop()+a-7,(this.animateMove||true));this.updateRGBPicker(this.HSV.h);this.updateColor()},clickRGBPicker:function(b,a){this.updateRGBPosition(b.xy[0]-Ext.get(this.cpGetId("rgb")).getLeft(),b.xy[1]-Ext.get(this.cpGetId("rgb")).getTop())},clickHUEPicker:function(b,a){this.updateHUEPosition(b.xy[1]-Ext.get(this.cpGetId("hue")).getTop())},moveRGBPicker:function(a){this.rgbDD.constrainTo(this.cpGetId("rgb"),-7);this.updateRGBPosition(Ext.get(this.rgbPicker).getLeft()-Ext.get(this.cpGetId("rgb")).getLeft()+7,Ext.get(this.rgbPicker).getTop()-Ext.get(this.cpGetId("rgb")).getTop()+7)},moveHuePicker:function(a){this.hueDD.constrainTo(this.cpGetId("hue"),{top:-7,right:-3,bottom:-7,left:-3});this.updateHUEPosition(Ext.get(this.huePicker).getTop()-Ext.get(this.cpGetId("hue")).getTop()+7)},updateRGBPicker:function(a){this.updateMode="click";Ext.get(this.cpGetId("rgb")).setStyle({"background-color":"#"+this.rgbToHex(this.hsvToRgb(a,1,1))});this.updateColor()},updateColor:function(){var b=this.hsvToRgb(this.HSV.h,this.HSV.s,this.HSV.v);var c=this.websafe(b);var d=this.invert(b);var a=this.invert(c);if(this.updateMode!=="hexa"){Ext.getCmp(this.cpGetId("iHexa")).setValue(this.rgbToHex(b))}if(this.updateMode!=="rgb"){Ext.getCmp(this.cpGetId("iRed")).setValue(b[0]);Ext.getCmp(this.cpGetId("iGreen")).setValue(b[1]);Ext.getCmp(this.cpGetId("iBlue")).setValue(b[2])}if(this.updateMode!=="hsv"){Ext.getCmp(this.cpGetId("iHue")).setValue(Math.round(this.HSV.h));Ext.getCmp(this.cpGetId("iSat")).setValue(Math.round(this.HSV.s*100));Ext.getCmp(this.cpGetId("iVal")).setValue(Math.round(this.HSV.v*100))}Ext.get(this.cpGetId("cColor")).setStyle({background:"#"+this.rgbToHex(b),color:"#"+this.rgbToHex(d)});Ext.getDom(this.cpGetId("cColor")).title="#"+this.rgbToHex(b);Ext.get(this.cpGetId("cInverse")).setStyle({background:"#"+this.rgbToHex(d),color:"#"+this.rgbToHex(b)});Ext.getDom(this.cpGetId("cInverse")).title="#"+this.rgbToHex(d);Ext.get(this.cpGetId("cWebSafe")).setStyle({background:"#"+this.rgbToHex(c),color:"#"+this.rgbToHex(a)});Ext.getDom(this.cpGetId("cWebSafe")).title="#"+this.rgbToHex(c);Ext.get(this.huePicker).moveTo(Ext.get(this.huePicker).getLeft(),Ext.get(this.cpGetId("hue")).getTop()+this.getHPos(Ext.getCmp(this.cpGetId("iHue")).getValue())-7,(this.animateMove||true));Ext.get(this.rgbPicker).moveTo(Ext.get(this.cpGetId("rgb")).getLeft()+this.getSPos(Ext.getCmp(this.cpGetId("iSat")).getValue()/100)-7,Ext.get(this.cpGetId("hue")).getTop()+this.getVPos(Ext.getCmp(this.cpGetId("iVal")).getValue()/100)-7,(this.animateMove||true));Ext.get(this.cpGetId("rgb")).setStyle({"background-color":"#"+this.rgbToHex(this.hsvToRgb(Ext.getCmp(this.cpGetId("iHue")).getValue(),1,1))})},setColor:function(a){if(!/^[0-9a-fA-F]{6}$/.test(a)){return}Ext.getCmp(this.cpGetId("iHexa")).setValue(a);this.updateFromIHexa()},updateFromIRGB:function(b,d,c){this.updateMode="rgb";var a=this.rgbToHsv(Ext.getCmp(this.cpGetId("iRed")).getValue(),Ext.getCmp(this.cpGetId("iGreen")).getValue(),Ext.getCmp(this.cpGetId("iBlue")).getValue());this.HSV={h:a[0],s:a[1],v:a[2]};this.updateColor()},updateFromIHSV:function(a,c,b){this.updateMode="hsv";this.HSV={h:Ext.getCmp(this.cpGetId("iHue")).getValue(),s:Ext.getCmp(this.cpGetId("iSat")).getValue()/100,v:Ext.getCmp(this.cpGetId("iVal")).getValue()/100};this.updateColor()},updateFromIHexa:function(b,d,c){this.updateMode="hexa";var a=this.rgbToHsv(this.hexToRgb(Ext.getCmp(this.cpGetId("iHexa")).getValue()));this.HSV={h:a[0],s:a[1],v:a[2]};this.updateColor()},getBackgroundColor:function(b){var e=Ext.get(b).getColor("backgroundColor","","#");var a="";if(e.substr(0,1)=="#"){if(e.length==4){for(var d=1;d<4;d++){var f=e.charAt(d);a+=f+f}}else{if(e.length==7){a+=e.substr(1)}}}return a},updateFromBox:function(d,c){this.updateMode="click";var b=this.getBackgroundColor(c);var a=this.rgbToHsv(this.hexToRgb(b));this.HSV={h:a[0],s:a[1],v:a[2]};this.updateColor()},selectColor:function(c,b){var a=this.getBackgroundColor(b);this.fireEvent("select",this,a)},hsvToRgb:function(j,u,n){if(j instanceof Array){return this.hsvToRgb.call(this,j[0],j[1],j[2])}var a,k,m,e,l,d,c,o;e=Math.floor((j/60)%6);l=(j/60)-e;d=n*(1-u);c=n*(1-l*u);o=n*(1-(1-l)*u);switch(e){case 0:a=n;k=o;m=d;break;case 1:a=c;k=n;m=d;break;case 2:a=d;k=n;m=o;break;case 3:a=d;k=c;m=n;break;case 4:a=o;k=d;m=n;break;case 5:a=n;k=d;m=c;break}return[this.realToDec(a),this.realToDec(k),this.realToDec(m)]},rgbToHsv:function(a,e,f){if(a instanceof Array){return this.rgbToHsv.call(this,a[0],a[1],a[2])}a=a/255;e=e/255;f=f/255;var c,j,l,d,m,k;c=Math.min(Math.min(a,e),f);j=Math.max(Math.max(a,e),f);l=j-c;switch(j){case c:d=0;break;case a:d=60*(e-f)/l;if(e<f){d+=360}break;case e:d=(60*(f-a)/l)+120;break;case f:d=(60*(a-e)/l)+240;break}m=(j===0)?0:1-(c/j);return[Math.round(d),m,j]},realToDec:function(a){return Math.min(255,Math.round(a*256))},rgbToHex:function(d,c,a){if(d instanceof Array){return this.rgbToHex.call(this,d[0],d[1],d[2])}return this.decToHex(d)+this.decToHex(c)+this.decToHex(a)},decToHex:function(b){var a="0123456789ABCDEF";b=parseInt(b,10);b=(!isNaN(b))?b:0;b=(b>255||b<0)?0:b;return a.charAt((b-b%16)/16)+a.charAt(b%16)},getHCharPos:function(b){if(b!=undefined){var a="0123456789ABCDEF";return a.indexOf(b.toUpperCase())}},hexToDec:function(b){var a=b.split("");return((this.getHCharPos(a[0])*16)+this.getHCharPos(a[1]))},hexToRgb:function(a){return[this.hexToDec(a.substr(0,2)),this.hexToDec(a.substr(2,2)),this.hexToDec(a.substr(4,2))]},getHue:function(b){var a=360-Math.round(((181-b)/181)*360);return a===360?0:a},getHPos:function(a){return 181-a*(181/360)},getSaturation:function(a){return a/181},getSPos:function(a){return a*181},getValue:function(a){return(181-a)/181},getVPos:function(a){return 181-(a*181)},checkSafeNumber:function(a){if(!isNaN(a)){a=Math.min(Math.max(0,a),255);var b,c;for(b=0;b<256;b=b+51){c=b+51;if(a>=b&&a<=c){return(a-b>25)?c:b}}}return a},websafe:function(d,c,a){if(d instanceof Array){return this.websafe.call(this,d[0],d[1],d[2])}return[this.checkSafeNumber(d),this.checkSafeNumber(c),this.checkSafeNumber(a)]},invert:function(d,c,a){if(d instanceof Array){return this.invert.call(this,d[0],d[1],d[2])}return[255-d,255-c,255-a]},i18n:{websafe:"网页安全色",inverse:"反色",pick_color:"确定"}});Rs.ext.form.ColorDialog=Ext.extend(Ext.Window,{initComponent:function(){this.width=(!this.width||this.width<353)?353:this.width;this.applyDefaultsCP();Rs.ext.form.ColorDialog.superclass.initComponent.apply(this,arguments)},onRender:function(){Rs.ext.form.ColorDialog.superclass.onRender.apply(this,arguments);this.renderComponent()}});Ext.applyIf(Rs.ext.form.ColorDialog.prototype,Rs.ext.form.ColorPicker.prototype);Rs.ext.form.ColorPanel=Ext.extend(Ext.Panel,{initComponent:function(){this.width=(!this.width||this.width<300)?300:this.width;this.applyDefaultsCP();Rs.ext.form.ColorPanel.superclass.initComponent.apply(this,arguments)},onRender:function(){Rs.ext.form.ColorPanel.superclass.onRender.apply(this,arguments);this.renderComponent()}});Ext.applyIf(Rs.ext.form.ColorPanel.prototype,Rs.ext.form.ColorPicker.prototype);Ext.reg("colorpicker",Rs.ext.form.ColorPicker);Ext.reg("colordialog",Rs.ext.form.ColorDialog);Ext.reg("colorpanel",Rs.ext.form.ColorPanel);Ext.namespace("Rs.ext.menu","Rs.ext.form");Rs.ext.menu.ColorMenu=Ext.extend(Ext.menu.Menu,{enableScrolling:false,initComponent:function(){this.picker=new Rs.ext.form.ColorPicker(this.initialConfig);this.picker.on("render",function(a){a.getEl().swallowEvent("click")});Ext.apply(this,{plain:true,width:350,showSeparator:false,items:this.picker});Rs.ext.menu.ColorMenu.superclass.initComponent.call(this);this.relayEvents(this.picker,["select"])}});Ext.form.VTypes.hexText="Invalid Hex code, eg: (#F0F0F0)";Ext.form.VTypes.hex=function(a){return/^#?([a-f]|[A-F]|[0-9]){3}(([a-f]|[A-F]|[0-9]){3})?$/.test(a)};Rs.ext.form.ColorPickerFieldPlus=Ext.extend(Ext.form.TwinTriggerField,{trigger1Class:"x-form-color-trigger-1",trigger2Class:"x-form-color-trigger-2",hideTrigger1:false,hideTrigger2:false,vtype:"hex",initComponent:function(){Rs.ext.form.ColorPickerFieldPlus.superclass.initComponent.call(this);this.menu1=new Ext.menu.ColorMenu();this.menu2=new Rs.ext.menu.ColorMenu();this.menu1.on({select:{fn:function(a,b){this.setValue(b);this.focus.defer(10,this)},scope:this}});this.menu2.on({select:{fn:function(a,b){this.setValue(b);this.menu2.hide(true);this.focus.defer(10,this)},scope:this}})},setEltColor:function(a){var b=this.menu2.picker.rgbToHex(this.menu2.picker.invert(this.menu2.picker.hexToRgb(a)));this.el.applyStyles({background:"#"+a,color:"#"+b})},setValue:function(a){if(a===undefined||a.length<1){a="000000"}Rs.ext.form.ColorPickerFieldPlus.superclass.setValue.apply(this,arguments);this.setEltColor(a)},onBlur:function(){Rs.ext.form.ColorPickerFieldPlus.superclass.onBlur.call(this);this.setEltColor(this.getValue())},reset:function(){Rs.ext.form.ColorPickerFieldPlus.superclass.reset.call(this);this.setEltColor("FFFFFF")},onTrigger1Click:function(){if(this.disabled){return}this.menu1.show(this.el,"tl-bl?")},onTrigger2Click:function(){if(this.disabled){return}this.menu2.show(this.el,"tl-bl?");this.menu2.picker.setColor(this.getValue())},onDestroy:function(){if(this.menu2){this.menu2.destroy()}if(this.wrap){this.wrap.remove()}Rs.ext.form.ColorPickerFieldPlus.superclass.onDestroy.call(this)}});Ext.reg("colorpickerfieldplus",Rs.ext.form.ColorPickerFieldPlus);Rs.define("Rs.ext.app.Model",{extend:Ext.util.Observable,constructor:function(a){Ext.apply(this,a);Rs.ext.app.Model.superclass.constructor.apply(this,arguments);if(!this.data){this.data={}}},set:function(b,c){var a=this.data[b];if(a!==c){this.data[b]=c;this.fireEvent("change",this,b,c)}},get:function(a){return this.data[a]},getData:function(){return this.data},each:function(e,c){var d=this.data;if(Ext.isFunction(e)){for(var b in d){var a=d[b];e.call(c||this,b,a)}}},load:function(b,d,c){if(Ext.isFunction(b)){c=d;d=b;b={}}var a=new Rs.data.Service(Ext.apply({url:this.url,method:this.loadMethod||"load",accept:this.accept||"json"}),b);a.call({params:{data:Ext.apply({},this.data)}},function(e){if(typeof e=="object"){Ext.apply(this.data,e)}if(Ext.isFunction(d)){d.call(c||this,this,e)}},this)},save:function(b,d,c){if(Ext.isFunction(b)){c=d;d=b;b={}}var a=new Rs.data.Service(Ext.apply({url:this.url,method:this.saveMethod||"save",accept:this.accept||"json"},b));a.call({params:{data:Ext.apply({},this.data)}},function(e){if(Ext.isFunction(d)){d.call(c||this,e)}},this)},clear:function(b,d,c){if(Ext.isFunction(b)){c=d;d=b;b={}}var a=new Rs.data.Service(Ext.apply({url:this.url,method:this.clearMethod||"clear",accept:this.accept||"json"},b));a.call({params:{data:Ext.apply({},this.data)}},function(e){if(Ext.isFunction(d)){d.call(c||this,e)}},this)},callService:function(b,e,c){if(Ext.isFunction(b)){c=e;e=b;b={params:{}}}var d=b.params||{};delete b.params;var a=new Rs.data.Service(Ext.apply({url:this.url,method:"service",accept:"json"},b));a.call({params:d},function(f){if(Ext.isFunction(e)){e.call(c||this,f)}},this)},destroy:function(){var b=this.events;for(var a in b){var c=this.events[a.toLowerCase()];if(typeof c=="object"){Ext.each(c.listeners,function(d){if(d){c.removeListener(d.fn,d.scope)}},this)}}}});Rs.define("Rs.ext.app.CardPanel",{extend:Ext.Panel,constructor:function(c,b){if(!(c instanceof Rs.ext.app.Model)){b=c||{};c=new Rs.ext.app.Model({data:{}})}this.model=c;this.fieldTemplate=new Ext.XTemplate('<div style="text-align:{align};color:{color};font-size:{fontSize}px;">','<tpl if="this.hasFieldLabel(values)">','<span style="font-weight:bold;">{fieldLabel}</span>:',"</tpl>","<span>&nbsp{value}&nbsp<span>","</div>",{hasFieldLabel:function(d){return Ext.isEmpty(d.fieldLabel,false)!=true}});this.formBodyFields={};var a=[];this.formHeader=b.formHeader;this.formBody=b.formBody;this.formFooter=b.formFooter;this.initFormHeaderTop(a,this.formHeader);this.initFormHeaderCenter(a,this.formHeader);this.initFormHeaderBottom(a,this.formHeader);this.readOnlyExpressionCache={};this.initFormBody(a,this.formBody);this.onModelChangeEvalReadOnlyExpression();this.initFormFooter(a,this.formFooter);b=Ext.applyIf(b||{},{layout:{type:"vbox",padding:10,defaultMargins:{top:0,right:0,left:0,bottom:0},align:"stretch"},border:false,items:a});Rs.ext.app.CardPanel.superclass.constructor.call(this,b)},initFormHeaderTop:function(j,d){d=d||{};var g=[];var f=d.left;if(Ext.isEmpty(f,false)==false){var c={fontSize:14,color:"#000000",align:"left",value:"&nbsp"};if(Ext.isString(f)){f=Ext.apply({value:f},c)}else{Ext.applyIf(f,c)}var k=f.dataIndex;if(Ext.isEmpty(k,false)==false){Ext.apply(f,{value:this.model.get(k)})}this.formHeaderLeftConfig=f;var e=this.formHeaderLeftPanel=new Ext.Panel({border:false,columnWidth:0.5,html:this.fieldTemplate.applyTemplate(f)});g.push(e);if(Ext.isEmpty(k,false)==false){this.model.on("change",(function(o,m,p,l,n,q){if(m===l){Ext.apply(q,{value:p});Ext.get(n.body).update(this.fieldTemplate.applyTemplate(q))}}).createDelegate(this,[k,e,f],true),this)}}var b=d.right;if(Ext.isEmpty(b,false)==false){var a={fontSize:14,color:"#000000",align:"right",value:"&nbsp"};if(Ext.isString(b)){b=Ext.apply({value:b},a)}else{Ext.applyIf(b,a)}var k=b.dataIndex;if(Ext.isEmpty(k,false)==false){Ext.apply(b,{value:this.model.get(k)})}this.formHeaderRightConfig=b;var h=this.formHeaderRightPanel=new Ext.Panel({border:false,xtype:"panel",columnWidth:g.length==1?0.5:1,html:this.fieldTemplate.applyTemplate(b)});g.push(h);if(Ext.isEmpty(k,false)==false){this.model.on("change",(function(n,m,q,l,p,o){if(m===l){Ext.apply(o,{value:q});Ext.get(p.body).update(this.fieldTemplate.applyTemplate(o))}}).createDelegate(this,[k,h,b],true),this)}}if(g.length>0){j.push({xtype:"panel",border:false,layout:"column",items:g})}return j},initFormHeaderCenter:function(c,f){f=f||{};var a=[];var g=f.center;if(Ext.isEmpty(g,false)==false){var d={fontSize:36,color:"#000000",align:"center",value:"&nbsp"};if(Ext.isString(g)){g=Ext.apply({value:g},d)}else{Ext.applyIf(g,d)}var e=g.dataIndex;if(Ext.isEmpty(e,false)==false){Ext.apply(g,{value:this.model.get(e)})}this.formHeaderCenterConfig=g;var b=this.formHeaderCenterPanel=new Ext.Panel({border:false,html:this.fieldTemplate.applyTemplate(g)});c.push(b);if(Ext.isEmpty(e,false)==false){this.model.on("change",(function(l,k,m,h,j,n){if(k===h){Ext.apply(n,{value:m});Ext.get(j.body).update(this.fieldTemplate.applyTemplate(n))}}).createDelegate(this,[e,b,g],true),this)}}return c},initFormHeaderBottom:function(d,g){g=g||{};var b=[];var f=g.bottom;if(Ext.isEmpty(f,false)==false){var a={fontSize:14,color:"#000000",align:"center",value:"&nbsp"};if(Ext.isString(f)){Ext.apply({value:f},a)}else{Ext.applyIf(f,a)}var e=f.dataIndex;if(Ext.isEmpty(e,false)==false){Ext.apply(f,{value:this.model.get(e)})}this.formHeaderBottomConfig=f;var c=this.formHeaderBottomPanel=new Ext.Panel({border:false,bodyStyle:"padding-bottom:5px;",html:this.fieldTemplate.applyTemplate(f)});d.push(c);if(Ext.isEmpty(e,false)==false){this.model.on("change",(function(l,k,n,h,j,m){if(k===h){Ext.apply(m,{value:n});Ext.get(j.body).update(this.fieldTemplate.applyTemplate(m))}}).createDelegate(this,[e,c,f],true),this)}}return d},initFormBody:function(k,b){b=b||{};var o=b.fieldLabelWidth||80;var e=b.fields||[];for(var d=0;d<e.length;d++){var q=e[d],f=[];for(var c=0;c<q.length;c++){var g=Ext.applyIf(q[c],{xtype:"textfield",labelWidth:o,autoWidth:true});var h=g.labelWidth;var a=g.columnWidth;delete g.columnWidth;delete g.labelWidth;var m=g.dataIndex;var p=g.readOnlyExpression;if(Ext.isEmpty(m,false)==false&&g.readOnly==="expression"&&Ext.isEmpty(p,false)==false){this.readOnlyExpressionCache[m]=p;var n=this.evalReadOnlyExpression(p,this.model);if(Ext.isBoolean(n)){Ext.apply(g,{readOnly:n})}}delete g.readOnlyExpression;if(g.readOnly=="true"||g.readOnly==true){g.readOnly=true}else{if(g.readOnly=="false"||g.readOnly==false){g.readOnly=false}else{delete g.readOnly}}var l=Ext.create(g,g.xtype);if(Ext.isEmpty(m,false)==false){this.formBodyFields[m]=l;this.model.on("change",(function(s,r,t,j,u){if(r===j){this.setValueHelper(u,t)}}).createDelegate(this,[m,l],true),this);if(l instanceof Ext.form.HtmlEditor){l.on("sync",(function(t,j,s,r){this.model.set(s,this.getValueHelper(t,j))}).createDelegate(this,[m,this.model],2),this)}else{l.on("change",(function(u,j,t,s,r){this.model.set(s,this.getValueHelper(u,j))}).createDelegate(this,[m,this.model],3),this)}}f.push({xtype:"panel",bodyStyle:"padding-top:5px;",layout:"form",border:false,labelAlign:"right",labelWidth:h,columnWidth:a,mainField:l,items:[l],listeners:{render:{fn:function(s){var r=s.mainField;if(Ext.isEmpty(r.dataIndex,false)==false){var j=this.model.get(r.dataIndex);this.setValueHelper(r,j)}},scope:this,single:true},resize:{fn:function(v,u,r,x,s){var t=v.mainField.label?v.mainField.label.getWidth()+8:0;var j=u-t;if(j>40){this.setFieldWidthHelper(v.mainField,j)}},scope:this}}})}k.push({xtype:"panel",layout:"column",border:false,items:f})}},onModelChangeEvalReadOnlyExpression:function(){this.model.on("change",function(b){for(var a in this.readOnlyExpressionCache){var c=this.readOnlyExpressionCache[a];var d=this.evalReadOnlyExpression(c,b);if(Ext.isBoolean(d)){this.setFieldReadOnly(a,d)}}},this)},initFormFooter:function(j,f){f=f||{};var a=[];var q=f.left;var d=f.center;var l=f.right;var e=Ext.isEmpty(q,false)===false;var p=Ext.isEmpty(d,false)===false;var b=Ext.isEmpty(l,false)===false;if(e===true){var k={fontSize:14,color:"#000000",align:"left"};if(Ext.isString(q)){q=Ext.apply({value:q},k)}else{Ext.applyIf(q,k)}var m=q.dataIndex;if(Ext.isEmpty(m,false)==false){Ext.apply(q,{value:this.model.get(m)})}this.formFooterLeftConfig=q;var c=this.formFooterLeftPanel=new Ext.Panel({border:false,html:this.fieldTemplate.applyTemplate(q)});a.push(c);if(Ext.isEmpty(m,false)==false){this.model.on("change",(function(u,s,w,r,t,v){if(s===r){Ext.apply(v,{value:w});Ext.get(t.body).update(this.fieldTemplate.applyTemplate(v))}}).createDelegate(this,[m,c,q],true),this)}}else{a.push({xtype:"panel",border:false,html:'<div style="width:100px;">&nbsp</div>'})}if(p===true){var n={fontSize:14,color:"#000000",align:"center"};if(Ext.isString(d)){d=Ext.apply({value:d},n)}else{Ext.applyIf(d,n)}var m=d.dataIndex;if(Ext.isEmpty(m,false)==false){Ext.apply(d,{value:this.model.get(m)})}this.formFooterCenterConfig=d;var o=this.formFooterCenterPanel=new Ext.Panel({border:false,html:this.fieldTemplate.applyTemplate(d)});a.push(o);if(Ext.isEmpty(m,false)==false){this.model.on("change",(function(u,t,w,s,r,v){if(t===s){Ext.apply(v,{value:w});Ext.get(r.body).update(this.fieldTemplate.applyTemplate(v))}}).createDelegate(this,[m,o,d],true),this)}}else{a.push({xtype:"panel",border:false,html:'<div style="width:100px;">&nbsp</div>'})}if(b===true){var g={fontSize:14,color:"#000000",align:"right"};if(Ext.isString(l)){l=Ext.apply({value:d},g)}else{Ext.applyIf(l,g)}var m=l.dataIndex;if(Ext.isEmpty(m,false)==false){Ext.apply(l,{value:this.model.get(m)})}this.formFooterRightConfig=l;var h=this.formFooterRightPanel=new Ext.Panel({border:false,html:this.fieldTemplate.applyTemplate(l)});a.push(h);if(Ext.isEmpty(m,false)==false){this.model.on("change",(function(u,t,w,s,v,r){if(t===s){Ext.apply(r,{value:w});Ext.get(v.body).update(this.fieldTemplate.applyTemplate(r))}}).createDelegate(this,[m,h,l],true),this)}}else{a.push({xtype:"panel",border:false,html:'<div style="width:100px;">&nbsp</div>'})}if(e===true||p===true||b===true){j.push({xtype:"panel",border:false,layout:"table",layoutConfig:{tableAttrs:{style:{width:"100%"}},columns:3},bodyStyle:"padding-top:5px;",items:a})}return j},setValueHelper:function(b,a){if(b instanceof Ext.form.Label){b.setText(a)}else{if(b instanceof Ext.form.TextArea){b.setValue(a?unescape(a):"")}else{if(b instanceof Ext.form.DateField){b.setValue(a instanceof Date?a:Date.parseDate(a,"Y/m/d"))}else{b.setValue(a)}}}},getValueHelper:function(b,a){a=a||b.getValue();if(b instanceof Ext.form.TextArea){return escape(a)}else{if(b instanceof Ext.form.DateField){return a instanceof Date?a.format("Y/m/d"):a}else{return a}}},setFieldWidthHelper:function(b,a){if(b instanceof Rs.ext.form.Telescope){a=a-20}else{if(b instanceof Ext.form.TriggerField&&b.readOnly!==true){a=a-20}}if(Ext.isIE){a=a-60}b.setWidth(a);b.el.setWidth(a)},setFieldReadOnly:function(a,c){var b=this.formBodyFields[a];if(b&&b instanceof Ext.form.Field){b.setReadOnly(c===true)}},fieldValidate:function(){var a=true;for(var b in this.formBodyFields){var c=this.formBodyFields[b];if(c&&c instanceof Ext.form.Field){a=c.validate();if(a!==true){break}}}return a},setModel:function(a){if(!(a instanceof Rs.ext.app.Model)){throw"model必须为Rs.ext.app.Model的实例"}if(this.model){this.model.destroy();delete this.model}this.model=a;if(this.rendered){this.updateFormHeader();this.onModelChangeEvalReadOnlyExpression();this.updateFormFields();this.updateFormFooter()}else{this.on("render",function(){this.updateFormHeader();this.onModelChangeEvalReadOnlyExpression();this.updateFormFields();this.updateFormFooter();this.doLayout()},this,{single:true,delay:100})}},updateFormHeader:function(){var c=this.formHeaderLeftConfig;if(c){var h=c.dataIndex;if(Ext.isEmpty(h,false)==false){Ext.apply(c,{value:this.model.get(h)})}var b=this.formHeaderLeftPanel;if(b){if(b.rendered){Ext.get(b.body).update(this.fieldTemplate.applyTemplate(c))}else{b.on("render",function(k){Ext.get(k.body).update(this.fieldTemplate.applyTemplate(c))},this,{single:true})}this.model.on("change",(function(n,l,o,k,m,p){if(l===k){Ext.apply(p,{value:o});Ext.get(m.body).update(this.fieldTemplate.applyTemplate(p))}}).createDelegate(this,[h,b,c],true),this)}}var a=this.formHeaderRightConfig;if(a){var h=a.dataIndex;if(Ext.isEmpty(h,false)==false){Ext.apply(a,{value:this.model.get(h)})}var d=this.formHeaderRightPanel;if(d){if(d.rendered){Ext.get(d.body).update(this.fieldTemplate.applyTemplate(a))}else{d.on("render",function(k){Ext.get(k.body).update(this.fieldTemplate.applyTemplate(a))},this,{single:true})}this.model.on("change",(function(m,l,p,k,o,n){if(l===k){Ext.apply(n,{value:p});Ext.get(o.body).update(this.fieldTemplate.applyTemplate(n))}}).createDelegate(this,[h,d,a],true),this)}}var e=this.formHeaderCenterConfig;if(e){var h=e.dataIndex;if(Ext.isEmpty(h,false)==false){Ext.apply(e,{value:this.model.get(h)})}var j=this.formHeaderCenterPanel;if(j){if(j.rendered){Ext.get(j.body).update(this.fieldTemplate.applyTemplate(e))}else{j.on("render",function(k){Ext.get(k.body).update(this.fieldTemplate.applyTemplate(e))},this,{single:true})}this.model.on("change",(function(n,m,o,l,k,p){if(m===l){Ext.apply(p,{value:o});Ext.get(k.body).update(this.fieldTemplate.applyTemplate(p))}}).createDelegate(this,[h,j,e],true),this)}}var g=this.formHeaderBottomConfig;if(g){var h=g.dataIndex;if(Ext.isEmpty(h,false)==false){Ext.apply(g,{value:this.model.get(h)})}var f=this.formHeaderBottomPanel;if(f){if(f.rendered){Ext.get(f.body).update(this.fieldTemplate.applyTemplate(g))}else{f.on("render",function(k){Ext.get(k.body).update(this.fieldTemplate.applyTemplate(g))},this,{single:true})}this.model.on("change",(function(n,m,o,k,l,p){if(m===k){Ext.apply(p,{value:o});Ext.get(l.body).update(this.fieldTemplate.applyTemplate(p))}}).createDelegate(this,[h,f,g],true),this)}}},updateFormFields:function(){for(var a in this.formBodyFields){var c=this.formBodyFields[a];var b=this.readOnlyExpressionCache[a];if(Ext.isEmpty(b,false)==false){var d=this.evalReadOnlyExpression(b,this.model);if(Ext.isBoolean(d)){this.setFieldReadOnly(a,d)}}this.setValueHelper(c,this.model.get(a));this.model.on("change",(function(g,f,h,e,j){if(f===e){this.setValueHelper(j,h)}}).createDelegate(this,[a,c],true),this);if(c instanceof Ext.form.HtmlEditor){c.on("sync",(function(j,e,h,g){this.model.set(h,this.getValueHelper(j,e))}).createDelegate(this,[a,this.model],2),this)}else{c.on("change",(function(k,e,j,h,g){this.model.set(h,this.getValueHelper(k,e))}).createDelegate(this,[a,this.model],3),this)}}},updateFormFooter:function(){var g=this.formFooterLeftConfig;if(g){var e=g.dataIndex;if(Ext.isEmpty(e,false)==false){Ext.apply(g,{value:this.model.get(e)})}var c=this.formFooterLeftPanel;if(c){if(c.rendered){Ext.get(c.body).update(this.fieldTemplate.applyTemplate(g))}else{c.on("render",function(h){Ext.get(h.body).update(this.fieldTemplate.applyTemplate(g))},this,{single:true})}this.model.on("change",(function(l,j,n,h,k,m){if(j===h){Ext.apply(m,{value:n});Ext.get(k.body).update(this.fieldTemplate.applyTemplate(m))}}).createDelegate(this,[e,c,g],true),this)}}var d=this.formFooterCenterConfig;if(d){var e=d.dataIndex;if(Ext.isEmpty(e,false)==false){Ext.apply(d,{value:this.model.get(e)})}var b=this.formFooterCenterPanel;if(b){if(b.rendered){Ext.get(b.body).update(this.fieldTemplate.applyTemplate(d))}else{b.on("render",function(h){Ext.get(h.body).update(this.fieldTemplate.applyTemplate(d))},this,{single:true})}this.model.on("change",(function(l,k,n,j,h,m){if(k===j){Ext.apply(m,{value:n});Ext.get(h.body).update(this.fieldTemplate.applyTemplate(m))}}).createDelegate(this,[e,b,d],true),this)}}var a=this.formFooterRightConfig;if(a){var e=a.dataIndex;if(Ext.isEmpty(e,false)==false){Ext.apply(a,{value:this.model.get(e)})}var f=this.formFooterRightPanel;if(f){if(f.rendered){Ext.get(f.body).update(this.fieldTemplate.applyTemplate(a))}else{f.on("render",function(h){Ext.get(h.body).update(this.fieldTemplate.applyTemplate(a))},this,{single:true})}this.model.on("change",(function(l,k,n,j,m,h){if(k===j){Ext.apply(h,{value:n});Ext.get(m.body).update(this.fieldTemplate.applyTemplate(h))}}).createDelegate(this,[e,f,a],true),this)}}},getModel:function(){return this.model},evalReadOnlyExpression:function(expression,model){var result=null;try{eval("result = function(model){ return "+expression+";}(model);")}catch(e){}return result}});Rs.define("Rs.ext.app.GeneralCardPanel",{extend:Ext.Panel,mixins:[Rs.app.Main],displayMsg:"当前第{1}条, 共{0}条",constructor:function(b){var d=b.formCode;var c=b.formParams;var e=b.formEditable===true;var a=b.dataServiceUrl;Ext.apply(this,b);this.initGeneralForm(d,c);Ext.apply(b,{border:false,layout:"fit"});Rs.ext.app.GeneralCardPanel.superclass.constructor.apply(this,arguments)},initGeneralForm:function(c,a){var b=new Rs.ext.app.Model({url:this.dataServiceUrl,loadMethod:"getGeneralForm",data:{formCode:c}});Ext.Msg.wait("正在加载...","提示");b.load(function(f){Ext.Msg.hide();this.disabledExpressionCache={};var d=this.cardPanel=this.createCardPanel(f,c,a);this.add(d);this.doLayout();var e=f.get("modelCode");this.modelContainer=new Rs.ext.app.Model({url:this.dataServiceUrl,loadMethod:"getGeneralModel",data:{formCode:c,modelCode:e,cursor:0,formParams:a}});Ext.Msg.wait("正在加载...","提示");this.modelContainer.load(this.onLoadGeneralModel,this)},this)},onModelChangeEvalDisabledExpression:function(b){for(var e in this.disabledExpressionCache){var a=this.disabledExpressionCache[e];if(a&&a.btn&&a.expression){var c=a.btn;var f=a.expression;var d=this.evalDisabledExpression(f,b);if(Ext.isBoolean(d)){c.setDisabled(d)}}}},onLoadGeneralModel:function(c){Ext.Msg.hide();var h=c.get("modelData");if(h){var e=new Rs.ext.app.Model({data:c.get("modelData")});this.cardPanel.setModel(e);e.on("change",this.onModelChangeEvalDisabledExpression,this);this.onModelChangeEvalDisabledExpression(e)}var g=c.get("cursor");var f=c.get("total");if(f>1){var a=this.cardPanel.getBottomToolbar();var d=this.prevBtn;if(!d){d=this.prevBtn=new Ext.Button({text:"上一条",iconCls:"rs-action-goleft",scope:this,handler:function(){var k=this.modelContainer.get("cursor");this.modelContainer.set("cursor",k-1);Ext.Msg.wait("正在加载...","提示");this.modelContainer.load(this.onLoadGeneralModel,this)}});a.addButton(d)}d.setDisabled(g<=0?true:false);var j=this.msgLabel;if(!j){j=this.msgLabel=new Ext.form.Label({style:"font-size:10px;"});a.add("->");a.add("-");a.add(j);a.add("-")}j.setText(String.format(this.displayMsg,f,g+1));var b=this.nextBtn;if(!b){b=this.nextBtn=new Ext.Button({text:"下一条",iconCls:"rs-action-goright",scope:this,handler:function(){var k=this.modelContainer.get("cursor");this.modelContainer.set("cursor",k+1);Ext.Msg.wait("正在加载...","提示");this.modelContainer.load(this.onLoadGeneralModel,this)}});a.addButton(b)}b.setDisabled(g>=f-1?true:false);if(a.hidden===true){a.show()}}else{var a=this.cardPanel.getBottomToolbar();if(a.hidden!=true){a.hide()}}},createCardPanel:function(form,formCode,formParams){var regions=form.get("formRegions")||{};var lines=form.get("fieldLines")||[];var formHeader={};var formBody={formEditable:this.formEditable};var formFooter={};if(typeof regions.headercenter==="object"){var cfg={};try{eval("cfg = "+unescape(regions.headercenter.regionConfig))}catch(e){}delete regions.headercenter.regionConfig;Ext.apply(formHeader,{center:Ext.apply(regions.headercenter,cfg)})}if(typeof regions.headerbottom==="object"){var cfg={};try{eval(" cfg = "+unescape(regions.headerbottom.regionConfig))}catch(e){}delete regions.headerbottom.regionConfig;Ext.apply(formHeader,{bottom:Ext.apply(regions.headerbottom,cfg)})}if(typeof regions.headerleft==="object"){var cfg={};try{eval(" cfg = "+unescape(regions.headerleft.regionConfig))}catch(e){}delete regions.headerleft.regionConfig;Ext.apply(formHeader,{left:Ext.apply(regions.headerleft,cfg)})}if(typeof regions.headerright==="object"){var cfg={};try{eval(" cfg = "+unescape(regions.headerright.regionConfig))}catch(e){}delete regions.headerright.regionConfig;Ext.apply(formHeader,{right:Ext.apply(regions.headerright,cfg)})}if(typeof regions.footerleft==="object"){var cfg={};try{eval(" cfg = "+unescape(regions.footerleft.regionConfig))}catch(e){}delete regions.footerleft.regionConfig;Ext.apply(formFooter,{left:Ext.apply(regions.footerleft,cfg)})}if(typeof regions.footercenter==="object"){var cfg={};try{eval(" cfg = "+unescape(regions.footercenter.regionConfig))}catch(e){}delete regions.footercenter.regionConfig;Ext.apply(formFooter,{center:Ext.apply(regions.footercenter,cfg)})}if(typeof regions.footerright==="object"){var cfg={};try{eval(" cfg = "+unescape(regions.footerright.regionConfig))}catch(e){}delete regions.footerright.regionConfig;Ext.apply(formFooter,{right:Ext.apply(regions.footerright,cfg)})}var fields=[];Ext.each(lines,function(line){var temp=[];if(line&&line.fields){Ext.each(line.fields,function(field){var cfg={};try{eval(" cfg = "+unescape(field.fieldConfig))}catch(e){}delete field.fieldConfig;temp.push(Ext.apply(field,cfg))},this)}fields.push(temp)},this);Ext.apply(formBody,{fields:fields});var config={formHeader:formHeader,formBody:formBody,formFooter:formFooter,bbar:new Ext.Toolbar({hidden:true})};var title=form.get("formName");if(Ext.isEmpty(title,false)==false){Ext.apply(config,{title:title})}var actions=form.get("formActions")||[];if(actions.length>0){var btns=[];Ext.each(actions,function(act){var an=act.actionNo;var at=act.actionType;var cb=act.callback;var de=act.disabledExpression;var btn=new Ext.Button({text:act.actionName,iconCls:act.iconCls,tooltip:act.tooltip,scope:this,handler:this.doAction.createDelegate(this,[an,at,cb,form,formCode,formParams])});if(Ext.isEmpty(de,false)==false){this.disabledExpressionCache[an]={expression:de,btn:btn}}btns.push(btn)},this);Ext.apply(config,{tbar:btns})}return new Rs.ext.app.CardPanel(config)},doAction:function(k,c,m,b,n,p){var h=this.cardPanel;var a=this.modelContainer;var f=new Rs.ext.app.Model({data:a.get("modelData")});var d=(function(w,x,t){if(Ext.isFunction(x)==false){t=x}var v=b.get("formActions")||[];var s=null;Ext.each(v,function(y){if(y.actionNo==w){s=y;return false}},this);if(s){var u=s.actionNo;var r=s.actionType;var q=s.callback;t.doAction(u,r,function(A,y,z){if(Ext.isFunction(x)){x.call(t,A,y,z)}},b,n,p)}else{if(Ext.isFunction(x)){x.call(t)}}}).createDelegate(this,[this],true);var g=(function(s,r){if(Ext.isFunction(s)==false){r=s}var q=r.modelContainer;Ext.Msg.wait("正在进行...","提示");q.callService({method:"doSaveAction",params:{formCode:n,formParams:p,modelData:q.get("modelData")}},function(t){Ext.Msg.hide();r.doActionCallback(c,function(x,v,w,u){if(Ext.isFunction(s)){s.call(r,x,v,w,u)}},b,n,p,h,q,f,t,d,g,e,l)},r)}).createDelegate(this,[this],true);var e=(function(s,r){if(Ext.isFunction(s)==false){r=s}var q=r.modelContainer;Ext.Msg.wait("正在删除...","提示");q.callService({method:"doClearAction",params:{formCode:n,formParams:p,modelData:q.get("modelData")}},function(t){Ext.Msg.hide();if(t&&t.SUCC==true){Ext.Msg.wait("正在加载...","提示");q.load(function(u){r.onLoadGeneralModel(u);r.doActionCallback(c,function(y,w,x,v){if(Ext.isFunction(s)){s.call(r,y,w,x,v)}},b,n,p,h,u,f,t,d,g,e,l)},r)}else{r.doActionCallback(c,function(x,v,w,u){if(Ext.isFunction(s)){s.call(r,x,v,w,u)}},b,n,p,h,q,f,t,d,g,e,l)}},r)}).createDelegate(this,[this],true);var l=(function(s,r){if(Ext.isFunction(s)==false){r=s}var q=r.modelContainer;Ext.Msg.wait("正在加载...","提示");q.callService({method:"doLoadAction",params:{formCode:n,formParams:p,modelData:q.get("modelData")}},function(t){Ext.Msg.hide();if(t&&t.SUCC==true){var v=t.DATA;if(Ext.isObject(v)){q.set("modelData",v);var u=new Rs.ext.app.Model({data:v});r.cardPanel.setModel(u)}r.doActionCallback(c,function(z,x,y,w){if(Ext.isFunction(s)){s.call(r,z,x,y,w)}},b,n,p,h,q,u,t,d,g,e,l)}else{r.doActionCallback(c,function(z,x,y,w){if(Ext.isFunction(s)){s.call(r,z,x,y,w)}},b,n,p,h,q,u,t,d,g,e,l)}},r)}).createDelegate(this,[this],true);var j=function(){var q=this.modelContainer;Ext.Msg.wait("正在进行...","提示");q.callService({method:"doActionNo",params:{formCode:n,actionNo:k,formParams:p,modelData:q.get("modelData")}},function(r){Ext.Msg.hide();this.doActionCallback(c,m,b,n,p,h,q,f,r,d,g,e,l)},this)};if(c=="javascript"){var o={SUCC:true,MSG:""};this.doActionCallback(c,m,b,n,p,h,a,f,o,d,g,e,l)}else{if(c=="save"){g.call(this,function(t,r,s,q){this.doActionCallback(c,m,b,n,p,t,r,s,q,d,g,e,l)})}else{if(c=="clear"){Ext.MessageBox.show({title:"提示",msg:"您确定要删除该数据吗？删除后将无法恢复!",buttons:Ext.Msg.YESNO,scope:this,fn:function(q){if(q=="yes"){e.call(this,function(u,s,t,r){this.doActionCallback(c,m,b,n,p,u,s,t,r,d,g,e,l)})}},icon:Ext.MessageBox.QUESTION})}else{if(c=="load"){l.call(this,function(t,r,s,q){this.doActionCallback(c,m,b,n,p,t,r,s,q,d,g,e,l)})}else{if(c=="exec"){Ext.MessageBox.show({title:"提示",msg:"您确定要执行该操作吗!",buttons:Ext.Msg.YESNO,scope:this,fn:function(q){if(q=="yes"){j.call(this)}},icon:Ext.MessageBox.QUESTION})}}}}}},doActionCallback:function(actionType,callback,form,formCode,formParams,cardPanel,container,model,result,action,save,clear,load){if(Ext.isFunction(callback)){callback.call(this,cardPanel,container,model,result,action,save,clear,load)}else{try{eval("(function(cardPanel, container, model, result, action, save, clear, load){"+unescape(callback)+"})(cardPanel, container, model, result, action, save, clear, load);")}catch(e){}}},evalDisabledExpression:function(expression,model){var result=null;try{eval("result = function(model){ return "+expression+";}(model);")}catch(e){}return result}});